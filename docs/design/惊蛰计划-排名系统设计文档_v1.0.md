# 惊蛰计划 - 排名系统设计文档 v1.0

> **版本**：v1.0
> **创建日期**：2025-01-07
> **状态**：核心规则已确认，待补充细节
> **复杂度**：⭐⭐⭐

---

## 📋 文档概述

### 系统定位

排名系统是惊蛰计划的核心功能模块之一，负责基于评分数据计算排名并展示结果。

**核心价值**：
- 提供**12个独立榜单**（6维度 × 2评分群体）
- **不计算总分**，保持各维度独立性
- **革命性排名设计**，避免传统总分排名的弊端
- 支持个人赛道和团队赛道双轨并行
- 与评分系统、团队系统深度集成

### 系统复杂度

| 指标 | 数量 | 说明 |
|------|------|------|
| **榜单数量** | 12个 | 6维度 × 2评分群体 |
| **排名维度** | 6个 | 创新性、主题诠释、视觉效果、音乐音频、整体性、有活儿 |
| **评分群体** | 2个 | 参赛者、评审团 |
| **排名资格** | 1个 | 总评分人次 > 20 |
| **特殊机制** | 2个 | 优选游戏、AI使用处理 |
| **待确认问题** | 11个 | 4个高优先级 |

### 设计理念

**革命性排名系统**：
- ✅ **不计算总分**：各维度独立排名，避免权重争议
- ✅ **单维度排名**：每个维度独立计算，保持纯粹性
- ✅ **12个榜单**：6个维度 × 2个评分群体，全面展示
- ✅ **优选游戏**：3个及以上维度进入前10 → 特殊标识

---

## 🎯 核心规则（已确认 ✅）

### 1. 榜单结构

#### 12个独立榜单

**6个评分维度** × **2个评分群体** = **12个榜单**

```
创新性榜单
├── 创新性（参赛者榜）
└── 创新性（评审团榜）

主题诠释榜单
├── 主题诠释（参赛者榜）
└── 主题诠释（评审团榜）

视觉效果榜单
├── 视觉效果（参赛者榜）
└── 视觉效果（评审团榜）

音乐音频榜单
├── 音乐音频（参赛者榜）
└── 音乐音频（评审团榜）

整体性榜单
├── 整体性（参赛者榜）
└── 整体性（评审团榜）

有活儿榜单
├── 有活儿（参赛者榜）
└── 有活儿（评审团榜）
```

#### 榜单独立性
- ✅ **不计算总分**：不存在"总分排名"
- ✅ **各维度独立**：每个维度单独计算排名
- ✅ **群体独立**：参赛者和评审团分别排名
- ✅ **无权重争议**：避免"哪个维度更重要"的争论

#### 评审团权威性体现 ✅（2025-01-07确认）

**核心原则**：评审团权威性通过**独立榜单**和**时间积累**体现，而非算法加权

**具体规则**：

1. **评审团权重×2仅体现在门槛**
   - 公式: 总人次 = 参赛者人次 + 2×评审团人次
   - 不在算法内部体现

2. **评审团权威性靠自身评价质量建设**
   - 评审团通过专业、公正的评价建立权威
   - 不通过算法加权人为提升权威性

3. **12个独立榜单体现双重视角**
   - 参赛者榜: 大众口碑导向
   - 评审团榜: 专业评价导向
   - 两个榜单独立运行，互不干扰

4. **官方宣传强调评审团推荐榜**
   - 评审团榜单作为"专家推荐"主榜单
   - 参赛者榜单作为"大众口碑"参考榜单

**榜单展示策略**：
- 评审团榜标注"专家推荐"或"评审团推荐"⭐
- 参赛者榜标注"大众口碑"或"参赛者互评"
- 官方规则说明中强调评审团榜的权威性

**为什么不在算法中体现评审团权重？**
1. ✅ 保持榜单独立性（避免"隐性计算总分"）
2. ✅ 避免权重争议（权重×2还是×3？难以解释）
3. ✅ 真实权威来自评价质量，不是算法赋予
4. ✅ 长期建设优于短期加权

---

### 2. 排名资格

#### 基本要求

**第一届门槛：总评分人次 > 15** ✅ 已确认（2025-01-07）

计算公式：
```
总评分人次 = 参赛者评分人次 + 2 × 评审团评分人次
```

**说明**：
- 评审团的评分权重更高（1次 = 2人次）
- 鼓励获得评审团评分
- 未达到15人次的作品**不进入排名**

**第一届调整为15人次的原因**：
- ✅ 第一届参赛规模可能较小，降低门槛避免冷启动问题
- ✅ 鼓励更多游戏参与排名
- ✅ 后续可根据第一届数据调整（第二届可能恢复20人或动态调整）

#### 分榜单门槛规则 ✅ 已确认（2025-01-07）

**规则**：采用**总门槛策略**

- 只要总人次 > 15，该游戏的12个榜单都参与排名
- 不要求单个榜单独立达到门槛
- 通过标注提示用户可信度

**示例**：
```
游戏X: 参赛者15个 + 评审团3个 = 总人次21 ✅ 达标

参赛者榜: 参与排名（标注: 15个评分）
评审团榜: 参与排名（标注: 3个评分 ⚠️ 样本量较小）
```

**标注规则**：
- 评分数量 ≥ 20个: 正常显示
- 评分数量 10-19个: 标注⚠️ "样本量较小"
- 评分数量 < 10个: 标注⚠️⚠️ "样本量很小，仅供参考"

**优点**：
- ✅ 简单直接，符合第一届"稳定优于完美"原则
- ✅ 保持12榜单完整性
- ✅ 通过透明标注让用户自主判断可信度
- ✅ 避免硬性门槛导致榜单不完整

#### 显示提示

**未达到15人次的作品**：
- 页面显示："你的游戏已获得 12/15 人次评分，还需 3 人次即可进入排名"
- 鼓励互相评分，促进冷启动

#### ✅ 已确认事项（2025-01-07）

**Q1: 20人次阈值是否需要动态调整？** → ✅ **第一届改为15人次，第二届根据数据调整**

**分榜单门槛规则** → ✅ **采用总门槛策略，12个榜单共用一个门槛**

**Q1: 后续届次门槛调整** → ⏳ 第二届根据第一届数据决定是否恢复20人或采用动态调整

---

### 3. 排名计算方法

#### 当前设计：混合算法（权重 + 截尾 + 加权平均）✅（2025-01-07确认）

**核心算法**：
```
1. 计算用户权重: W = 1 + 0.55×ln(1+n) (n为评分次数)
2. 双侧截尾: 按原始分数去掉最高最低各10%
3. 加权平均: 剩余评分 × 权重后求平均
```

**示例**：
- 创新性维度评分：10, 9, 8, 7, 6, 8, 9, 7, 8, 9（10个评分）
- 假设用户权重：[2.5, 1.8, 1.5, 2.0, 1.3, 1.6, 2.2, 1.7, 1.9, 2.1]
- 按原始分排序后截尾（去掉1个最低6分，1个最高10分）
- 剩余8个评分加权平均：最终得分

**特点**：
- ✅ 用户权重体现认真评分者的贡献
- ✅ 双侧截尾抗刷分
- ✅ 按原始分截尾，避免惩罚高权重用户

#### 与通用白皮书的差异

| 维度 | 惊蛰计划 | 通用白皮书 v3.0 | 兼容性 |
|------|---------|----------------|--------|
| **核心设计** | 12个独立榜单 | 单一总分，综合多维度 | ❌ 不兼容 |
| **排名依据** | 算术平均 | 鲁棒均值 + 贝叶斯平滑 + 不确定性惩罚 | ❌ 不兼容 |
| **反作弊** | 简单阈值 | 评分者信誉系统(RTS) + 互评团检测 | ⚠️ 部分兼容 |
| **冷启动** | 固定阈值(>20人次) | 动态贝叶斯平滑，自动调节 | ⚠️ 可叠加 |

**结论**：
- 惊蛰计划的排名系统**本质上更简单**
- 牺牲了统计严谨性，换取了设计简洁性
- 白皮书的复杂算法**无法直接应用**

#### 🚨 待确认问题（Q2）

**Q2: 是否需要引入鲁棒统计方法？**

**当前**：简单算术平均

**潜在问题**：
- 易受极端值影响（如1个1分拉低整体得分）
- 无法自动识别刷分行为

**选项**：
- A. 保持算术平均（简单，第一届够用）
- B. 引入截尾均值（去掉最高和最低各10%）
- C. 引入Huber鲁棒均值（更复杂，抗刷分）

**建议**：选A（第一届），第二届考虑B

---

### 4. 并列处理规则

#### 当前规则：三层优先级 ✅（2025-01-07更新）

当多个游戏的维度得分相同时，按以下优先级排序：

1. **评审团得分**：评审团评分高的优先
2. **加权评分人次**：Σ权重高的优先 ✅（已确认）
3. **创新性维度得分**：创新性得分高的优先
4. **允许并列**：如果以上都相同，允许并列（标注"并列第X名"）

**说明**:
- "加权评分人次" = 所有评分用户的权重之和（Σ权重）
- 体现认真评分用户的贡献，比简单的人数统计更公平

---

### 5. 优选游戏机制

#### 判定标准

**优选游戏**：在**3个及以上维度**进入**前10名**

#### 分类

**参赛者优选游戏**：
- 3个及以上维度进入**参赛者榜前10**

**评审团优选游戏**：
- 3个及以上维度进入**评审团榜前10**

#### 展示方式

- 优选游戏获得特殊标识（如"优选游戏"徽章）
- 在游戏页面和个人主页显示
- 列入"优选游戏"榜单

#### 🚨 待确认问题（Q4）

**Q4: 优选游戏判定逻辑是否有漏洞？**

**场景A**：
- 游戏A：创新性排第1，其他维度都排第20
- 游戏B：3个维度都排第9
- 谁更应该是"优选游戏"？

**当前规则**：两者都是优选游戏

**选项**：
- A. 保持当前规则（只要3个维度前10即可）
- B. 引入加权机制（如考虑排名的绝对位置）
- C. 引入"综合表现"指标（如平均排名）

**建议**：选A（保持简单）

---

### 6. AI使用对排名的影响

#### 当前规则：维度不参与排名

**情况A**：作者申报使用AI制作美术
- **视觉效果维度**：不参与排名
- **其他5个维度**：正常评分排名

**情况B**：作者申报使用AI制作音频
- **音乐音频维度**：不参与排名
- **其他5个维度**：正常评分排名

**情况C**：美术和音频都使用AI
- **视觉效果维度**：不参与排名
- **音乐音频维度**：不参与排名
- **其他4个维度**：正常评分排名

#### 显示方式

**未参与排名的维度**：
- 该维度榜单中**不显示**该游戏
- 游戏页面显示："本维度使用AI辅助，不参与排名"

#### 🚨 待确认问题（Q5）

**Q5: AI使用是否影响优选游戏判定？**

**场景**：
- 游戏A使用AI制作美术，6个维度中只有5个参与排名
- 游戏A在4个维度进入前10
- 是否算"优选游戏"？

**选项**：
- A. 算（4个维度前10，满足"3个及以上"）
- B. 不算（必须6个维度中的3个，即使某些维度不参与排名）

**建议**：选A（公平）

---

### 7. 团队作品的排名规则

#### 🚨 待确认问题（Q6）- 高优先级！

**Q6: 团队作品如何计入12个榜单？**

**当前状态**：**未明确！**

**选项**：
- A. **混合排名**（推荐）
  - 团队作品和个人作品在同一个榜单
  - 不区分赛道
  - 简单直接

- B. **独立排名**
  - 团队作品有独立的"团队赛道榜单"
  - 变成24个榜单（12个人赛道 + 12个团队赛道）
  - 复杂度翻倍

- C. **混合 + 标识**
  - 混合排名，但标注"个人"或"团队"
  - 用户可筛选查看

**建议**：选A（混合排名）

**理由**：
- 简化复杂度
- 个人和团队作品同台竞技更公平
- 符合"革命性排名"的初衷

---

#### 🚨 待确认问题（Q7）

**Q7: 个人赛道和团队赛道是否完全独立？**

**场景**：
- 用户A提交了个人作品（个人赛道）
- 用户A同时是团队B的成员，团队B提交了团队作品（团队赛道）

**问题**：
- 用户A的个人作品和团队作品在同一个榜单吗？
- 如果个人作品排第5，团队作品排第3，如何显示？

**选项**：
- A. **完全独立**（推荐）
  - 个人作品和团队作品分开排名
  - 一个人可以同时获得两个排名
  - 24个榜单（12个人 + 12团队）

- B. **混合排名**
  - 个人和团队作品在同一榜单
  - 一个人可能有两个作品在同一榜单

**建议**：需要明确

---

#### 🚨 待确认问题（Q8）

**Q8: 退出成员的作品排名是否受影响？**

**场景**：
- 团队作品提交时：9人团队
- 评分期间：3人退出，变成6人团队
- 排名时：该作品如何计算？

**选项**：
- A. **不受影响**（推荐）
  - 作品已提交，成员退出不影响排名
  - 保持排名稳定性

- B. **重新计算**
  - 成员变更后，排名重新计算
  - 可能导致排名波动

**建议**：选A（不受影响）

---

### 8. 排名展示方式

#### 榜单页面结构

**页面布局**：
```
排名页面
├── 维度选择标签（6个维度）
│   ├── 创新性
│   ├── 主题诠释
│   ├── 视觉效果
│   ├── 音乐音频
│   ├── 整体性
│   └── 有活儿
│
├── 评分群体切换（2个）
│   ├── 参赛者榜
│   └── 评审团榜
│
└── 排名列表（Top 100）
    ├── 排名
    ├── 游戏封面
    ├── 游戏名称
    ├── 作者（个人/团队）
    ├── 维度得分
    └── 优选游戏标识（如果有）
```

#### 🚨 待确认问题（Q9）

**Q9: 排名列表显示多少名？**

**选项**：
- A. Top 50（推荐，第一届规模）
- B. Top 100
- C. Top 200
- D. 全部显示（可能很多）

**建议**：选A（Top 50），第二届根据参赛规模调整

---

#### 🚨 待确认问题（Q10）

**Q10: 排名更新频率是多少？**

**选项**：
- A. **实时更新**（每次评分后立即重算）
- B. **定时更新**（每小时更新一次）
- C. **手动更新**（管理员触发）

**建议**：选B（定时更新，每小时） ✅ **已确认（2025-01-07）**

**理由**：
- 减轻服务器压力
- 避免频繁刷新导致用户体验混乱
- 保留历史排名快照
- 用户权重每小时批量更新，排名同步更新

---

### 9. 特殊情况处理

#### 🚨 待确认问题（Q11）

**Q11: 排名期间发现作弊如何处理？**

**场景**：
- 排名已公布
- 发现某游戏刷分
- 如何处理排名？

**选项**：
- A. **取消资格，排名顺延**（推荐）
  - 取消作弊游戏的排名资格
  - 后面的名次依次前移
  - 标注"原第X名因作弊被取消"

- B. **保留排名，标注作弊**
  - 名次不变，标注"作弊"
  - 不影响其他游戏的排名

- C. **全部重算**
  - 移除作弊游戏的评分
  - 重新计算所有排名

**建议**：选A（取消资格，排名顺延）

---

## 🔗 与其他系统的集成

### 1. 与评分系统集成

**数据流向**：
```
评分系统 → 产生评分数据
         ↓
排名系统 → 计算排名
         ↓
结果公布 → 展示12个榜单
```

**集成点**：
- 评分数据实时同步到排名系统
- 评分资格（>20人次）决定排名资格
- AI使用标记影响参与排名的维度

---

### 2. 与团队系统集成

**集成点**：
- 团队作品的作者标识
- 退出成员的作品处理
- 个人赛道 vs 团队赛道的排名规则

**待确认**：
- 团队作品和个人作品是否混合排名（Q6）
- 退出成员是否影响作品排名（Q8）

---

### 3. 与经济系统集成

**集成点**：
- 优选游戏可能获得额外金币奖励（未来）
- 排名前10可能获得特殊成就
- 排名影响推荐位购买价格（未来）

---

### 4. 与推荐系统集成

**集成点**：
- "危险边缘作品"（评分人次不足20）优先展示
- 优选游戏自动获得推荐资格
- 排名靠前的作品优先展示

---

## 📊 数据结构设计

### 1. 核心数据表

#### rankings（排名表）
```sql
ranking_id         INT          PK  -- 排名ID
game_id            INT              -- 游戏ID（FK）
dimension          ENUM             -- 维度（innovation/theme/visual/audio/overall/creative）
scorer_group       ENUM             -- 评分群体（participant/judge）
dimension_score    DECIMAL(4,2)     -- 维度得分（算术平均）
ranking_position   INT              -- 排名位置
is_tied            BOOLEAN          -- 是否并列
total_scores       INT              -- 总评分人次
judge_scores       INT              -- 评审团评分人次
participant_scores INT              -- 参赛者评分人次
calculated_at      DATETIME         -- 计算时间
```

#### premium_games（优选游戏表）
```sql
premium_id         INT          PK  -- 优选游戏ID
game_id            INT              -- 游戏ID（FK）
scorer_group       ENUM             -- 评分群体（participant/judge）
top_dimensions     INT              -- 进入前10的维度数量
dimension_details  JSON             -- 各维度排名详情
awarded_at         DATETIME         -- 授予时间
```

#### ranking_snapshots（排名快照表）
```sql
snapshot_id        INT          PK  -- 快照ID
game_id            INT              -- 游戏ID（FK）
dimension          ENUM             -- 维度
scorer_group       ENUM             -- 评分群体
ranking_position   INT              -- 排名位置
snapshot_time      DATETIME         -- 快照时间
```

### 2. 索引设计

```sql
-- 排名表索引
CREATE INDEX idx_rankings_game ON rankings(game_id);
CREATE INDEX idx_rankings_dimension_group ON rankings(dimension, scorer_group);
CREATE INDEX idx_rankings_position ON rankings(ranking_position);

-- 优选游戏索引
CREATE INDEX idx_premium_game ON premium_games(game_id);
CREATE INDEX idx_premium_group ON premium_games(scorer_group);

-- 快照表索引
CREATE INDEX idx_snapshot_game ON ranking_snapshots(game_id);
CREATE INDEX idx_snapshot_time ON ranking_snapshots(snapshot_time);
```

---

## 🎨 UI/UX设计建议

### 1. 榜单页面设计

#### 布局
- **顶部**：维度选择标签（6个）
- **右上角**：评分群体切换（参赛者/评审团）
- **主体**：排名列表（卡片式）

#### 排名卡片
```
┌─────────────────────────────┐
│ 🏆 第1名  [优选游戏]        │
│ ┌──┬──┬──┬──┬──┬──┐        │
│ │封面│ 游戏名称            │
│ └──┴──┴──┴──┴──┴──┘        │
│ 作者：XXX团队               │
│ 创新性：9.2分               │
│ 评分人数：156人             │
└─────────────────────────────┘
```

### 2. 游戏页面排名展示

**维度排名徽章**：
```
创新性：🥇 第1名（参赛者榜）｜🥈 第3名（评审团榜）
主题诠释：🥉 第8名（参赛者榜）｜-（评审团榜）
视觉效果：-（使用AI，不参与排名）
```

---

## 📈 实现优先级

### 第一届必须实现（MVP）⭐

1. ✅ 12个榜单的独立计算
2. ✅ 排名资格判定（>20人次）
3. ✅ 并列处理（三层优先级）
4. ✅ 优选游戏判定（3个维度前10）
5. ✅ AI使用处理（维度不参与排名）
6. ✅ 基础榜单展示（Top 50）

### 第二届优化
7. ⚠️ 团队作品排名规则明确
8. ⚠️ 个人/团队赛道独立或混合
9. ⚠️ 引入截尾均值（抗刷分）
10. ⚠️ 排名快照功能

### 未来迭代
11. ⏳ 鲁棒统计方法
12. ⏳ 动态贝叶斯平滑
13. ⏳ 排名预测系统
14. ⏳ 历史排名趋势

---

## 🚨 待确认问题清单

### 🔴 高优先级（4个）

#### Q6: 团队作品如何计入12个榜单？
**影响**：榜单结构、复杂度

**选项**：
- A. 混合排名（个人+团队在同一榜单）
- B. 独立排名（24个榜单）
- C. 混合+标识

**建议**：选A

---

#### Q7: 个人赛道和团队赛道是否完全独立？
**影响**：榜单数量、用户理解

**待明确**

---

#### Q8: 退出成员的作品排名是否受影响？
**影响**：排名稳定性

**建议**：不受影响

---

#### Q1: 20人次阈值是否需要动态调整？
**影响**：冷启动公平性

**建议**：第一届固定20人次

---

### 🟡 中优先级（4个）

#### Q2: 是否需要引入鲁棒统计方法？
**影响**：抗刷分能力

**建议**：第一届算术平均，第二届截尾均值

---

#### Q3: 如果三层优先级都相同怎么办？
**影响**：并列显示规则

**建议**：允许并列，标注"并列"

---

#### Q4: 优选游戏判定逻辑是否有漏洞？
**影响**：优选游戏公平性

**建议**：保持当前规则（3个维度前10即可）

---

#### Q5: AI使用是否影响优选游戏判定？
**影响**：优选游戏公平性

**建议**：不影响（4个维度前10也算）

---

### 🟢 低优先级（3个）

#### Q9: 排名列表显示多少名？
**影响**：页面展示

**建议**：Top 50（第一届）

---

#### Q10: 排名更新频率是多少？
**影响**：服务器压力、用户体验

**建议**：每小时更新一次

---

#### Q11: 排名期间发现作弊如何处理？
**影响**：风控机制

**建议**：取消资格，排名顺延

---

## 📝 开发注意事项

### 前端开发

#### 榜单页面
- 响应式设计（移动端友好）
- 维度切换动画
- 排名卡片悬浮效果
- 优选游戏徽章设计

#### 游戏页面
- 维度排名徽章
- 排名趋势图（未来）
- 快照对比（未来）

### 后端开发

#### 核心接口
```
GET  /api/rankings/:dimension/:group  - 获取榜单
GET  /api/rankings/premium/:group     - 获取优选游戏
GET  /api/rankings/game/:id          - 获取游戏在各维度排名
POST /api/rankings/recalculate       - 手动触发排名重算（管理员）
```

#### 计算逻辑
- 定时任务（每小时）自动计算排名
- 缓存排名结果（Redis）
- 增量更新（仅重算受影响的游戏）

### 数据库优化

#### 查询优化
- 维度+群体组合索引
- 排名计算预聚合
- 避免实时计算，使用快照

#### 缓存策略
- 排名结果缓存1小时
- 优选游戏缓存1小时
- 游戏维度排名缓存30分钟

---

## 🎯 总结

### 系统复杂度评估

| 指标 | 评分 | 说明 |
|------|------|------|
| **功能复杂度** | ⭐⭐⭐ | 12个榜单，多维度集成 |
| **逻辑复杂度** | ⭐⭐ | 算术平均，逻辑简单 |
| **数据关联** | ⭐⭐⭐ | 与评分、团队、经济系统集成 |
| **开发工作量** | ⭐⭐ | 约10-15人日 |
| **维护成本** | ⭐⭐ | 中等 |

### 关键决策点

**已确认**：
- ✅ 12个独立榜单（6维度 × 2群体）
- ✅ 不计算总分，各维度独立
- ✅ 排名资格：>20人次
- ✅ 优选游戏：3个维度前10
- ✅ AI使用：维度不参与排名

**待确认**：
- ⏳ 11个问题，需逐个明确
- 🔴 高优先级：4个（特别是Q6、Q7、Q8）

### 下一步行动

1. **立即行动**：
   - 逐个确认11个待确认问题
   - 从高优先级（Q6-Q8）开始

2. **补充文档**：
   - UI/UX设计稿（榜单页面）
   - 接口文档（API设计）
   - 数据库ER图

3. **开发准备**：
   - 前端组件设计
   - 后端接口开发
   - 测试用例编写

---

*最后更新：2025-01-07*
*创建人：Claude (老黑)*
*状态：核心规则已确认，待补充细节*
