# 经济系统收益展示机制设计

> **心理价位与真实收益对比系统**
> 设计日期: 2025-01-09
> 设计状态: 🔄 初稿完成，待审查
> 提出者: 用户

---

## 📋 设计概述

### 核心目标

通过**心理价位**与**真实收益**的对比，建立创作者自我认知评估体系，同时制造话题性和数据指导价值。

### 关键创新

1. **截尾均值** - 抗刷单、更稳定的收益展示值
2. **价位吻合度** - 百分制自我认知评分
3. **溢价/折价标签** - 制造话题的直观标签

---

## 一、核心指标设计

### 1.1 截尾均值（Trimmed Mean）

**定义**: 去掉最高和最低各10%的打赏后的平均值

**计算规则**:
```python
def trimmed_mean(tips):
    """
    计算截尾均值
    tips: 打赏金额列表 [1, 2, 3, ..., 100]
    """
    n = len(tips)
    if n < 10:
        return sum(tips) / n  # 样本量小，使用算术均值

    # 去掉最高和最低各10%
    k = int(n * 0.1)
    sorted_tips = sorted(tips)
    trimmed = sorted_tips[k:n-k]
    return sum(trimmed) / len(trimmed)
```

**边界规则**:
- 打赏人数 ≥ 20人: 去掉最高/最低各10%
- 打赏人数 10-19人: 去掉最高/最低各1个
- 打赏人数 < 10人: 使用算术均值（标记"样本量小"）

**优势**:
- ✅ 抗刷单: 自动过滤极端值
- ✅ 比中位数稳定: 更好地反映整体水平
- ✅ 比算术均值公平: 不被少数极端值影响

**示例对比**:
```
打赏数据: [1,1,1,1,1,1,1,1,1,100]

- 算术均值: 10.9金币 ❌ (被刷单拉高)
- 中位数: 1金币 ❌ (忽略真实差异)
- 截尾均值: 1金币 ✅ (接近真实值)
```

### 1.2 价位吻合度

**定义**: 心理价位与真实收益的接近程度，百分制

**计算公式**:
```
吻合度 = max(0, 1 - |展示值 - 心理价| / 心理价) × 100%
```

**示例**:
- 心理价10金币，展示值9金币 → 吻合度 = 90%
- 心理价10金币，展示值5金币 → 吻合度 = 50%
- 心理价10金币，展示值15金币 → 吻合度 = 50%
- 心理价10金币，展示值0金币 → 吻合度 = 0%

**等级划分**:
- 90-100%: "精准预测" 🎯
- 70-89%: "接近预期" ✅
- 50-69%: "略有偏差" ⚠️
- <50%: "差距较大" ❌

### 1.3 溢价/折价标签

**定义**: 基于展示值与心理价的对比，给出直观标签

**标签规则**:
```
if 展示值 > 心理价 + 1:
    标签 = "被低估" 📈
    if 展示值 - 心理价 >= 3:
        标签 += " ⚠️" (红色叹号)
elif 展示值 < 心理价 - 1:
    标签 = "被高估" 📉
    if 心理价 - 展示值 >= 3:
        标签 += " ⚠️" (红色叹号)
else:
    标签 = "符合预期" ✅
```

**示例**:
- 心理价10，展示值15 → "被低估 📈"
- 心理价10，展示值14 → "被低估 📈 ⚠️" (差距≥3)
- 心理价10，展示值7 → "被高估 📉"
- 心理价10，展示值10 → "符合预期 ✅"

---

## 二、心理价位设定

### 2.1 填写时机

**位置**: 游戏提交流程步骤6.6（未完成作品选项之后，提交确认之前）

**UI设计**:
```
┌─────────────────────────────────────┐
│  设定您的心理价位                   │
│                                     │
│  您认为您的游戏值得多少金币打赏？    │
│                                     │
│  [___] 金币                          │
│                                     │
│  💡 这是您对作品价值的自我评估，     │
│     将影响"价位吻合度"统计。         │
│                                     │
│  参考范围: 1-20金币                  │
│  (平均打赏通常为1-3金币)             │
└─────────────────────────────────────┘
```

### 2.2 智能建议

**基于游戏类型的建议值**:
```javascript
const suggestedPrices = {
  "解谜": { min: 2, max: 5, average: 3 },
  "角色扮演": { min: 5, max: 10, average: 7 },
  "动作": { min: 3, max: 7, average: 5 },
  "策略": { min: 5, max: 10, average: 7 },
  "休闲": { min: 1, max: 3, average: 2 },
  "恐怖": { min: 3, max: 7, average: 5 },
  // ... 其他类型
};
```

**动态提示**:
- 用户选择"解谜"类型 → 提示"建议价位: 2-5金币"
- 用户选择"角色扮演" → 提示"建议价位: 5-10金币"

### 2.3 限制规则

**数值限制**:
- 最低值: 1金币
- 最高值: 20金币
- 超出范围: 提示"请在合理范围内设定"

**防滥用机制**:
```markdown
**极端值检测**:

1. **过于谦虚**:
   - 心理价1金币且实际>5金币
   - 标记: "过于谦虚 🏅"
   - 吻合度正常计算，但给予特殊标签

2. **过于自信**:
   - 心理价20金币且实际<5金币
   - 标记: "过于自信 💪"
   - 吻合度正常计算，但给予特殊标签

3. **历史一致性检查**:
   - 连续3次填1金币 → 提示"是否需要调整心理价位？"
   - 给出参考: "您的作品平均收益为X金币"
```

---

## 三、展示界面设计

### 3.1 游戏详情页

**收益统计卡片**:
```
┌─────────────────────────────────────┐
│  💰 游戏收益统计                    │
│                                     │
│  心理价位: 10金币                   │
│  实际收益(截尾均值): 15金币          │
│  价位吻合度: 50% ⚠️                 │
│  标签: 被低估 📈 ⚠️                 │
│                                     │
│  打赏详情:                          │
│  - 打赏人数: 50人                   │
│  - 打赏总额: 500金币                │
│  - 打赏分布: 1金币×30, 2金币×15,    │
│             3金币×4, 100金币×1(已过滤)│
└─────────────────────────────────────┘
```

### 3.2 个人作品分析面板

**自我认知分析**:
```
┌─────────────────────────────────────┐
│  📊 自我认知分析                    │
│                                     │
│  所有作品平均吻合度: 65%            │
│                                     │
│  历史记录:                          │
│  1. 游戏A: 心理价10, 实际15,        │
│     吻合度50% 📈被低估 ⚠️           │
│  2. 游戏B: 心理价20, 实际18,        │
│     吻合度90% ✅接近                │
│  3. 游戏C: 心理价5, 实际2,         │
│     吻合度40% 📉被高估              │
│                                     │
│  徽章成就:                          │
│  🎯 精准预测家: 吻合度>90% (3个作品) │
│  👑 黑马发现者: 被低估>10金币       │
└─────────────────────────────────────┘
```

### 3.3 赛季总结报告

**个人定价能力成长曲线**:
```
┌─────────────────────────────────────┐
│  📈 定价能力成长                    │
│                                     │
│  第1赛季: 平均吻合度40% (新手期)     │
│  第2赛季: 平均吻合度65% (成长期)    │
│  第3赛季: 平均吻合度85% (成熟期)    │
│                                     │
│  趋势: 你的自我认知越来越准确！ 🎉   │
└─────────────────────────────────────┘
```

---

## 四、数据指导作用

### 4.1 创作者市场洞察

**游戏类型收益对比**:
```
┌─────────────────────────────────────┐
│  🎯 游戏类型收益分析                │
│                                     │
│  【解谜游戏】                       │
│  - 平均打赏: 3.5金币                │
│  - 打赏人数: 平均25人               │
│  - "被低估"比例: 30%                │
│  - 推荐心理价位: 2-5金币             │
│                                     │
│  【您的作品】                       │
│  - 类型: 解谜                       │
│  - 收益: 5金币                      │
│  - 排名: 前20%                      │
│  - 吻合度: 80% ✅                   │
└─────────────────────────────────────┘
```

### 4.2 个人定价能力分析

**定价准确性报告**:
```markdown
## 定价能力雷达图

**评估维度**:
- 准确性: 平均吻合度85% 📊
- 稳定性: 标准差15% 📉
- 自信度: 平均心理价7金币 💪
- 市场敏感度: 偏离度<10% ✅

**建议**:
- 您的自我认知非常准确！
- 继续保持当前的定价策略
- 可以适当提高心理价位（平均收益高于心理价）
```

---

## 五、徽章与成就系统

### 5.1 定价能力徽章

| 徽章名称 | 获得条件 | 奖励 |
|---------|---------|------|
| 🎯 精准预测家 | 3个作品吻合度>90% | 荣耀徽章 |
| 👑 黑马发现者 | 5次"被低估"且差距>3金币 | 荣耀徽章 |
| 🏅 过于谦虚 | 3次"过于谦虚"标签 | 趣味徽章 |
| 💪 过于自信 | 3次"过于自信"标签 | 趣味徽章 |
| 📉 现实主义者 | 所有作品吻合度60-80% | 荣耀徽章 |

### 5.2 季度排行榜

**排行榜类型**:
1. **最准预测榜**: 按平均吻合度排名
2. **黑马发现榜**: 按"被低估"次数排名
3. **最受欢迎榜**: 按打赏总额排名

**展示规则**:
- 仅展示排名，不给予金币奖励
- 避免过度激励导致行为扭曲

---

## 六、技术实现要点

### 6.1 数据库表结构

```sql
-- 游戏心理价位表
CREATE TABLE_game_price_expectation (
  game_id INT PRIMARY KEY,
  expected_price DECIMAL(10,2) NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (game_id) REFERENCES games(game_id)
);

-- 打赏记录表（已有，扩展字段）
ALTER TABLE tips ADD COLUMN is_filtered BOOLEAN DEFAULT FALSE;
-- is_filtered: 是否被截尾均值过滤掉
```

### 6.2 计算逻辑

```python
def calculate_price_metrics(game_id):
    """
    计算游戏的价格指标
    """
    # 1. 获取所有打赏
    tips = get_all_tips(game_id)

    # 2. 计算截尾均值
    display_value = trimmed_mean(tips)

    # 3. 获取心理价位
    expected_price = get_expected_price(game_id)

    # 4. 计算吻合度
    accuracy = max(0, 1 - abs(display_value - expected_price) / expected_price)

    # 5. 生成标签
    if display_value > expected_price + 1:
        label = "被低估 📈"
        if display_value - expected_price >= 3:
            label += " ⚠️"
    elif display_value < expected_price - 1:
        label = "被高估 📉"
        if expected_price - display_value >= 3:
            label += " ⚠️"
    else:
        label = "符合预期 ✅"

    return {
        "display_value": display_value,
        "expected_price": expected_price,
        "accuracy": accuracy * 100,  # 百分比
        "label": label
    }
```

### 6.3 性能优化

**缓存策略**:
- Redis缓存截尾均值计算结果
- 每5分钟更新一次
- 打赏金额变化时清除缓存

**批量计算**:
- 使用后台任务队列（Celery/Bull）
- 每10分钟批量更新所有游戏的指标
- 避免实时计算的性能开销

---

## 七、预期效果

### 7.1 用户价值

**对创作者**:
- 了解作品的真实市场价值
- 提升自我定价能力
- 发现自己的优势与不足

**对评分者**:
- 了解游戏的受欢迎程度
- 参考他人的打赏行为
- 发现被低估的优质游戏

### 7.2 平台价值

**话题性**:
- "被低估"/"被高估"标签自然引发讨论
- 制造争议，增加平台活跃度
- 形成自传播内容

**数据积累**:
- 积累游戏类型与收益的关系数据
- 为后续推荐算法提供依据
- 优化平台经济模型

**用户粘性**:
- 创作者关注自己的吻合度变化
- 评分者好奇作品的实际收益
- 形成持续关注的心理激励

---

## 八、潜在问题待讨论

### 问题清单

- [ ] 心理价位的填写是否为必填？
- [ ] 如何防止用户故意填低心理价以获得"被低估"标签？
- [ ] 截尾均值的边界情况是否考虑周全？
- [ ] 是否需要考虑游戏类型的自然流量差异？
- [ ] 吻合度是否应该与任何系统奖励挂钩？
- [ ] 如何处理打赏人数<10的情况？
- [ ] 是否需要限制心理价位的修改次数？
- [ ] 赛季结束后心理价位是否需要归档？

---

**设计者**: 老黑(Claude)
**创建时间**: 2025-01-09
**状态**: 🔄 初稿完成，待深度审查
