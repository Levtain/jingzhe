# 惊蛰计划 - 系统架构总览

**文档版本**: v1.0
**创建日期**: 2025-01-08
**最后更新**: 2025-01-08
**设计状态**: 🔄 架构重构中

---

## 文档说明

本文档定义惊蛰计划的完整系统架构，明确各系统边界和职责，避免功能耦合和概念混淆。

**重构目标**:
- ✅ 将评分系统中的打赏、金币相关功能拆分到经济系统
- ✅ 将评分系统中的成就相关功能拆分到成就系统
- ✅ 独立经济系统，统一管理所有金币、打赏、奖励相关功能
- ✅ 独立成就系统，统一管理所有成就、徽章、称号相关功能
- ✅ 明确各系统的边界和接口

---

## 系统总览

### 核心系统列表（10个）

| 系统名称 | 优先级 | 状态 | 说明 |
|---------|-------|------|------|
| 1. 用户角色系统 | 🔴 P0 | ✅ 已完成 | 5种角色定义和权限管理 |
| 2. 团队系统 | 🔴 P0 | 🔄 进行中 | 组队、赛道、团队管理 |
| 3. 主题投票系统 | 🔴 P0 | ✅ 已完成 | 主题征集、筛选、三轮投票 |
| 4. 游戏提交系统 | 🔴 P0 | ⏳ 待设计 | 游戏提交、更新、版本管理 |
| 5. 评分系统 | 🔴 P0 | ✅ 已完成 | 6维度评分、排名计算 |
| 6. 排名系统 | 🔴 P0 | ✅ 已完成 | 12个独立榜单、优选游戏 |
| 7. 经济系统 | 🟡 P1 | ⏳ 待设计 | 金币、打赏、奖励、交易 |
| 8. 成就系统 | 🟢 P2 | ⏳ 待设计 | 成就、徽章、称号、奖励 |
| 9. 推荐系统 | 🟡 P1 | ⏳ 待设计 | 推荐位、危险边缘、智能推荐 |
| 10. 社区系统 | 🟡 P1 | ⏳ 待设计 | 评论、点赞、吐槽、私聊 |

### 支撑系统列表（5个）

| 系统名称 | 优先级 | 状态 | 说明 |
|---------|-------|------|------|
| 11. 反作弊系统 | 🔴 P0 | ⏳ 待设计 | 善意度、风控、异常检测 |
| 12. 内容审核系统 | 🟡 P1 | ⏳ 待设计 | 合规审核、敏感词过滤 |
| 13. 数据统计系统 | 🟡 P1 | ⏳ 待设计 | 用户行为分析、数据看板 |
| 14. 通知系统 | 🟢 P2 | ⏳ 待设计 | 站内信、邮件、推送通知 |
| 15. 后台管理系统 | 🔴 P0 | ⏳ 待设计 | 运营后台、配置管理 |

---

## 一、用户角色系统

### 系统边界
**核心职责**: 定义用户身份和权限，管理角色转化

### 包含功能
- ✅ 5种角色定义: 路人玩家、玩家、参赛者、评审团、管理员
- ✅ 角色权限矩阵: 每种角色的可用/不可用功能
- ✅ 角色转化规则: 评审团邀请、参赛者身份判定
- ✅ 页面级权限控制: 访问权限、操作权限

### 不包含功能（迁移到其他系统）
- ❌ 金币管理 → 迁移到经济系统
- ❌ 成就解锁 → 迁移到成就系统
- ❌ 团队角色 → 迁移到团队系统
- ❌ 评分权重 → 迁移到排名系统

### 相关文档
- [关键名词解释索引_v1.1.md](./关键名词解释索引_v1.1.md)
- [user-roles-and-permissions.md v0.2.0](./user-roles-and-permissions.md)

---

## 二、团队系统

### 系统边界
**核心职责**: 管理团队组建、赛道判定、团队成员关系

### 包含功能
- ✅ 团队规模: 1-9人（允许单人团队）
- ✅ 团队角色: 队长、副队长（最多2人）、普通成员
- ✅ 赛道判定: 提交时根据团队人数自动判定
- ✅ 成员管理: 主动退出、踢出、邀请
- ⏳ 组队时间窗口
- ⏳ 团队解散规则
- ⏳ 队长继承机制
- ⏳ 作品数量限制

### 不包含功能（迁移到其他系统）
- ❌ 团队内部分配奖励 → 迁移到经济系统
- ❌ 团队成就 → 迁移到成就系统
- ❌ 团队排名 → 迁移到排名系统

### 相关文档
- [团队系统设计文档_v1.0.md](./惊蛰计划-团队系统设计文档_v1.0.md)
- [team-system-discussion-2025-01-07.md](../development/issues/archive/team-system-discussion-2025-01-07.md)

---

## 三、主题投票系统

### 系统边界
**核心职责**: 管理比赛主题的征集、筛选、投票流程

### 包含功能
- ✅ 主题征集: 每人1个主题，1200个或7天停止
- ✅ 主题筛选: 多轮随机抽样投票（点赞冒泡）
- ✅ R1投票: 28个主题抽12个，选4个
- ✅ R2投票: 16个主题抽12个，选4个+4个未抽取=8个
- ✅ R3投票: 12个主题选4个最终主题
- ✅ 激励措施: 每日投1/3赞获得5金币

### 不包含功能（迁移到其他系统）
- ❌ 投票获得的金币 → 迁移到经济系统
- ❌ 投票成就 → 迁移到成就系统
- ❌ 投票反作弊 → 迁移到反作弊系统

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第3章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#3-主题征集与投票流程)

---

## 四、游戏提交系统

### 系统边界
**核心职责**: 管理游戏提交、更新、版本控制

### 包含功能
- ⏳ 游戏提交格式限制（exe、zip、网页链接？）
- ⏳ 游戏更新规则（Bug修复 vs 功能新增）
- ⏳ 更新次数限制
- ⏳ 版本管理（保留历史 vs 仅最新）
- ⏳ 变更内容高亮显示
- ⏳ AI使用申报（全原创/部分使用/全部使用）

### 不包含功能（迁移到其他系统）
- ❌ 游戏评分 → 迁移到评分系统
- ❌ 游戏排名 → 迁移到排名系统
- ❌ 游戏打赏 → 迁移到经济系统

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第5章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#5-游戏开发与提交规则)
- [questions.md - 游戏提交与更新规则](../development/issues/questions.md#3-游戏提交与更新规则)

---

## 五、评分系统（重构后）

### 系统边界
**核心职责**: 管理评分维度、评分提交、评分统计

**移除功能**（已迁移）:
- ❌ 评分打赏机制 → 迁移到经济系统
- ❌ 评分金币奖励 → 迁移到经济系统
- ❌ 评分成就 → 迁移到成就系统
- ❌ 用户权重公式 → 迁移到排名系统
- ❌ 截尾算法 → 迁移到排名系统

### 保留功能
- ✅ 6个评分维度定义（创新性、主题诠释、视觉效果、音乐音频、整体性、整活儿）
- ✅ 评分范围: 0-10分，支持0.5分档位
- ✅ 维度可选填规则（允许部分评分）
- ✅ 评分权限: 参赛者+评审团可评分
- ✅ 禁止自评: 不能给自己提交的游戏评分
- ✅ 评分修改: 允许无限次修改直到评分阶段结束
- ✅ 软性强制: 评价≥10个游戏
- ✅ AI使用处理: 申报制+争议仲裁+该维度不参与排名
- ✅ 反作弊监测: 高危监测、高频差评、评审团违规

### 相关文档
- [评分系统设计方案_v1.0.md](./评分系统设计方案_v1.0.md)
- [评分维度详细指南_v1.0.md](./评分维度详细指南_v1.0.md)
- [scoring-system-questions.md](../development/issues/scoring-system-questions.md)

---

## 六、排名系统

### 系统边界
**核心职责**: 计算排名、生成榜单、处理并列

### 包含功能
- ✅ 12个独立榜单: 6维度 × 2评分群体（参赛者组、评审团组）
- ✅ 优选游戏机制: 3个及以上维度前10 = 优选游戏
- ✅ 用户权重公式: W = 1 + 0.55×ln(1+n)
- ✅ 截尾均值算法: 按原始分数双侧截尾10%
- ✅ 加权平均: 根据用户权重计算最终分数
- ✅ 并列处理: 人次 → 方差 → 评审团占比
- ✅ 动态门槛: 第一届15人次
- ✅ 更新频率: 每小时批量更新
- ✅ 多游戏作品: 作为整体作品参与排名

### 不包含功能（迁移到其他系统）
- ❌ 排名奖励 → 迁移到经济系统
- ❌ 排名成就 → 迁移到成就系统

### 相关文档
- [排名系统设计文档_v1.0.md](./惊蛰计划-排名系统设计文档_v1.0.md)
- [排名系统算法方案-混合版_v1.0.md](./惊蛰计划-排名系统算法方案-混合版_v1.0.md)
- [排名系统决策记录.md](./排名系统决策记录.md)

---

## 七、经济系统（新建）

### 系统边界
**核心职责**: 管理金币流通、打赏交易、奖励发放

### 包含功能
- ✅ 金币种类
  - 参赛者基础金币
  - 评审团基础金币
  - 路人玩家基础金币
  - 注册奖励金币

- ✅ 金币获取方式
  - 评分奖励: 每次有效评分获得1金币
  - 主题投票奖励: 每日投1/3赞获得5金币
  - 活跃度奖励:（待确认规则）
  - 赛后结算: 收到的打赏等额金币（待确认范围）

- ✅ 金币消费方式
  - 评分打赏: 评分后必须打赏至少1金币（1-10档位）
  - 购买推荐位:（待确认价格）
  - 其他消费:（待设计）

- ✅ 金币流向
  - 评分者: -1金币（打赏）+1金币（奖励）= 0金币
  - 游戏开发者: +1金币（收到打赏）
  - 净成本: 0金币（激励评分但不阻碍参与）

- ⏳ 经济模型
  - 基础金币数额（参赛者、评审团、路人玩家）
  - 注册奖励数额
  - 活跃度奖励规则
  - 通胀控制机制

- ⏳ 交易记录
  - 打赏记录
  - 奖励记录
  - 消费记录
  - 余额查询

### 待确认问题
- [ ] 参赛者基础金币数额？
- [ ] 评审团基础金币数额？
- [ ] 路人玩家基础金币数额？
- [ ] 注册奖励金币数额？
- [ ] 活跃度奖励的规则？
- [ ] "赛后获得已收到赏金等额金币"是否适用于所有身份？

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第8章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#8-经济系统)
- [关键名词解释索引_v1.1.md - 经济系统](./关键名词解释索引_v1.1.md#经济系统)
- [questions.md - 经济系统具体数值](../development/issues/questions.md#5-经济系统具体数值)

---

## 八、成就系统（新建）

### 系统边界
**核心职责**: 管理成就解锁、徽章展示、称号奖励

### 包含功能（待设计）

#### 成就类型
- ⏳ 评分相关成就
  - 评分次数成就（首次评分、评分10次、评分50次、评分100次）
  - 获得好评成就（收到10次打赏、收到50次打赏）
  - 评分质量成就（评分分布合理、被采纳率高）

- ⏳ 游戏开发成就
  - 提交作品成就（首次提交、连续3届提交）
  - 优选游戏成就（单个优选、3个维度优选、全部优选）
  - 人气游戏成就（收到100次打赏、收到500次打赏）

- ⏳ 社区互动成就
  - 评论成就（评论10次、评论被点赞50次）
  - 打赏成就（打赏10次、打赏总额100金币）
  - 社交成就（好友数量、组队次数）

- ⏳ 特殊成就
  - 发现bug成就
  - 提出建议被采纳成就
  - 早期用户成就（第一届参赛）
  - 传奇成就（极少数人获得）

#### 成就奖励
- ⏳ 金币奖励
- ⏳ 徽章/称号
- ⏳ 特殊权限
- ⏳ 实体奖励（第一届?）

#### 成就展示
- ⏳ 个人资料页展示
- ⏳ 游戏详情页展示
- ⏳ 成就榜单

#### 成就难度分级
- ⏳ 简单: 大部分人能获得
- ⏳ 中等: 需要一定努力
- ⏳ 困难: 少数人获得
- ⏳ 传奇: 极少数人获得

### 待确认问题
- [ ] 成就具体类型和数量？
- [ ] 成就奖励具体内容？
- [ ] 成就难度分级标准？
- [ ] 成就展示方式？
- [ ] 成就是否有稀有度？

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第8章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#8-经济系统) （部分内容）
- [questions.md - 评分系统 # 成就系统详细设计](../development/issues/questions.md#4-评分系统核心规则--已完成大部分确认)

---

## 九、推荐系统

### 系统边界
**核心职责**: 管理推荐位分配、危险边缘作品推荐、智能推荐

### 包含功能
- ⏳ 推荐位机制
  - 12个推荐位分配
  - 系统保留给"危险边缘作品"
  - 购买推荐位的价格
  - 购买后推荐时长（24小时？48小时？）

- ⏳ 危险边缘作品
  - 判断标准（评分人次 < 多少？）
  - 计算公式
  - 推荐优先级

- ⏳ 时间段定义
  - 高峰时间段
  - 非高峰时间段
  - 动态调整

- ⏳ 智能推荐
  - 基于用户偏好
  - 基于游戏标签
  - 冷启动处理

### 待确认问题
- [ ] 12个推荐位中，系统保留几个给"危险边缘作品"？
- [ ] 购买推荐位的价格是多少金币？
- [ ] 购买后推荐多久？（24小时？48小时？）
- [ ] "高峰时间段"和"非高峰"如何定义？
- [ ] 如何判断游戏"评分人次不足20"？
- [ ] 推荐位是手动分配还是自动计算？
- [ ] 危险边缘的计算公式是什么？
- [ ] 非赛程推荐是手动吗？
- [ ] 首页游戏推荐位的具体机制？

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第9章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#9-推荐位与推荐机制)
- [questions.md - 推荐位机制细节](../development/issues/questions.md#6-推荐位机制细节)

---

## 十、社区系统

### 系统边界
**核心职责**: 管理用户互动、社区功能、内容交流

### 包含功能
- ⏳ 评论系统
  - 游戏评论
  - 评论点赞
  - 评论排序

- ⏳ 吐槽系统
  - 匿名吐槽
  - 吐槽分类
  - 吐槽管理

- ⏳ 私聊系统
  - 站内私聊
  - 组队招募
  - 消息通知

- ⏳ 交流社区
  - 日常交流
  - 组队信息
  - 经验分享

### 待确认问题
- [ ] 评论是否支持匿名？
- [ ] 吐槽是否需要审核？
- [ ] 私聊是否限制频率？
- [ ] 社区内容是否需要敏感词过滤？

### 相关文档
- [功能对比分析报告.md - 社区功能模块](../development/analysis/功能对比分析报告.md)

---

## 十一、反作弊系统

### 系统边界
**核心职责**: 检测异常行为、管理善意度、执行风控措施

### 包含功能
- ⏳ 善意度系统
  - 善意度计算公式
  - 善意度阈值
  - 反向衰减规则
  - 善意度可见性

- ⏳ 反作弊监测
  - 账号年龄限制
  - 投票速率限制
  - 异常评分模式
  - 小号检测

- ⏳ 处置流程
  - 警告
  - 降权
  - 封号
  - 永久禁止

### 待确认问题
- [ ] 善意度的具体计算公式？
- [ ] 善意度的阈值是多少？
- [ ] "超阈值后反向衰减"的具体规则？
- [ ] 善意度是否对用户可见？
- [ ] "账号年龄限制"具体是多少天？
- [ ] "投票速率限制"的具体规则？（每小时最多投几次？）
- [ ] "异常评分模式"如何定义？
- [ ] 反作弊触发后的处置流程？（警告？降权？封号？）

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第11章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#11-善意度反作弊与风控机制)
- [questions.md - 善意度系统](../development/issues/questions.md#7-善意度系统)
- [questions.md - 反作弊阈值](../development/issues/questions.md#8-反作弊阈值)

---

## 十二、内容审核系统

### 系统边界
**核心职责**: 管理内容合规、敏感词过滤、人工审核

### 包含功能
- ⏳ 自动审核
  - 敏感词过滤
  - 图片识别
  - 违规内容检测

- ⏳ 人工审核
  - 游戏内容审核
  - 评论内容审核
  - 举报处理

- ⏳ 举报机制
  - 举报入口
  - 举报分类
  - 举报处理流程

### 相关文档
- [内部系统设计文档_v0.3_extended.md 第12章](./惊蛰计划-内部系统设计文档_v0.3_extended.md#12-合规与内容审核)

---

## 十三、数据统计系统

### 系统边界
**核心职责**: 收集用户行为数据、生成统计报表、支持运营决策

### 包含功能
- ⏳ 用户行为分析
  - 评分行为统计
  - 浏览行为统计
  - 互动行为统计

- ⏳ 数据看板
  - 实时数据监控
  - 用户增长趋势
  - 活跃度分析

- ⏳ 数据导出
  - Excel导出
  - 数据分析报告

---

## 十四、通知系统

### 系统边界
**核心职责**: 管理各类通知推送、站内信、邮件通知

### 包含功能
- ⏳ 站内通知
  - 系统通知
  - 互动通知
  - 活动通知

- ⏳ 邮件通知
  - 重要邮件
  - 营销邮件
  - 验证邮件

- ⏳ 推送通知
  - 浏览器推送
  - 移动端推送

---

## 十五、后台管理系统

### 系统边界
**核心职责**: 提供运营后台、配置管理、数据管理

### 包含功能
- ⏳ 配置管理
  - 系统参数配置
  - 活动配置
  - 规则配置

- ⏳ 用户管理
  - 用户列表
  - 用户权限
  - 用户封禁

- ⏳ 内容管理
  - 游戏管理
  - 评论管理
  - 举报管理

- ⏳ 推荐位管理
  - 推荐位配置
  - 手动推荐
  - 推荐效果统计

- ⏳ 新闻管理
  - 新闻发布
  - 公告管理
  - 活动管理

- ⏳ 倒计时管理
  - 活动倒计时
  - 阶段倒计时
  - 提醒设置

### 相关文档
- [功能对比分析报告.md - 后台管理功能](../development/analysis/功能对比分析报告.md)

---

## 系统间依赖关系

### 核心依赖链

```
用户角色系统 (基础)
    ↓
团队系统、主题投票系统、游戏提交系统
    ↓
评分系统
    ↓
排名系统
    ↓
经济系统、成就系统 (激励反馈)
```

### 横向依赖

- **评分系统** → 依赖 → 用户角色系统、游戏提交系统
- **排名系统** → 依赖 → 评分系统、用户角色系统
- **经济系统** → 依赖 → 评分系统、排名系统、用户角色系统
- **成就系统** → 依赖 → 所有核心系统
- **推荐系统** → 依赖 → 评分系统、排名系统
- **社区系统** → 依赖 → 用户角色系统、游戏提交系统
- **反作弊系统** → 监控 → 所有系统

---

## 迁移计划

### 第一阶段：系统拆分（本次重构）
- ✅ 创建《系统架构总览》文档
- ⏳ 更新《评分系统设计方案》，移除经济和成就相关内容
- ⏳ 创建《经济系统设计文档》
- ⏳ 创建《成就系统设计文档》
- ⏳ 更新《关键名词解释索引》，添加经济系统和成就系统

### 第二阶段：文档同步
- ⏳ 更新《内部系统设计文档》，调整章节结构
- ⏳ 更新《questions.md》，按新系统分类问题
- ⏳ 更新《claude.md》和《CHANGELOG.md》

### 第三阶段：设计补充
- ⏳ 补充经济系统具体数值
- ⏳ 补充成就系统详细设计
- ⏳ 补充推荐系统具体机制

---

## 版本历史

- **v1.0** (2025-01-08): 初始版本，系统架构重构
  - 定义15个系统边界
  - 拆分评分系统为3个独立系统
  - 创建经济系统和成就系统

---

**下一步行动**:
1. 更新《评分系统设计方案》，移除经济和成就相关内容
2. 创建《经济系统设计文档》
3. 创建《成就系统设计文档》
4. 更新《关键名词解释索引》
5. 同步所有相关文档

---

**创建者**: Claude (老黑)
**审核者**: 蜡烛先生
