# 自然语言交互Prompt系统

> **目标**: 让用户用自然语言与AI交互，无需记住命令语法
> **创建时间**: 2025-01-11
> **版本**: v1.0

---

## 📚 系统架构

本系统包含4个核心Prompt，协同工作：

```
意图识别 (intent-recognition-prompt.md)
    ↓
会话上下文 (session-context-prompt.md)
    ↓
自然对话 (natural-conversation-prompt.md)
    ↓
推荐时机 (tool-timing-prompt.md)
```

---

## 🎯 核心理念

**用户永远不需要记住命令**

- ❌ 旧方式：用户需要记住 `/sync-docs`、`/check-progress` 等21个命令
- ✅ 新方式：用户说"同步一下"、"看看进度"，AI自动理解并调用

**对话优先，工具隐藏**

- 工具调用是后台操作
- 用户感觉在自然对话
- 不需要了解技术细节

---

## 📖 Prompt文档说明

### 1. [意图识别Prompt](./intent-recognition-prompt.md) - 核心映射

**作用**: 将用户的自然语言映射到相应的工具

**核心内容**:
- 意图→工具映射表
  - "看看进度" → `/check-progress`
  - "同步一下" → `/sync-docs`
  - "今天先这样" → `/daily-summary`
- 三种执行模式
  - 静默执行（查询类）
  - 确认执行（修改类）
  - 智能推荐（建议类）

**使用场景**: 每次用户输入时，先判断意图

---

### 2. [会话上下文Prompt](./session-context-prompt.md) - 情境理解

**作用**: 理解当前会话状态，做出符合上下文的响应

**核心内容**:
- 4个上下文维度
  - 任务上下文（我们在做什么）
  - 时间上下文（工作节奏）
  - 进度上下文（完成情况）
  - 用户意图上下文（想要什么）
- 5种典型场景处理
  - 刚开启会话
  - 正在讨论问题
  - 任务刚完成
  - 长时间未活动
  - 用户遇到困难

**使用场景**: 每次响应前，快速评估会话状态

---

### 3. [自然对话Prompt](./natural-conversation-prompt.md) - 交互风格

**作用**: 保持对话自然流畅，不机械

**核心内容**:
- 3种对话风格
  - 朋友式交流（推荐）
  - 专业助手式
  - 引导式（适合新手）
- 5个对话流程控制
  - 开始新会话
  - 处理查询请求
  - 执行操作前确认
  - 任务完成后推荐
  - 结束会话
- 4个对话陷阱（避免）
  - 过度机械
  - 过度主动
  - 过度解释
  - 打断思考

**使用场景**: 每次响应用户时，确保语气自然、流程顺畅

---

### 4. [推荐时机Prompt](./tool-timing-prompt.md) - 智能决策

**作用**: 判断何时推荐工具，避免过度打扰

**核心内容**:
- 4个黄金时机（强烈推荐）
  - 任务明确完成
  - 会话即将结束
  - 用户明确询问
  - 用户遇到困难
- 3个谨慎时机（需要判断）
  - 长时间未同步
  - 文档有质量问题
  - 用户刚来上班
- 4个禁止时机（不要推荐）
  - 用户正在深入思考
  - 用户已明确拒绝
  - 用户只是闲聊
  - 没有任何价值

**使用场景**: 每次考虑是否推荐工具时

---

## 🔄 工作流程

### 用户输入 → AI响应流程

```
1. 用户输入自然语言
   "看看进度到哪了"

2. 意图识别 (intent-recognition-prompt.md)
   → 识别为"查询进度"意图
   → 映射到 /check-progress 工具

3. 会话上下文判断 (session-context-prompt.md)
   → 当前处于"查询需求"状态
   → 应该"静默调用查询工具"

4. 决定执行方式
   → 使用"静默执行"模式
   → 直接调用，无需确认

5. 自然对话响应 (natural-conversation-prompt.md)
   → "好的，让我查看一下..."
   → [调用工具]
   → 显示结果

6. 判断是否推荐 (tool-timing-prompt.md)
   → 不是推荐时机（只是查询）
   → 不推荐其他工具
```

---

## 🎯 实际示例

### 示例1：查询进度

```
用户: 看看进度到哪了

AI思考:
  1. 意图识别: 查询类 → /check-progress
  2. 上下文: 用户想了解状态
  3. 执行方式: 静默执行
  4. 对话风格: 简洁直接

AI响应:
  好的，让我查看一下...

  [调用 /check-progress]

  📊 当前进度：96/149 (64%)

  今天完成了3个问题，进度不错！
```

### 示例2：完成任务后

```
用户: 这个问题确认了

AI思考:
  1. 意图识别: 任务完成
  2. 上下文: 一个问题刚结束
  3. 执行判断: 这是推荐时机
  4. 推荐工具: /sync-docs

AI响应:
  这个问题确认了！

  要同步文档吗？
  我会调用 /sync-docs 将已确认问题同步到设计文档
  （大约需要1-2分钟）

用户: 好

AI响应:
  [调用 /sync-docs]
```

### 示例3：结束会话

```
用户: 今天先这样

AI思考:
  1. 意图识别: 会话结束
  2. 上下文: 今天有进展
  3. 执行判断: 应该推荐总结
  4. 推荐工具: /daily-summary

AI响应:
  好的！今天完成了不少工作 🎉

  要生成今日总结吗？
  我会：
  - 记录完成的任务
  - 更新进度
  - 规划下一步

  （大约需要1分钟）

用户: 好

AI响应:
  [调用 /daily-summary]
```

### 示例4：正在讨论

```
用户: 推荐位机制怎么设计？权重如何计算？

AI思考:
  1. 意图识别: 讨论问题
  2. 上下文: 正在深入思考
  3. 执行判断: 不要打断
  4. 对话策略: 连贯回答

AI响应:
  [详细回答推荐位设计和权重计算，不推荐任何工具]

用户: 明白了，这个方案可以

AI思考:
  1. 意图识别: 任务完成
  2. 上下文: 讨论结束
  3. 执行判断: 现在可以推荐了

AI响应:
  好的，推荐位机制方案已确认！

  要同步文档吗？
```

---

## 🎨 设计原则

### 原则1：用户优先

```yaml
用户习惯:
  - 用自然语言表达
  - 不想记命令
  - 希望对话自然

AI行为:
  - 理解自然语言
  - 自动调用工具
  - 保持对话流畅
```

### 原则2：透明执行

```yaml
用户知情:
  - 知道AI要做什么
  - 可以选择接受/拒绝
  - 理解操作的影响

AI行为:
  - 明确告知操作内容
  - 说明时间和影响
  - 等待用户确认
```

### 原则3：智能识别

```yaml
不是机械匹配:
  ❌ "进度" → 总是调用 /check-progress
  ❌ "同步" → 总是调用 /sync-docs

而是理解意图:
  ✅ "进度如何？" → 查询进度
  ✅ "设计同步了吗？" → 可能只是询问
  ✅ "讨论完了" → 可能需要同步（推荐）
```

### 原则4：不打断

```yaml
不打断思考:
  - 用户正在讨论问题
  - 思路连贯
  - 不推荐工具

不打断工作:
  - 用户明确说不要
  - 不要重复推荐
  - 尊重用户选择
```

---

## 📊 效果对比

### 旧方式（命令式）

```
用户: /check-progress

AI: 📊 当前进度：96/149 (64%)

用户: /sync-docs

AI: 要同步文档吗？
     ...

用户: /daily-summary

AI: 要生成今日总结吗？
     ...
```

**问题**:
- ❌ 用户需要记住21个命令
- ❌ 每次都要打"/"前缀
- ❌ 不符合自然交流习惯

### 新方式（自然语言）

```
用户: 看看进度到哪了

AI: 好的，让我查看一下...
    📊 当前进度：96/149 (64%)
    今天完成了3个问题！

用户: 这个问题确认了

AI: 这个问题确认了！
    要同步文档吗？
    ...

用户: 今天先这样

AI: 好的！今天完成了不少工作 🎉
    要生成今日总结吗？
    ...
```

**优势**:
- ✅ 用户用自然语言
- ✅ 不需要记住命令
- ✅ 对话流畅自然
- ✅ AI主动推荐合适的工具

---

## 🚀 使用方法

### 对AI开发者

如果你在使用Claude Code或其他AI助手：

1. **将这些Prompt文件放入系统提示目录**
   ```
   .claude/prompts/
   ├── intent-recognition-prompt.md
   ├── session-context-prompt.md
   ├── natural-conversation-prompt.md
   └── tool-timing-prompt.md
   ```

2. **在系统提示中引用**
   ```markdown
   ## 自然语言交互指导

   请遵循以下Prompt文件中的指导：
   - [意图识别](./prompts/intent-recognition-prompt.md)
   - [会话上下文](./prompts/session-context-prompt.md)
   - [自然对话](./prompts/natural-conversation-prompt.md)
   - [推荐时机](./prompts/tool-timing-prompt.md)
   ```

3. **定期更新**
   - 根据用户反馈优化映射表
   - 调整推荐时机阈值
   - 改进对话风格

### 对用户

享受自然语言交互：

- ✅ 直接说你想做什么
- ✅ 不需要记住命令
- ✅ AI会理解并调用合适的工具
- ✅ 对话保持自然流畅

---

## 📈 持续优化

### 优化方向

```yaml
短期（v1.1）:
  - 根据用户反馈优化意图映射
  - 调整推荐时机阈值
  - 增加更多自然语言表达

中期（v1.2）:
  - 学习用户习惯
  - 个性化推荐策略
  - 智能上下文感知

长期（v2.0）:
  - 预测用户需求
  - 主动发现问题
  - 完全自然的交互
```

### 观察指标

```yaml
接受率:
  - 用户接受推荐的比例
  - 目标: >70%

打断率:
  - 用户拒绝推荐的比例
  - 目标: <30%

效率:
  - 完成任务所需的对话轮数
  - 目标: 平均<3轮

满意度:
  - 用户反馈的正面评价
  - 目标: >80%
```

---

## 🤝 贡献

如果你有改进建议：

1. 发现新的自然语言表达 → 添加到意图映射表
2. 发现更好的推荐时机 → 更新推荐时机Prompt
3. 发现有问题的地方 → 提出改进方案

---

## 📝 版本历史

### v1.0 (2025-01-11)

**初始版本**:
- ✅ 创建4个核心Prompt
- ✅ 定义意图→工具映射
- ✅ 建立三种执行模式
- ✅ 实现场景化指导

**覆盖工具** (8个命令工具):
- /check-progress
- /sync-docs
- /discuss
- /daily-summary
- /check-doc-quality
- /check-completion
- /task-planner
- /token-check

---

**版本**: v1.0
**创建时间**: 2025-01-11
**适用范围**: 所有命令工具的自然语言交互
**维护频率**: 根据用户反馈持续更新
