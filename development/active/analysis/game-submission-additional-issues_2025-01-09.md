# 游戏提交系统第二次审查报告

> **深度审查设计文档与需求文档的一致性**
> 审查日期: 2025-01-09
> 审查方式: 逐项对照需求文档v2.0与设计文档v1.0
> 审查结果: 发现5个新问题

---

## 📋 执行摘要

在确认硬核玩家赛道切换规则后，对游戏提交系统进行了第二次深度审查，发现：
- 🔴 **3个严重遗漏** - 需求文档有要求但设计文档完全缺失
- ⚠️ **2个潜在问题** - 需要进一步澄清的边界情况

---

## 🔴 严重遗漏 (3个)

### ❌ NE1: "未完成作品"选项完全缺失

**位置**:
- 需求文档 5.2节: "未完成作品选项"
- 设计文档: **完全缺失**

**需求要求**:
```markdown
#### 5.2 未完成作品选项
- **字段类型**: 复选框
- **选项**: ☑ 标记为"未完成作品"
- **说明**:
  > "未完成作品不参与评分和排名,但作者可以给其他游戏评分。
  > 适合:想展示作品但不想参与评选,或者作品未完成的情况。"
- **功能**:
  - 选择后在列表页标注"未完成"
  - 不出现在排名榜单中
  - 仍然可以下载、评论、点赞
```

**设计文档现状**:
- 设计文档中没有提到"未完成作品"选项
- 没有说明如何在提交流程中添加此选项
- 没有说明未完成作品的特殊处理逻辑

**影响**:
- 用户无法标记"未完成作品"
- 未完成的作品也会参与排名，可能影响评分公平性
- 与需求文档不符

**建议补充**:
```markdown
**步骤5.5: 未完成作品选项 (新增)**

**选项说明**:
- 复选框: ☐ 标记为"未完成作品"

**选择后的影响**:
1. 游戏列表页标注"未完成"标签
2. 不参与任何维度的评分和排名
3. 仍然可以被下载、评论、点赞
4. 作者仍可以给其他游戏评分

**UI提示**:
```
┌─────────────────────────────────────┐
│  ☐ 标记为"未完成作品"               │
│                                     │
│  未完成作品不参与评分和排名，       │
│  但仍可被下载、评论和点赞。         │
│                                     │
│  适合：想展示作品但不想参与评选，   │
│        或作品未完成的情况。         │
└─────────────────────────────────────┘
```

**数据表设计**:
```sql
games表添加字段:
- is_incomplete BOOLEAN DEFAULT FALSE
  -- 是否为未完成作品
  -- TRUE: 不参与排名
  -- FALSE: 正常参与排名
```

**API接口**:
```http
POST /api/games/:id/submit
Request Body:
{
  "confirm_checklist": true,
  "is_incomplete": true,  // 新增字段
  "source_code": { ... }
}
```
```

**决策问题**:
- [ ] 是否需要"未完成作品"选项?(建议需要)
- [ ] 应该放在哪个步骤?(建议放在步骤7提交确认之前)
- [ ] 未完成作品是否可以撤回后改为完成?(建议允许)

---

### ❌ NE2: "游戏类型Tag"步骤缺失

**位置**:
- 需求文档 2.1节: "游戏类型Tag (多选)"
- 设计文档: **步骤1-7中完全缺失**

**需求要求**:
```markdown
#### 2.1 游戏类型Tag (多选)
- **字段类型**: 下拉多选 + 搜索
- **必填**: ✅ 是
- **最少选择**: 1个
- **最多选择**: 5个
- **建议Tag列表**:
  - 动作、冒险、休闲、解谜、角色扮演、射击、策略、模拟、体育、竞速、恐怖、生存、教育、音乐、视觉小说
- **功能**:
  - 搜索过滤
  - 热门Tag排序
  - 支持自定义Tag(需审核)
```

**设计文档现状**:
- 设计文档的7步流程中没有"游戏类型Tag"步骤
- 仅在§7.3数据库设计中提到了`game_types`表
- 没有说明在哪个步骤选择游戏类型

**影响**:
- 用户无法选择游戏类型
- 数据库有`game_types`表但没有数据来源
- 游戏无法按类型分类和筛选

**建议补充**:
```markdown
**步骤3.5: 游戏类型选择 (新增)**

**位置**: 步骤3(游戏正文)之后，步骤4(媒体资源)之前

**字段要求**:
- 必填，最少1个，最多5个
- 支持搜索和过滤

**Tag列表**:
- 动作、冒险、休闲、解谜、角色扮演
- 射击、策略、模拟、体育、竞速
- 恐怖、生存、教育、音乐、视觉小说

**UI设计**:
```
┌─────────────────────────────────────┐
│  游戏类型 (至少选择1个，最多5个)    │
│                                     │
│  [搜索游戏类型...]                  │
│                                     │
│  热门:                              │
│  ☐ 动作  ☐ 冒险  ☐ 休闲  ☐ 解谜    │
│  ☐ 射击  ☐ 策略  ☐ 模拟  ☐ 角色    │
│                                     │
│  已选择 (2/5):                       │
│  [× 冒险] [× 解谜]                  │
│                                     │
│  预览: 您的游戏将被分类为"冒险、解谜"│
└─────────────────────────────────────┘
```

**验证规则**:
- 少于1个: 提示"请至少选择1个游戏类型"
- 超过5个: 禁止选择更多，提示"最多选择5个游戏类型"
```

**决策问题**:
- [ ] 游戏类型Tag是否必填?(建议必填)
- [ ] 最多选择几个?(建议5个)
- [ ] 是否允许自定义Tag?(建议不允许，第一届仅限固定选项)

---

### ❌ NE3: "AI使用披露"步骤缺失

**位置**:
- 需求文档 第三部分: "AI使用披露" (3.1-3.3)
- 设计文档: **步骤1-7中完全缺失**

**需求要求**:
```markdown
#### 3.1 AI工具使用声明
- **字段类型**: 单选(是/否)
- **必填**: ✅ 是
- **选项**:
  - ✅ 是,我在创作中使用了生成式AI工具
  - ❌ 否,我没有使用生成式AI工具
- **说明**: "选择是后,请在下方详细说明使用了哪些工具和资源"

#### 3.2 AI使用详情 (条件显示)
- **字段类型**: 文本域
- **显示条件**: 仅在3.1选择"是"时显示
- **必填**: 条件必填
- **提示**: "请详细说明:
  - 使用了哪些AI工具(如Midjourney、Suno、ChatGPT等)?
  - 用于生成哪些内容(美术、音乐、代码、文案等)?
  - AI生成内容占作品的比例?"

#### 3.3 AI使用影响说明
- **内容**: "根据比赛规则,使用AI的维度将不参与该维度的评分和排名。例如:如果使用AI生成美术,则'视觉效果'维度不参与排名。"
```

**设计文档现状**:
- 设计文档中没有"AI工具使用声明"步骤
- 仅有"步骤6: 评分维度退出"，但没有前置的AI使用说明
- 用户可能不理解为什么要退出某些维度

**影响**:
- 无法收集用户的AI使用情况
- 用户不知道何时应该退出评分维度
- 可能导致评分不公平

**建议补充**:
```markdown
**步骤5.5: AI使用披露 (新增)**

**位置**: 步骤5(链接与平台)之后，步骤6(评分维度退出)之前

**AI工具使用声明** (单选，必填):
- ○ 否,我没有使用生成式AI工具
- ○ 是,我在创作中使用了生成式AI工具

**选择"是"后显示AI使用详情**:
```
┌─────────────────────────────────────┐
│  AI使用详情                         │
│                                     │
│  请详细说明:                        │
│  - 使用了哪些AI工具?                │
│    (如Midjourney、Suno、ChatGPT等)  │
│  - 用于生成哪些内容?                │
│    (美术、音乐、代码、文案等)       │
│  - AI生成内容占作品的比例?          │
│                                     │
│  [文本域 - 最多500字符]             │
│                                     │
│  ⚠️ 使用AI的维度将不参与该维度的    │
│     评分和排名。请在下一步退出对应  │
│     的评分维度。                    │
└─────────────────────────────────────┘
```

**数据表设计**:
```sql
games表添加字段:
- ai_usage_declared BOOLEAN DEFAULT FALSE
  -- 是否声明使用AI
- ai_usage_details TEXT NULL
  -- AI使用详情 (选择"是"时必填)

-- 或使用独立表
CREATE TABLE game_ai_usage (
  id INT PRIMARY KEY,
  game_id INT NOT NULL,
  has_ai_usage BOOLEAN DEFAULT FALSE,
  ai_tools VARCHAR(255),  -- 使用的AI工具
  ai_content_types VARCHAR(255),  -- AI生成的内容类型
  ai_percentage INT,  -- AI内容占比
  details TEXT,  -- 详细说明
  FOREIGN KEY (game_id) REFERENCES games(id)
);
```

**API接口**:
```http
POST /api/games/:id/submit
Request Body:
{
  "confirm_checklist": true,
  "ai_usage": {  // 新增字段
    "declared": true,
    "tools": "Midjourney, ChatGPT",
    "content_types": "美术、文案",
    "percentage": 30,
    "details": "使用Midjourney生成角色立绘..."
  },
  "source_code": { ... }
}
```
```

**决策问题**:
- [ ] 是否需要"AI使用披露"步骤?(建议需要)
- [ ] AI使用详情是否必填?(建议条件必填)
- [ ] AI使用详情是否显示在游戏详情页?(建议不显示，仅管理员可见)

---

## ⚠️ 潜在问题 (2个)

### NE4: 赛季结束时的批量处理逻辑未定义

**场景描述**:
- 赛季结束时需要处理大量数据
- 硬核玩家标记需要批量移除
- Draft草稿需要批量清除
- 游戏状态需要更新

**当前设计**:
- 提到"赛季结束后移除硬核玩家标记"
- 提到"赛程结束后清除所有Draft"
- 但没有说明**如何批量处理**

**潜在问题**:
- 如果有1000个硬核玩家，如何批量移除标记？
- 如果有500个Draft，如何批量清除？
- 批量处理是否会影响系统性能？
- 是否需要后台任务队列？

**建议补充**:
```markdown
**赛季结束处理任务**:

**1. 硬核玩家标记移除**:
```sql
-- 批量移除硬核玩家标记
UPDATE users
SET is_hardcore_player = FALSE
WHERE is_hardcore_player = TRUE;

-- 记录历史
INSERT INTO user_hardcore_history
SELECT user_id, '2025春季赛', NOW()
FROM users
WHERE is_hardcore_player = TRUE;
```

**2. Draft草稿清除**:
```sql
-- 批量删除Draft
DELETE FROM games
WHERE status = 'draft'
AND deleted_at IS NULL;
```

**3. 游戏状态更新**:
```sql
-- 批量更新游戏状态
UPDATE games
SET season_status = 'past_season'
WHERE season_id = '2025春季赛';
```

**技术实现**:
- 使用后台任务队列 (如Celery、Bull)
- 分批处理，每批100条记录
- 处理完成后发送通知给管理员
```

**决策问题**:
- [ ] 赛季结束处理是否需要自动化?(建议需要)
- [ ] 是否需要手动触发?(建议手动触发+自动备份)

---

### NE5: 游戏类型与评分维度的关系未定义

**场景描述**:
- 用户选择"音乐"游戏类型
- 但退出了"音乐音频"评分维度
- **问题**: 这是否合理？

**当前设计**:
- 游戏类型选择和评分维度退出是独立的
- 没有说明两者的关系

**潜在问题**:
- 音乐类游戏退出音乐维度评分 → 不合理
- 视觉小说类游戏退出视觉效果维度 → 可能合理
- 缺少游戏类型与评分维度的关联规则

**建议补充**:
```markdown
**游戏类型与评分维度的关联**:

**默认规则**:
- 不强制关联，用户可自由选择退出哪些维度
- 但提供智能提示

**智能提示**:
```
如果用户:
1. 选择"音乐"游戏类型
2. 退出"音乐音频"维度

系统提示:
"⚠️ 您选择了'音乐'游戏类型，但退出了'音乐音频'维度。
这是否符合预期?"
```

**不强制理由**:
- 可能是纯音乐游戏，但音乐素材来自AI
- 给用户灵活选择权
```

**决策问题**:
- [ ] 是否需要游戏类型与评分维度的关联检查?(建议不需要，仅提示)

---

## 📊 问题优先级

| 问题编号 | 问题描述 | 严重程度 | 影响范围 | 建议优先级 |
|---------|---------|---------|---------|-----------|
| **NE1** | "未完成作品"选项缺失 | 🔴 高 | 需求一致性 | P0 (立即修复) |
| **NE2** | "游戏类型Tag"步骤缺失 | 🔴 高 | 需求一致性 | P0 (立即修复) |
| **NE3** | "AI使用披露"步骤缺失 | 🔴 高 | 需求一致性 | P0 (立即修复) |
| **NE4** | 赛季结束批量处理未定义 | ⚠️ 中 | 系统设计 | P1 (高优先级) |
| **NE5** | 游戏类型与评分维度关系未定义 | ⚠️ 中 | 用户体验 | P2 (中优先级) |

---

## 🎯 建议行动计划

### 第一阶段: 修复严重遗漏 (2-3小时)

**目标**: 补充设计文档中缺失的3个步骤

**任务清单**:
- [ ] **NE1**: 在设计文档中补充"未完成作品"选项
- [ ] **NE2**: 在设计文档中补充"游戏类型Tag"步骤
- [ ] **NE3**: 在设计文档中补充"AI使用披露"步骤

**产出物**:
- 设计文档v1.1 (补充NE1-NE3)

---

### 第二阶段: 补充技术细节 (1-2小时)

**目标**: 定义赛季结束处理和智能提示

**任务清单**:
- [ ] **NE4**: 设计赛季结束批量处理逻辑
- [ ] **NE5**: 定义游戏类型与评分维度的智能提示

**产出物**:
- 设计文档v1.2 (补充NE4-NE5)

---

## 💡 总结

### 核心发现

1. **3个严重遗漏**: 需求文档中有明确要求，但设计文档完全缺失
2. **2个潜在问题**: 需要进一步澄清的边界情况
3. **根本原因**: 设计文档创建时未逐项对照需求文档

### 关键建议

1. **P0优先级**: 立即补充NE1-NE3到设计文档
2. **P1优先级**: 设计赛季结束批量处理逻辑
3. **P2优先级**: 定义游戏类型与评分维度的智能提示

### 时间估算

- **修复NE1-NE3**: 2-3小时
- **补充NE4-NE5**: 1-2小时
- **总计**: 3-5小时完成所有修复

---

**审查完成时间**: 2025-01-09
**审查人员**: 老黑(Claude)
**下次审查**: 设计文档v1.1创建后
**相关问题**:
- [NE1-NE3]: 严重遗漏
- [NE4-NE5]: 潜在问题
- [EC1]: 已确认约束(硬核玩家赛道切换)
