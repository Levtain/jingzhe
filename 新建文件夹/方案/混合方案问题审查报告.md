# 混合方案深度审查 - 发现遗漏问题

> **审查日期**: 2025-01-07
> **审查人**: 老黑(Claude)
> **审查范围**: 混合方案 vs 待讨论问题清单 vs 惊蛰计划设计文档

---

## 🚨 严重遗漏问题

### 遗漏1: 混合方案与"排名门槛"规则的冲突 🔴🔴🔴

#### 问题描述

**questions.md中的规则**:
> ✅ 排名门槛: >20人次（参赛者 + 2×评审团）

**混合方案的算法**:
```python
# 混合方案没有考虑门槛判定在算法中的位置
def calculate_dimension_score(scores, scorer_group):
    # 直接计算，没有检查门槛
    ...
```

**问题**: 混合方案的算法流程中**没有明确门槛判定的时机**

---

#### 场景分析

**场景1: 游戏有15个参赛者评分 + 3个评审团评分**

**门槛判定**:
- 总人次 = 15 + 2×3 = 21 ✅ 达标

**问题**:
- 参赛者榜: 15个评分 < 20，是否应该参与排名？
- 评审团榜: 3个评分 < 10（假设评审团门槛），是否应该参与排名？

**当前设计**: 不清楚！

---

#### 问题1.1: 分榜单门槛 vs 总门槛

**核心问题**: 12个榜单是共用一个总门槛，还是每个榜单独立门槛？

**选项A**: 总门槛（当前设计）
- 规则: 总人次 > 20 → 12个榜单都参与排名
- 问题: 参赛者榜只有15个评分也能排名？不公平

**选项B**: 分榜单门槛
- 规则: 参赛者榜 > 20人次 **且** 评审团榜 > 10人次
- 问题: 与当前设计文档冲突

**选项C**: 混合门槛
- 规则: 总人次 > 20 **且** 单个榜单至少10个评分
- 问题: 复杂度高，可解释性差

**建议**: 需要明确！

---

### 遗漏2: 评审团权重×2在算法中的体现缺失 🔴🔴

#### 问题描述

**questions.md中的规则**:
> ✅ 评审团评分权重×2，仅影响人次统计

**混合方案的算法**:
```python
# 评审团榜算法
if scorer_group == 'judge':
    W_judge = 1.0  # 权重全部为1
```

**问题**: **评审团的权重×2只在门槛体现，在算法内部完全未体现！**

---

#### 场景分析

**游戏A**: 20个参赛者评分（平均8.0分）
- 门槛: 20 + 2×0 = 20 ✅
- 参赛者榜得分: 8.0
- 评审团榜: 不参与（0个评审团评分）

**游戏B**: 10个评审团评分（平均8.0分）
- 门槛: 0 + 2×10 = 20 ✅
- 参赛者榜: 不参与（0个参赛者评分）
- 评审团榜得分: 8.0

**问题**: 两个游戏门槛相同，得分相同，但权威性不同！

**更严重的问题**: 如果游戏B的评审团评分是7.0分，是否应该因为"评审团权重×2"而比游戏A的8.0分（参赛者）排名更高？

**当前混合方案**: 无法体现 ❌

---

#### 问题2.1: 评审团权威性如何体现？

**核心问题**: 在不计算总分的前提下，如何体现评审团的权威性？

**选项A**: 评审团榜作为主榜单
- 官方宣传强调"评审团推荐榜"
- 参赛者榜仅作参考
- **符合当前设计** ✅

**选项B**: 优选游戏优先看评审团榜
- 优选游戏判定时，评审团榜权重更高
- 需要修改优选游戏判定规则

**选项C**: 混合计算（违背不计算总分原则）
- 总分 = (参赛者得分 + 2×评审团得分) / 3
- ❌ 违背惊蛰计划核心原则

**建议**: 明确采用选项A

---

### 遗漏3: 用户权重与评审团权重的关系 🔴🔴

#### 问题描述

**混合方案的权重设计**:
- 参赛者: W = 1 + ln(1+n)，n为本届评分次数
- 评审团: W = 1.0（所有评审权重相同）

**问题**: **为什么评审团不使用用户权重？**

---

#### 场景分析

**评审团A**: 认真评分50次
- 当前设计: 权重 = 1.0
- 如果使用参赛者公式: 权重 = 1 + ln(51) ≈ 4.93

**评审团B**: 随意评分5次
- 当前设计: 权重 = 1.0
- 如果使用参赛者公式: 权重 = 1 + ln(6) ≈ 2.79

**问题**: 评审团A和评审团B权重相同，公平吗？

**可能的解释**:
- 理由1: 评审团都是专家，每个评审都会认真评分，无需权重激励
- 理由2: 评审团人数少，权重的区分度意义不大
- 理由3: 评审团的权威性已经通过"独立榜单"体现

**但**: 如果评审团A确实比评审团B更认真，是否应该有差异？

**建议**: 需要明确理由，并在规则说明中解释

---

### 遗漏4: AI使用维度的权重计算问题 🔴

#### 问题描述

**questions.md中的规则**:
> ✅ 使用AI制作的维度不参与排名

**混合方案的算法**:
```python
# 没有考虑AI使用的情况
def calculate_dimension_score(scores, scorer_group):
    # 所有维度统一计算
    ...
```

**问题**: **如果某个维度使用AI，该维度不参与排名，那么用户权重是否还计算该维度？**

---

#### 场景分析

**用户A**: 评分100次
- 其中20次是"视觉效果"维度（该游戏使用了AI）
- 另外80次是其他维度

**问题1**: 用户A的评分次数是100次还是80次？

**选项A**: 算100次
- 权重 = 1 + ln(101) ≈ 5.62
- 理由: 用户确实付出了努力

**选项B**: 算80次
- 权重 = 1 + ln(81) ≈ 5.40
- 理由: AI维度不参与排名，不应该计入权重

**问题2**: 如果算100次，那么用户可以通过大量评AI使用的维度来刷权重吗？

**场景**: 某用户专门找AI使用的游戏评分（因为这些游戏评分人少，容易刷权重）

**建议**: 需要明确AI维度是否计入权重

---

### 遗漏5: 团队作品与用户权重的关系 🔴

#### 问题描述

**questions.md中的规则**:
> ✅ 团队作品如何计入12个榜单？(待确认)

**混合方案的算法**:
```python
# 没有考虑团队作品的权重计算
def calculate_user_weight(score_count):
    return 1 + ln(1 + score_count)
```

**问题**: **团队成员退出后，其权重如何处理？**

---

#### 场景分析

**用户A**: 团队T的成员，评了100次游戏
- 权重 = 1 + ln(101) ≈ 5.62

**场景**: 用户A退出团队T（但保留作者身份）

**问题**: 用户A的评分次数是保留还是清零？

**选项A**: 保留
- 理由: 用户A确实付出了努力，不应该因为退出团队而惩罚
- 问题: 可能通过"加入团队 → 评100次 → 退出团队"来保留高权重

**选项B**: 清零
- 理由: 团队作品与个人作品应该分开计算
- 问题: 用户A的100次评分经验完全浪费？

**选项C**: 分开统计
- 个人评分次数: 用于个人作品排名
- 团队评分次数: 用于团队作品排名
- 问题: 复杂度翻倍

**建议**: 需要明确团队作品与用户权重的交互规则

---

## ⚠️ 中等遗漏问题

### 遗漏6: 用户权重的更新时机与性能 🟡🟡

#### 问题描述

**混合方案的算法**:
```python
# 用户权重基于评分次数
weight = 1 + ln(1 + score_count)
```

**问题**: **每次用户评分后，是否需要立即更新权重？**

---

#### 性能问题

**场景1**: 实时更新

用户A评了第50个游戏
1. 更新用户A的评分次数: 49 → 50
2. 重新计算用户A的权重: 4.01 → 4.02
3. **重新计算用户A之前评过的49个游戏的权重**
4. **重新计算这49个游戏的排名**

**性能问题**: 一次评分触发49个游戏重算！

---

**场景2**: 定时更新

每小时批量更新一次
1. 收集过去一小时的所有评分
2. 批量更新用户权重
3. 批量重算受影响的游戏排名

**问题**: 用户刚评分后，权重没变，体验不好

**建议**: 需要明确权重更新策略

---

### 遗漏7: 用户权重的"有效评分"定义 🟡

#### 问题描述

**混合方案中提到**: "本届比赛中的有效评分次数"

**问题**: **什么是"有效评分"？**

---

#### 边界情况

**情况1**: 用户给同一游戏同一维度多次评分
- 算1次还是多次？
- 如果算多次，会激励刷权重

**情况2**: 用户给出极端评分（如全1分）
- 算"有效"吗？
- 如果不算，谁来判定"无效"？

**情况3**: 用户中途退出比赛
- 之前的评分还算吗？
- 权重需要回溯调整吗？

**情况4**: 用户修改评分
- 算1次还是2次？
- 如果修改多次，是否只算最新一次？

**建议**: 需要明确定义

---

### 遗漏8: 截尾与权重的交互问题 🟡

#### 问题描述

**混合方案的算法**:
```python
# 步骤2: 加权
weighted_scores = [score * weight for score, weight in zip(scores, weights)]

# 步骤3: 截尾（基于加权后的分数）
trimmed = sorted(weighted_scores)[k:-k]
```

**问题**: **截尾是按"加权分数"截尾，还是按"原始分数"截尾？**

---

#### 场景对比

**假设10个评分**:

| 用户 | 原始分 | 权重 | 加权分 |
|------|--------|------|--------|
| A    | 10.0   | 5.0  | 50.0   |
| B    | 9.5    | 4.5  | 42.8   |
| C    | 9.0    | 4.0  | 36.0   |
| ...  | ...    | ...  | ...    |
| J    | 1.0    | 1.7  | 1.7    |

**选项A**: 按"加权分"截尾（当前设计）
- 去掉: 50.0（A的10分）和1.7（J的1分）
- 问题: 高权重用户的高分更容易被截掉 ❌

**选项B**: 按"原始分"截尾
- 去掉: 10.0（A）和1.0（J）
- 再去掉对应的权重: 5.0和1.7
- 问题: 截尾后平均权重 = (4.5+4.0+...)/8，如何还原？

**选项C**: 先按"原始分"截尾，再加权平均
- 步骤1: 去掉原始最高最低
- 步骤2: 对剩余的评分加权平均
- 问题: 与当前算法流程不符

**建议**: 当前算法按"加权分"截尾是否合理？

---

### 遗漏9: 并列处理中"加权人次"的计算 🟡

#### 问题描述

**questions.md中的规则**:
> ✅ 并列处理第二优先级: 有效评分人数多的优先

**混合方案隐患分析中建议**:
> ✅ 改用"加权评分人次" = Σ权重

**问题**: **混合方案的算法文档中并未更新并列处理规则！**

---

#### 修正建议

**当前设计文档中未包含**:
```python
# 并列处理规则（缺失！）
def tie_breaker(game_a, game_b):
    # 需要明确实现
    pass
```

**建议**: 补充完整的并列处理规则

---

### 遗漏10: 优选游戏判定与用户权重的交互 🟡

#### 问题描述

**questions.md中的规则**:
> ✅ 优选游戏: 3个及以上维度进入前10名

**问题**: **优选游戏判定是看参赛者榜还是评审团榜？还是两个都看？**

---

#### 选项分析

**选项A**: 分别判定
- 参赛者优选游戏: 3个维度进入参赛者榜前10
- 评审团优选游戏: 3个维度进入评审团榜前10
- 问题: 一个游戏可能既是"参赛者优选"又是"评审团优选"

**选项B**: 综合判定
- 需要综合考虑两个榜单
- 问题: 如何综合？不计算总分的前提下如何综合？

**选项C**: 仅看评审团榜
- 优选游戏 = 评审团优选游戏
- 理由: 评审团权威性更高
- 问题: 与"参赛者有话语权"的理念冲突

**建议**: 需要明确

---

## 💡 轻微遗漏问题

### 遗漏11: 用户权重的上限 🟢

#### 问题描述

**混合方案的权重公式**: W = 1 + ln(1+n)

**问题**: **权重是否有上限？**

---

#### 场景分析

**极端用户**: 评了1000次游戏
- 权重 = 1 + ln(1001) ≈ 7.91

**问题**:
1. 这个权重是否过高？（是普通用户的7.91倍）
2. 是否需要设置权重上限？（如最高5.0）
3. 如果设置上限，上限值是多少？

**建议**: 考虑设置权重上限

---

### 遗漏12: 用户权重的初始化 🟢

#### 问题描述

**混合方案的算法**: 基于用户评分次数计算权重

**问题**: **比赛开始时，所有用户的初始权重是多少？**

---

#### 场景分析

**比赛开始时刻**:
- 所有用户的评分次数 = 0
- 初始权重 = 1 + ln(1+0) = 1.0

**第一个评分者**:
- 评了1次游戏
- 权重 = 1 + ln(2) ≈ 1.69

**问题**:
1. 第一个评分者的权重立即从1.0跳到1.69？
2. 是否需要"预热期"（如前10次评分权重都是1.0）？
3. 初始权重应该是1.0还是其他值？

**建议**: 明确初始权重规则

---

### 遗漏13: 用户权重的显示规则 🟢

#### 问题描述

**混合方案**: 用户权重 = 1 + ln(1+n)

**问题**: **用户能看到自己的权重吗？**

---

#### 选项分析

**选项A**: 完全透明
- 显示: "你的当前权重: 3.39"
- 显示: "权重来自评分次数: 10次"
- 优点: 透明，激励用户多评分
- 缺点: 可能引发权重攀比

**选项B**: 部分透明
- 显示: "你的权重等级: 高（前20%）"
- 不显示具体数值
- 优点: 减少攀比，保持激励
- 缺点: 不够透明

**选项C**: 完全不透明
- 不显示权重
- 只在规则说明中解释
- 优点: 简单
- 缺点: 用户不理解为什么自己的评分影响小

**建议**: 明确用户权重的显示规则

---

### 遗漏14: 排名更新频率与权重更新 🟢

#### 问题描述

**questions.md中的待确认问题**:
> [ ] 排名更新频率是多少？（实时？每小时？手动？）

**混合方案的算法**: 没有明确更新频率

**问题**: **用户权重更新与排名更新是同步还是异步？**

---

#### 选项分析

**选项A**: 同步更新
- 每小时同时更新权重和排名
- 优点: 一致性好
- 缺点: 计算量大

**选项B**: 异步更新
- 权重实时更新，排名每小时更新
- 优点: 用户体验好
- 缺点: 数据可能不一致

**选项C**: 定期全量更新
- 每小时全量重算权重和排名
- 优点: 简单可靠
- 缺点: 用户体验稍差

**建议**: 明确更新策略

---

### 遗漏15: 用户权重的跨届处理 🟢

#### 问题描述

**混合方案的算法**: 权重基于"本届比赛中的评分次数"

**问题**: **第二届比赛时，第一届的评分次数是否保留？**

---

#### 选项分析

**选项A**: 每届独立
- 第二届开始时，所有用户权重重置为1.0
- 优点: 公平，新一届新开始
- 缺点: 老用户的经验浪费

**选项B**: 累计计算
- 第二届的权重 = 1 + ln(1 + 第一届次数 + 第二届次数)
- 优点: 老用户有优势
- 缺点: 新用户难以追赶

**选项C**: 部分保留
- 保留部分权重（如保留50%）
- 优点: 平衡新老用户
- 缺点: 复杂度高

**建议**: 明确跨届处理规则

---

## 📋 总结与建议

### 严重遗漏（必须解决）

| 遗漏 | 严重性 | 影响范围 | 解决难度 |
|------|--------|---------|---------|
| **1. 分榜单门槛规则** | 🔴🔴🔴 | 12个榜单公平性 | 困难 |
| **2. 评审团权威性体现** | 🔴🔴 | 榜单权威性 | 中等 |
| **3. 评审团用户权重** | 🔴🔴 | 评审团公平性 | 简单 |
| **4. AI维度权重计算** | 🔴🔴 | 权重公平性 | 中等 |
| **5. 团队作品权重** | 🔴🔴 | 团队系统集成 | 困难 |

### 中等遗漏（需要明确）

| 遗漏 | 严重性 | 影响范围 |
|------|--------|---------|
| **6. 权重更新时机** | 🟡🟡 | 性能与体验 |
| **7. 有效评分定义** | 🟡 | 权重公平性 |
| **8. 截尾与权重交互** | 🟡 | 算法正确性 |
| **9. 并列处理规则** | 🟡 | 排名公平性 |
| **10. 优选游戏判定** | 🟡 | 优选机制 |

### 轻微遗漏（可以接受）

| 遗漏 | 严重性 | 影响范围 |
|------|--------|---------|
| **11. 权重上限** | 🟢 | 极端情况 |
| **12. 初始权重** | 🟢 | 启动阶段 |
| **13. 权重显示规则** | 🟢 | 用户体验 |
| **14. 更新频率** | 🟢 | 性能与体验 |
| **15. 跨届处理** | 🟢 | 长期规划 |

---

## 🎯 优先行动建议

### 立即行动（第一届必须明确）

1. ✅ **明确分榜单门槛规则**（遗漏1）
   - 建议: 总门槛 > 20人次 + 单个榜单至少10个评分

2. ✅ **明确评审团权威性体现**（遗漏2）
   - 建议: 官方强调"评审团推荐榜"为主榜单

3. ✅ **明确AI维度是否计入权重**（遗漏4）
   - 建议: AI维度不参与排名，但仍计入权重（用户确实付出了努力）

4. ✅ **明确定义"有效评分"**（遗漏7）
   - 建议: 不同游戏 + 不同维度 + 最新一次

### 第二届优化（第一届可暂缓）

5. ⏳ 引入简化版贝叶斯平滑（冷启动保护）
6. ⏳ 引入权重上限机制
7. ⏳ 优化权重更新策略

---

## 📊 混合方案完成度评估

| 维度 | 计划完成度 | 实际完成度 | 缺口 |
|------|-----------|-----------|------|
| **核心算法** | 100% | 85% | 缺少门槛判定、AI处理 |
| **权重机制** | 100% | 70% | 缺少有效评分定义、上限、初始化 |
| **榜单架构** | 100% | 90% | 缺少分榜单门槛明确 |
| **并列处理** | 100% | 60% | 缺少加权人次规则 |
| **评审团处理** | 100% | 75% | 缺少权威性体现 |
| **团队集成** | 0% | 0% | 完全未考虑 |
| **AI处理** | 0% | 0% | 完全未考虑 |

**整体完成度**: **73%** ⚠️

**结论**: 混合方案**需要补充27%的内容**才能真正用于第一届！

---

*审查完成时间: 2025-01-07*
*审查人: 老黑(Claude)*
*版本: v1.0*
