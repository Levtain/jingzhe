# 惊蛰计划 - 游戏提交系统设计文档

**版本**: v1.1
**创建日期**: 2025-01-09
**最后更新**: 2025-01-09 (基于全部13个问题确认结果更新)
**设计状态**: ✅ 全部问题已确认，待技术实现
**相关文档**:
- [需求文档 v2.0](../../development/issues/game-submission-requirements-v2.md)
- [问题清单](../../development/issues/questions.md)
- [设计检视报告](../../development/analysis/game-submission-complete-review-summary_2025-01-09.md)
- [全部问题确认记录](../../development/issues/archive/game-submission-all-confirmed_2025-01-09.md)

---

## 文档概述

本文档定义惊蛰计划的游戏提交与版本管理系统，涵盖从草稿创建到正式提交的完整流程，以及源码上传（硬核玩家）机制。

**核心设计目标**：
- 简化提交流程，降低参赛者学习成本
- 防止并发冲突，确保多人协作安全
- 支持版本管理，平衡灵活性与公平性
- 激励开源分享，奖励硬核玩家

**系统复杂度**: ⭐⭐⭐⭐ (堪比评分系统和团队系统)

---

## 一、系统概述

### 1.1 系统定位

游戏提交系统是惊蛰计划的核心功能模块之一，负责：
- 接收参赛者提交的游戏作品
- 管理游戏版本和更新
- 支持草稿自动保存和多人协作
- 集成源码上传和硬核玩家机制

### 1.2 系统边界

**与团队系统的集成**：
- 作者列表自动同步团队快照
- 赛道选择基于团队人数自动判定
- 仅队长和副队长可提交/更新游戏

**与评分系统的集成**：
- 提交前确认退出哪些评分维度
- 评分期开始后版本锁定

**与经济系统的集成**：
- 硬核玩家获得每日额外金币（+50金币/天）
- 硬核玩家获得3次免费购买推荐位

**与成就系统的集成**：
- 硬核玩家自动解锁"开源贡献者"成就

### 1.3 核心流程

```
参赛者创建草稿 → 填写7步表单 → 确认提交
      ↓              ↓
   自动保存      提交时确认源码
      ↓              ↓
   排他锁保护    硬核玩家标记
      ↓              ↓
   赛程结束清除   每日金币奖励
```

---

## 二、提交流程设计

### 2.1 表单结构：单页长表单 + 左侧导航

**设计决策**：采用单页长表单，而非7个独立页面跳转。

**理由**：
- ✅ 用户体验流畅，可预览全局
- ✅ 减少页面跳转，降低加载时间
- ✅ 移动端友好（折叠左侧导航，顶部标签页）

**UI布局**：
```
┌─────────────────────────────────────────┐
│  [左侧导航区]      [右侧表单区]         │
│  ┌─────────┐    ┌──────────────────┐   │
│  │ 1. 标题 │    │ 游戏标题         │   │
│  ├─────────┤    │ [输入框]         │   │
│  │ 2. 简介 │    │                  │   │
│  ├─────────┤    │ 游戏简介         │   │
│  │ 3. 正文 │    │ [Markdown编辑器] │   │
│  ├─────────┤    │                  │   │
│  │ 4. 媒体 │    │ 封面图上传       │   │
│  ├─────────┤    │ 截图上传         │   │
│  │ 5. 链接 │    │                  │   │
│  ├─────────┤    │ 下载链接         │   │
│  │ 6. 维度 │    │ [多选框]         │   │
│  ├─────────┤    │                  │   │
│  │ 7. 确认 │    │ [提交按钮]       │   │
│  └─────────┘    └──────────────────┘   │
└─────────────────────────────────────────┘
```

**移动端适配**：
- 左侧导航折叠为顶部标签页
- 全屏显示当前步骤表单
- 支持手势滑动切换步骤

### 2.2 7步流程详细设计

#### 步骤1：游戏标题

**字段要求**：
- 必填，5-100个字符
- 实时字符计数："当前: 25/100 字符"

**验证规则**：
- 少于5个字符：提示"标题至少需要5个字符"
- 超过100个字符：提示"标题超出X个字符，请删减"

#### 步骤2：游戏简介

**字段要求**：
- 最多100个字符，最少无限制
- 可以为空
- 支持多行输入

**验证规则**：
- 超过100个字符：前端阻止输入，提示"超出X个字符，请删减"
- 实时字符计数："当前: 87/100 字符"

#### 步骤3：游戏正文

**编辑器选型**：toast-ui.editor 或 mavon-editor（现成库）

**功能要求**：
- Markdown语法支持
- 实时预览（左右分屏）
- 工具栏快捷插入（粗体、斜体、链接、图片等）
- 图片上传：自动插入`![alt](url)`语法

**字符限制**：
- 至少200个字符（防止提交空白）
- 无上限

**UI设计**：
```
┌─────────────────────────────────────────┐
│  [编辑区]              [预览区]         │
│  ┌─────────────┐      ┌──────────────┐  │
│  │ Markdown    │      │ 实时预览    │  │
│  │ 编辑器      │  →   │              │  │
│  │             │      │              │  │
│  └─────────────┘      └──────────────┘  │
│  [上传图片] [预览]                       │
└─────────────────────────────────────────┘
```

#### 步骤3.5：游戏类型选择 ✅ (2025-01-09新增)

**位置**：步骤3（游戏正文）之后，步骤4（媒体资源）之前

**字段要求**：
- 必填，最少1个，最多5个
- 支持搜索和过滤

**15个固定选项**：
动作、冒险、休闲、解谜、角色扮演、射击、策略、模拟、体育、竞速、恐怖、生存、教育、音乐、视觉小说

**UI设计**：
```
┌─────────────────────────────────────────┐
│  游戏类型 (至少选择1个，最多5个)         │
│                                         │
│  [搜索游戏类型...]                      │
│                                         │
│  热门:                                  │
│  ☐ 动作  ☐ 冒险  ☐ 休闲  ☐ 解谜        │
│  ☐ 射击  ☐ 策略  ☐ 模拟  ☐ 角色        │
│                                         │
│  已选择 (2/5):                          │
│  [× 冒险] [× 解谜]                      │
│                                         │
│  预览: 您的游戏将被分类为"冒险、解谜"    │
└─────────────────────────────────────────┘
```

**验证规则**：
- 少于1个：提示"请至少选择1个游戏类型"
- 超过5个：禁止选择更多，提示"最多选择5个游戏类型"

**理由**：
- 确保所有游戏都有分类标签
- 1个最低要求不高，用户容易接受
- 符合itch.io、Ludum Dare主流实践

#### 步骤4：媒体资源

**封面图上传**：
- 允许格式：PNG、JPG、JPEG、WebP
- 禁止格式：GIF（动图）
- 比例要求：16:9
- 推荐尺寸：**待定，随前端设计尺寸更新** ⚠️
- 最小分辨率：720p（1280x720）

**验证规则**：
- 前端检查：必须是 PNG/JPG/JPEG/WebP
- 前端检查：比例必须是16:9
- 低于推荐尺寸时提示："⚠️ 建议使用推荐尺寸，但允许提交"
- 不符合比例时：拒绝上传

**截图上传**：
- 数量限制：最少3张，最多5张截图 ✅ (2025-01-09确认)
- 格式要求：同封面图
- 用途：游戏详情页展示

**视频链接（外部嵌入）**：
- 支持平台：Bilibili、YouTube、Vimeo
- 嵌入方式：iframe标签
- 零存储成本

#### 步骤5：链接与平台

**下载链接**：
- 必填，支持多个平台
- 前端验证：URL格式正确性
- 后端验证：HEAD请求（5秒超时，失败仅警告）
- 支持网盘链接（百度网盘、Google Drive、OneDrive等）

**链接描述**：
- 必填，至少10个字符
- 用途：帮助用户理解下载链接和运行要求

**平台选择（多选）**：
- 至少选1个
- 选项：Windows / macOS / Linux / Web (HTML5) / Android / iOS

**引擎选择（单选）**：
- 固定选项：Unity / Unreal Engine / Godot / GameMaker / RPG Maker / Construct
- 自定义选项："自定义/其他" → 显示文本框

#### 步骤5.5：AI使用披露 ✅ (2025-01-09新增)

**位置**：步骤5（链接与平台）之后，步骤6（评分维度退出）之前

**AI工具使用声明**（单选，必填）：
- ○ 否，我没有使用生成式AI工具
- ○ 是，我在创作中使用了生成式AI工具

**选择"是"后显示AI使用详情**（多选，必填）：
```
┌─────────────────────────────────────────┐
│  AI使用详情                             │
│                                         │
│  您使用了AI生成哪些内容？(可多选)        │
│  ☐ 文本（剧情、对话、文案等）           │
│  ☐ 视觉资源（角色立绘、背景、UI等）     │
│  ☐ 音频资源（音乐、音效等）             │
│                                         │
│  ⚠️ 使用AI的维度将不参与该维度的        │
│     评分和排名。请在下一步退出对应       │
│     的评分维度。                         │
└─────────────────────────────────────────┘
```

**不收集**：
- ❌ 不收集使用了哪些工具
- ❌ 不收集AI内容占比

**数据隐私**：
- AI使用详情不显示在游戏详情页
- 仅管理员可见

**理由**：
- 帮助用户理解何时退出评分维度
- 确保评分公平性
- 简化填写负担（不收集工具和占比）
- 数据仅用于统计分析

#### 步骤6：评分维度退出

**用途**：标记游戏使用了AI辅助的维度

**6个维度**：
- 创新性
- 主题诠释
- 视觉效果
- 音乐音频
- 整体性
- 整活儿

**UI设计**：
```
退出哪些评分维度？（使用AI辅助的维度）
☐ 创新性  ☐ 主题诠释  ☐ 视觉效果
☐ 音乐音频  ☐ 整体性   ☐ 整活儿
```

**提示文字**：
"如果游戏在某些维度使用了AI辅助，可以选择退出该维度的评分。退出后的维度不参与排名，但仍可被其他维度推荐。"

#### 步骤6.5：未完成作品选项 ✅ (2025-01-09新增)

**位置**：步骤6（评分维度退出）之后，步骤7（提交确认）之前

**选项说明**：
- 复选框：☐ 标记为"未完成作品"

**UI设计**：
```
┌─────────────────────────────────────────┐
│  ☐ 标记为"未完成作品"                  │
│                                         │
│  未完成作品不参与评分和排名，但         │
│  仍可被下载、评论和点赞。               │
│                                         │
│  适合：想展示作品但不想参与评选，       │
│        或作品未完成的情况。              │
└─────────────────────────────────────────┘
```

**选择后的影响**：
1. 游戏列表页标注"未完成"标签
2. 不参与任何维度的评分和排名
3. 仍然可以被下载、评论、点赞
4. 作者仍可以给其他游戏评分

**完整规则**：

1. **提交截止前**：
   - 可撤回，修改后重新提交
   - 可切换为完成状态

2. **提交截止后**：
   - 未完成状态 → 不可被评分
   - 可撤回，且更新不需管理员确认
   - 只是不纳入评分排名

**理由**：
- 给予用户灵活性
- 鼓励展示未完成作品
- 不影响评分公平性

#### 步骤7：提交确认

**提交前自动验证** ✅ (2025-01-09新增)：
- 系统自动验证所有必填项
- 未填写的项显示**红框**高亮
- 提示用户必须完成所有必填项

**确认清单**：
- ☐ 我已确认以上信息无误
- ☐ 我已了解游戏提交后不可随意修改
- ☐ 我已了解评分期开始后版本锁定

**UI设计**：
```
┌─────────────────────────────────────┐
│  提交确认                            │
│                                      │
│  ❌ 请先完成以下必填项：             │
│  ┌─────────────────────────────────┐ │
│  │ [游戏标题] ← 红框高亮          │ │
│  │ [游戏类型] ← 红框高亮          │ │
│  │ [游戏截图] ← 红框高亮          │ │
│  └─────────────────────────────────┘ │
│                                      │
│  ✅ 所有必填项已完成                 │
│  ☐ 我已确认以上信息无误             │
│  ☐ 我已了解游戏提交后不可随意修改   │
│  ☐ 我已了解评分期开始后版本锁定     │
│                                      │
│  [返回修改] [确认提交]               │
└─────────────────────────────────────┘
```

---

## 三、草稿管理机制

### 3.1 唯一草稿规则

**核心规则**：每个团队同时只能有1个活跃Draft。

**触发时机**：
- 填写标题后立即自动保存
- 每30秒自动保存（如果有变更）
- 点击"保存为草稿"按钮

**Draft清理规则** ✅ (2025-01-09更新)：
- **赛季结束处理**：不删除，仅标记赛季归属
  ```sql
  UPDATE games
  SET season_status = 'past_season',
      visible_in_list = FALSE  -- 不在游戏列表显示
  WHERE status = 'draft'
  AND season_id = '2025春季赛';
  ```
- 提交游戏后自动清除该Draft
- 用户可手动删除Draft
- **理由**：尊重创作者，用户仍可在"我的草稿"中找到上赛季的未完成作品

**UI提示**：
```
您已有未完成的草稿：
[我的游戏草稿] 最后编辑: 2小时前
[继续编辑] [删除草稿]
```

### 3.2 草稿预览功能 ✅ (2025-01-09新增)

**功能**: 在Draft编辑页面添加"预览"按钮，预览游戏详情页的最终效果

**用户价值**：
- 实时查看游戏在列表页的展示效果
- 避免提交后发现排版问题
- 提升用户信心

**UI设计**：
```
[保存为草稿] [预览] [提交]
     ↓
[弹窗显示游戏详情页预览]
     ↓
[关闭预览]
```

### 3.3 排他锁机制

**编辑权限**：只有队长和副队长（最多2人）可以编辑Draft。

**排他锁规则**：
- 同一时间只有1人能编辑
- 15分钟TTL（无操作自动释放）
- 续租间隔：每2分钟自动续租

**双档TTL设计**：
- **正常TTL**：5分钟（用户有输入操作时）
- **空闲TTL**：15分钟（用户3分钟无输入时）

**接管机制** ✅ (2025-01-09更新)：
- 副队长点击"我来改" → 队长收到弹窗："副队长B申请接管"
- **20秒内无响应 → 自动交接**（原30秒）
- 队长拒绝 → 接管失败
- **无拒绝后限制**（不禁止再次申请）

**接管弹窗UI**：
```
┌─────────────────────────────────────┐
│  副队长B申请接管编辑权               │
│                                     │
│  副队长B希望编辑游戏草稿，是否同意?   │
│                                     │
│  ⚠️ 20秒内无响应将自动交接 ✅        │
│                                     │
│  [拒绝] [同意]                      │
└─────────────────────────────────────┘
```

**UI显示**：
```
[编辑] 按钮状态：
- 绿色"编辑" → 可点击，获得编辑权
- 橙色"A正在改 (还剩 N 分钟)" → 不可编辑
- 橙色按钮旁显示蓝色"我来改" → 申请接管
```

**网络断开恢复**：
- 检测到编辑权过期 → 提示"编辑权已过期，内容已保存到本地"
- 内容保存到localStorage
- 提供"恢复未保存内容"按钮

### 3.3 "我的游戏"页面UI设计 ✅ (2025-01-09新增)

**一句话对外规则**：
- 绿卡片 = 已锁定的正式作品
- 黄卡片 = 还能改的草稿
- 灰卡片 = 你撤回来的，可重新提交

**状态标签**（左上角 16×16 圆点 + 文字）：
- 🟢 已提交
- 🟡 草稿
- 🔘 已撤回（比红色友好，用灰色）

**卡片配色**：
- 已提交：白底 + 绿色左边框 4px
- 草稿：白底 + 黄色左边框 4px
- 已撤回：浅灰底 + 灰色左边框 4px

**操作按钮**（每卡片最多3个，按状态出现）：

| 状态 | 按钮1 | 按钮2 | 按钮3 |
|------|-------|-------|-------|
| 已提交 | [查看] | [撤回] | —— |
| 草稿 | [继续编辑] | [删除草稿] | —— |
| 已撤回 | [重新提交] | [查看] | [删除] |

**二次确认文案**：
- 删除草稿："草稿删除后不可恢复，确定？"
- 撤回已提交作品："撤回后作品不再参与评审，24h内可重新提交，确定？"
- 删除已撤回作品："删除后无法找回，确定？"

**交互细节**：
- 列表默认按「状态」再按「更新时间」倒序：已提交 > 草稿 > 已撤回
- 同一行内如果同时出现「已提交」+「草稿」，在顶部用8px间距分隔，并给出文字提示："你已有正式作品，仍可继续润色草稿，但提交后会替换旧作品。"

**实现成本**：
- 后端已有 status ENUM('draft','published','withdrawn')，接口直接复用
- 前端纯展示逻辑，0新接口，半天可提测

**验收标准**：
- ✅ 用户5秒内能说出哪张是正式作品
- ✅ 误点「删除」前必出二次确认
- ✅ 按钮不超过3个，移动端一屏刚好点中

---

## 四、赛道与团队规则

### 4.1 赛道选择规则

**自动判定**：
- 团队人数 > 1 → 自动锁定为**团队赛道**（不可选个人赛道）
- 团队人数 = 1 → 可选择：
  - ○ 个人赛道
  - ○ 团队赛道（单人团队）

**UI设计**：
```
赛道选择：
○ 个人赛道（1人团队）
● 团队赛道（当前团队人数：1人）

⚠️ 团队人数 > 1 时，个人赛道将自动锁定
```

### 4.2 赛道切换规则

**普通个人游戏 → 团队赛道**：✅ 允许
1. 个人赛道提交游戏（未公开源码）后想添加队友
2. 系统提示："个人赛道无法添加队友，是否切换到团队赛道？"
3. 用户点击"是" → 撤回游戏 → 回到Draft状态
4. 创建团队，邀请队友加入
5. 重新提交游戏（自动锁定为团队赛道）

**硬核玩家 → 团队赛道**：❌ **永久禁止**
- 硬核玩家身份绑定用户，一旦获得，永久保留
- 硬核玩家**不可放弃身份**
- 硬核玩家**不可切换到团队赛道**
- 理由：防止经济系统失衡（硬核玩家拥有推荐位购买特权）

**团队赛道 → 个人赛道**：❌ **不允许**（单向锁定）
- 系统提示："团队赛道无法切换到个人赛道"
- 理由：团队作品是集体成果，不能变成个人作品

**UI提示**：

**普通个人用户点击"添加队友"**：
```
⚠️ 个人赛道无法添加队友

如需添加队友，请：
1. 撤回当前游戏
2. 创建团队并邀请队友
3. 重新提交游戏（自动锁定为团队赛道）

[撤回游戏] [取消]
```

**硬核玩家点击"添加队友"**：
```
❌ 硬核玩家无法切换到团队赛道

硬核玩家身份绑定用户，一旦获得，永久保留。
如需添加队友，请在下一赛季以团队赛道参赛。

[了解硬核玩家规则] [关闭]
```

### 4.3 作者快照永久保留规则 ✅ (2025-01-09新增)

**核心理念**：
- **尊重每一位创作者**
- **参与创作 = 永久作者身份**
- **不可剥夺创作者的署名权**

**规则**：
1. **一旦提交，作者快照永久锁定**
2. **撤回后重新提交也不能修改作者列表**
3. **成员变更只能在撤回前完成，提交即锁定**
4. **防止"撤回-换人-重新提交"的滥用行为**

**场景示例**：
- 3人团队[A,B,C]提交游戏 → 记录作者快照[A,B,C]
- 撤回游戏 → 成员C退出团队
- 重新提交游戏 → 新的作者快照**仍是[A,B,C]**（不可修改）
- 理由：成员C参与了创作，就应该永久保留其作者身份

---

## 五、版本管理机制

### 5.1 可随时更新的内容

**简介封面**：
- ✅ 游戏简介
- ✅ 游戏正文
- ✅ 封面图
- ✅ 截图
- ✅ 视频链接
- **理由**：不影响游戏本体，公平性无冲突

### 5.2 评分期锁定内容

**游戏下载链接**：
- ❌ 评分期开始后不允许随意更新
- ✅ 仅在以下情况可修正：
  - 后端自动检测链接失效（404/403）
  - 用户举报链接失效
  - 管理员审核通过

**源码链接修改规则** ✅ (2025-01-09确认)：
- ✅ 评分期开始前：允许随时修改
- ❌ 评分期开始后：仅允许修正(需管理员审核)
- 理由：类似下载链接，源码链接也可能失效或填错

**紧急更新流程**：
1. 开发者提交申请：
   - 说明问题类型（链接失效/严重bug）
   - 提供修正方案（新链接/补丁说明）
2. 管理员审核：
   - 确认是严重bug或链接失效
   - 评估是否允许更新
   - 批准后允许更新
3. 更新后处理：
   - 更新历史中标记"紧急更新"
   - 已评分的用户可选择是否重新评分
   - 通知所有已评分用户

**严重bug定义**：
- 无法启动/崩溃
- 数据丢失/存档损坏
- 无法完成游戏流程

**链接失效处理**：
- 用户举报链接失效
- 系统自动邮件通知开发者
- 开发者**24小时内**修正链接
- 超时未修正：游戏隐藏+标记"链接失效"

### 5.3 赛季结束批量处理 ✅ (2025-01-09新增)

**处理方式**：手动触发 + 自动备份 + 分批处理

**处理任务**：

**1. 硬核玩家标记移除**：
```sql
-- 批量移除硬核玩家标记
UPDATE users
SET is_hardcore_player = FALSE
WHERE is_hardcore_player = TRUE;

-- 记录历史
INSERT INTO user_hardcore_history
SELECT user_id, '2025春季赛', NOW()
FROM users
WHERE is_hardcore_player = TRUE;
```

**2. Draft标记上赛季**：
```sql
-- 不删除，仅标记
UPDATE games
SET season_status = 'past_season',
    visible_in_list = FALSE  -- 不在游戏列表显示
WHERE status = 'draft'
AND season_id = '2025春季赛';
```

**3. 游戏状态更新**：
```sql
-- 批量更新游戏状态
UPDATE games
SET season_status = 'past_season'
WHERE season_id = '2025春季赛';
```

**技术实现**：
- 使用后台任务队列 (如Celery、Bull)
- 分批处理，每批100条记录
- 处理完成后发送通知给管理员
- 手动触发 + 自动备份

---

## 六、源码上传机制（仅限个人赛道）

### 6.1 触发流程

**个人赛道提交时弹出对话框**：
```
┌─────────────────────────────────────┐
│  是否愿意公开游戏源码？               │
│                                     │
│  公开源码可获得 [硬核玩家身份] 🔗    │
│  （点击查看硬核玩家详情）            │
│                                     │
│  [是，我愿意公开源码]  [否，跳过]     │
└─────────────────────────────────────┘
```

**选择"是"后显示**：
```
┌─────────────────────────────────────┐
│  请输入源码链接                      │
│                                     │
│  [GitHub/GitLab/其他平台链接]        │
│                                     │
│  ⚠️ 源码链接将在游戏详情页公开显示   │
│  ⚠️ 硬核玩家身份绑定用户，一旦获得， │
│     永久保留，不可放弃，不可切换到   │
│     团队赛道                         │
│                                     │
│  [确认提交]  [取消]                  │
└─────────────────────────────────────┘
```

**源码链接二次确认弹窗** ✅ (2025-01-09新增)：
```
┌─────────────────────────────────────┐
│  确认源码链接                        │
│                                     │
│  您填写的源码链接：                  │
│  https://github.com/username/game    │
│                                     │
│  ⚠️ 链接将在游戏详情页公开显示       │
│  ⚠️ 硬核玩家身份绑定用户，一旦获得， │
│     永久保留，不可放弃，不可切换到   │
│     团队赛道                         │
│                                     │
│  [确认提交]  [返回修改]              │
└─────────────────────────────────────┘
```

**团队赛道**：无源码上传选项（直接跳过）

### 6.2 硬核玩家标记与奖励

**获得条件**：
- 个人赛道（团队规模1人）
- 提交游戏时选择公开源码
- 提供源码链接（GitHub/GitLab等）

**硬核玩家身份规则**：
- ⚠️ **身份绑定用户**：一旦获得，该用户成为硬核玩家
- ⚠️ **永久保留**：不可放弃身份
- ⚠️ **不可切换赛道**：硬核玩家永远以个人赛道参赛
- ⚠️ **赛季结束处理**：移除"硬核玩家"标记，但保留"开源贡献者"成就
- 理由：防止经济系统失衡（硬核玩家拥有推荐位购买特权）

**奖励机制**：

**1. 每日额外金币收益**：
- 基础金币：100金币/天（所有参赛者）
- 硬核玩家额外：+50金币/天
- 硬核玩家总计：150金币/天
- **哪天公开源码就从哪天开始计算**
- 触发时间：评分阶段开始后
- 截止时间：赛程结束
- **自动发放**（无需手动领取）

**示例**：
- 评分期12天
- 第3天公开源码 → 获得第3-12天的收益（10天×50=500金币）

**2. 免费购买推荐位**：
- 次数：3次免费机会
- 用途：给自己的游戏购买推荐位
- **直接免费**（扣除0金币）

**3. 荣誉标识**：
- 游戏详情页显示"硬核玩家"徽章
- 个人主页显示"硬核玩家"标签

**4. 成就解锁**：
- 自动解锁成就"开源贡献者"
- 奖励：+20金币
- **永久保留**（赛季结束后仍保留）

### 6.3 源码验证机制

**三层验证**：

**1. 前端验证（即时）**：
- 验证URL格式
- 常见域名白名单（GitHub、GitLab、Gitee等）
- 拦截危险协议（javascript:, data:）

**2. 后端验证（异步，5秒超时）**：
- HEAD请求检查HTTP状态码
- 允许的HTTP状态：200, 301, 302
- **验证失败不阻止提交**，仅显示警告 ⚠️
- 特殊平台（私有仓库）仅验证格式

**3. 用户举报机制**：
- 游戏详情页提供"举报源码链接失效"按钮
- 用户提交举报 → 管理员审核
- 确认失效后：
  - 撤销硬核玩家标记
  - 收回已发放的额外金币（从当天开始计算）
  - 警告用户
  - 多次恶意作弊封号

---

## 七、数据库设计

### 7.1 软删除策略

**所有表添加字段**：
```sql
deleted_at DATETIME NULL
```

**查询规则**：
- 正常查询：`WHERE deleted_at IS NULL`
- 软删除：`UPDATE SET deleted_at = NOW()`

### 7.2 外键约束设计

**games表**：
```sql
team_id INT NULL,
FOREIGN KEY (team_id) REFERENCES teams(id)
  ON DELETE SET NULL,  -- 团队删除时保留游戏
  ON UPDATE CASCADE
```

**game_media表**：
```sql
game_id INT NOT NULL,
FOREIGN KEY (game_id) REFERENCES games(id)
  ON DELETE CASCADE,  -- 删除游戏时自动删除媒体
  ON UPDATE CASCADE
```

**game_authors表**：
```sql
-- 不设置外键到team_members表
-- 独立快照数据
game_id INT NOT NULL,
user_id INT NOT NULL,
team_id INT,
author_name VARCHAR(100),
author_role VARCHAR(20),
is_original_author BOOLEAN,
snapshot_at DATETIME,
current_status VARCHAR(50)  -- 正常/已退出/已移除/团队解散
```

### 7.3 表结构设计

**保留独立的表**：
- `game_dimensions`（评分维度退出表）：6个布尔字段
- `game_types`（游戏类型标签表）
- `game_platforms`（游戏平台标签表）
- `game_engines`（游戏引擎标签表）

**分表设计理由**：
- 三类数据语义不同，分表更清晰
- 查询更明确（`JOIN game_platforms` 而非 `WHERE tag_type='platform'`）
- 便于后续扩展

---

## 八、API接口设计

### 8.1 草稿管理接口

**创建草稿**：
```http
POST /api/games/draft
Request Body:
{
  "title": "游戏标题",
  "team_id": 123
}
Response:
{
  "draft_id": 456,
  "edit_token": "uuid",
  "token_ttl": "2025-01-09 12:35:00"
}
```

**获取草稿**：
```http
GET /api/games/draft/:id
Response:
{
  "draft_id": 456,
  "title": "游戏标题",
  "description": "游戏简介",
  "content": "游戏正文",
  "cover_image": "封面图URL",
  "last_edited_at": "2025-01-09 12:30:00",
  "last_edited_by": "队长A",
  "is_editing": false
}
```

**更新草稿（排他锁）**：
```http
PUT /api/games/draft/:id
Request Headers:
  X-Edit-Token: uuid
Request Body:
{
  "description": "更新后的简介"
}
Response:
{
  "success": true,
  "message": "草稿更新成功"
}
```

**排他锁冲突响应**：
```json
{
  "error": "edit_token_expired",
  "message": "编辑权已过期，内容已保存到本地",
  "draft_data": { /* 草稿内容 */ }
}
```

### 8.2 游戏提交接口

**提交游戏**：
```http
POST /api/games/:id/submit
Request Body:
{
  "confirm_checklist": true,
  "source_code": {  // 仅个人赛道
    "enabled": true,
    "url": "https://github.com/username/game"
  }
}
Response:
{
  "game_id": 789,
  "status": "published",
  "is_hardcore_player": true,
  "message": "游戏提交成功！您已成为硬核玩家"
}
```

**撤回游戏**：
```http
POST /api/games/:id/withdraw
Response:
{
  "success": true,
  "draft_id": 456,
  "message": "游戏已撤回，可继续编辑后重新提交"
}
```

**更新游戏信息**：
```http
PUT /api/games/:id
Request Body:
{
  "description": "更新后的简介",
  "cover_image": "新封面图URL"
}
Response:
{
  "success": true,
  "message": "游戏信息更新成功"
}
```

---

## 九、安全性和性能

### 9.1 并发控制

**排他锁防止并发冲突**：
- 数据库单行UPDATE实现排他锁
- 乐观锁：记录最后编辑时间和编辑者
- 自动保存时检测冲突，提示用户

### 9.2 数据安全

**软删除防止数据丢失**：
- 所有表添加`deleted_at`字段
- 查询时过滤已删除数据
- 重要数据保留历史记录

**前+后端双重验证**：
- 前端验证：即时反馈，提升用户体验
- 后端验证：确保数据安全

### 9.3 性能优化

**自动保存机制**：
- 30秒自动保存（减少数据丢失风险）
- 节流保存请求（避免频繁写入数据库）

**缓存策略**：
- 草稿列表缓存5分钟
- 游戏详情缓存1小时
- 排名计算缓存1小时

---

## 十、边界场景处理

### 10.1 团队成员变更

**场景**：队伍提交游戏后，成员退出或被移除

**处理规则**：
- 保留作者身份（提交时就锁定了）
- 标注状态："已退出团队" / "已移出团队"
- 游戏详情页显示状态，让用户知情

**UI显示**：
```
作者列表：
[头像] 张三 (队长) ✅
[头像] 李四 (已退出团队) ⚠️
[头像] 王五 (已移出团队) ⚠️
```

### 10.2 Draft过期

**场景**：用户创建Draft后长期不编辑

**处理规则**：
- 赛程结束后自动清除所有Draft
- 提交游戏后自动清除该Draft
- 7天未编辑的Draft自动删除

### 10.3 网络断开

**场景**：用户编辑Draft时网络断开

**处理规则**：
- 前端检测到网络恢复
- 尝试自动保存
- 如果编辑权过期：
  - 提示"编辑权已过期，内容已保存到本地"
  - 将内容保存到localStorage
  - 提供"恢复未保存内容"按钮

### 10.4 浏览器关闭

**场景**：用户手滑点击浏览器关闭按钮

**处理规则**：
```javascript
window.addEventListener('beforeunload', (e) => {
  if (hasUnsavedChanges()) {
    e.preventDefault();
    e.returnValue = '您有未保存的内容，确定要离开吗？';
  }
});
```

---

## 十一、UI/UX设计要点

### 11.1 实时反馈

**字符计数**：
- 所有文本输入框显示实时字符计数
- 格式："当前: 87/100 字符"
- 不足时提示："还需13个字符"
- 超出时提示："超出3个字符，请删减"

**保存状态**：
- 底部灰字显示："上次自动保存: 12:34"
- 自动保存时显示："正在保存..."
- 保存成功显示："已保存"

### 11.2 错误提示

**友好提示**：
- ❌ "提交失败，标题不能为空" → ✅ "请先填写游戏标题"
- ❌ "URL格式错误" → ✅ "请输入有效的链接地址"
- ❌ "文件过大" → ✅ "图片大小不能超过5MB"

**具体指导**：
- ❌ "验证失败" → ✅ "封面图必须是16:9比例，当前尺寸为4:3"

### 11.3 引导提示

**首次使用提示**：
- 第一次进入提交页面：显示引导教程
- 高亮关键功能：保存为草稿、提交、撤回
- 提供"跳过教程"选项

**操作提示**：
- 填写标题后：提示"标题已自动保存为草稿"
- 选择个人赛道后：
  - 如果未勾选"公开源码"：提示"提交后可切换到团队赛道"
  - 如果勾选"公开源码"：提示"⚠️ 成为硬核玩家后永久保留身份，不可切换到团队赛道"
- 选择团队赛道后：提示"团队赛道提交后不可切换到个人赛道"
- 勾选"公开源码"后：提示"⚠️ 硬核玩家身份绑定用户，一旦获得，永久保留，不可放弃，不可切换到团队赛道"
- 提交前：提示"提交前请确认所有信息无误"

---

## 十二、总结

### 12.1 核心设计决策

1. **单页长表单**：提升用户体验，减少页面跳转
2. **唯一草稿**：简化逻辑，避免混淆
3. **排他锁机制**：防止多人协作冲突
4. **双档TTL**：平衡用户体验和资源占用
5. **软删除**：保留数据，防止误删
6. **源码上传仅限个人赛道**：激励开源，避免经济失衡
7. **硬核玩家身份绑定用户**：一旦获得，永久保留，不可放弃，不可切换赛道
8. **作者快照永久保留**：尊重每一位创作者，参与创作=永久作者身份 ✅ (2025-01-09新增)
9. **Draft赛季保留**：不删除，仅标记上赛季，尊重创作者 ✅ (2025-01-09新增)

### 12.2 待实现功能

**基础功能**：
- [ ] 前端表单组件开发（7步流程）
- [ ] 排他锁机制实现（20秒自动交接）
- [ ] 自动保存功能（30秒间隔）
- [ ] Markdown编辑器集成
- [ ] 源码上传功能（含二次确认弹窗）

**新增功能** ✅ (2025-01-09)：
- [ ] 游戏类型选择（步骤3.5）
- [ ] AI使用披露（步骤5.5）
- [ ] 未完成作品选项（步骤6.5）
- [ ] "我的游戏"页面UI（状态标签+分色卡片）
- [ ] 草稿预览功能
- [ ] 提交前自动验证（红框高亮）
- [ ] 赛季结束批量处理

**后台功能**：
- [ ] 硬核玩家金币自动发放
- [ ] 用户举报机制
- [ ] 赛季结束手动触发界面

### 12.3 技术选型建议

- **前端框架**：React / Vue
- **Markdown编辑器**：toast-ui.editor / mavon-editor
- **状态管理**：Redux / Vuex
- **后端框架**：Spring Boot / Express
- **数据库**：MySQL 8.0+
- **缓存**：Redis

---

**文档版本**: v1.1
**创建日期**: 2025-01-09
**最后更新**: 2025-01-09 (基于全部13个问题确认结果更新)
**维护人**: 老黑（Claude）
**状态**: ✅ 全部问题已确认，设计完成，待技术实现

**v1.1更新内容**：
- ✅ 补充步骤3.5：游戏类型选择（必填1-5个）
- ✅ 补充步骤5.5：AI使用披露（简化版）
- ✅ 补充步骤6.5：未完成作品选项
- ✅ 更新截图数量：3-5张
- ✅ 添加源码链接修改规则
- ✅ 添加"我的游戏"页面UI设计
- ✅ 添加作者快照永久保留规则
- ✅ 更新排他锁接管时间：20秒
- ✅ 添加草稿预览功能
- ✅ 添加提交前自动验证
- ✅ 添加源码链接二次确认
- ✅ 添加赛季结束批量处理