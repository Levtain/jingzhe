# 文档质量检查命令

> **命令**: `/check-doc-quality`
> **版本**: v1.0
> **创建时间**: 2025-01-11
> **目的**: 快速检查文档质量，发现格式、完整性、引用、版本号等问题

---

## 📋 命令功能

### 核心能力

1. **格式检查** (P0 - 必查)
   - Markdown格式是否正确
   - 标题层级是否合理
   - 代码块语言标识
   - 表格格式是否完整

2. **内容完整性** (P0 - 必查)
   - 必需章节是否存在
   - 版本号是否完整
   - 更新日期是否标注
   - 关键信息是否缺失

3. **交叉引用** (P0 - 必查)
   - 内部链接是否有效
   - 外部链接是否可访问
   - 文件路径是否正确
   - 引用版本号是否匹配

4. **版本号一致性** (P0 - 必查)
   - 文档内版本号一致
   - 交叉引用版本号一致
   - CHANGELOG版本号一致

5. **命名规范** (P1 - 检查项)
   - 文件名符合规范
   - 标题格式统一
   - 变量/函数命名一致

6. **代码示例** (P1 - 检查项)
   - 代码示例完整
   - 语言标识正确
   - 代码可运行

---

## 🎯 使用方式

### 基本用法

```bash
/check-doc-quality                                    # 检查当前文档
/check-doc-quality --file docs/product/claude.md      # 检查指定文档
/check-doc-quality --all                              # 检查所有文档
/check-doc-quality --dir docs/design                  # 检查指定目录
```

### 高级选项

```bash
/check-doc-quality --strict                           # 严格模式（所有项）
/check-doc-quality --quick                            # 快速模式（仅P0项）
/check-doc-quality --fix                              # 自动修复可修复的问题
/check-doc-quality --report docs/quality-report.md    # 生成详细报告
/check-doc-quality --format json                      # JSON格式输出
```

---

## 🔧 执行流程

### 标准模式（默认）

```yaml
步骤1: 确定检查范围
  ↓
  - 如果指定文件，检查该文件
  - 如果指定目录，检查目录下所有.md文件
  - 如果--all，扫描整个docs目录
  ↓
步骤2: 执行质量检查
  ↓
  P0必查项 (必须通过):
    - 格式检查
    - 内容完整性
    - 交叉引用
    - 版本号一致性
  ↓
  P1检查项 (建议通过):
    - 命名规范
    - 代码示例
    - 图表引用
  ↓
  P2优化项 (可选):
    - 可读性
    - 一致性
  ↓
步骤3: 生成检查报告
  ↓
  统计结果:
    - Error: 阻塞性问题数量
    - Warning: 建议修复问题数量
    - Suggestion: 优化建议数量
  ↓
  评级:
    - 90-100分: 优秀 ✅
    - 80-89分: 良好 🟢
    - 70-79分: 及格 🟡
    - <70分: 需改进 🔴
  ↓
步骤4: 显示建议
  ↓
  - 优先修复Error级别问题
  - 建议修复Warning级别问题
  - 可选优化Suggestion级别问题
```

---

## 📊 检查项详解

### P0 - 必查项（必须通过）

#### 1. 格式检查

```yaml
检查内容:
  - Markdown格式有效性
  - 标题层级（#到######）
  - 列表格式（有序/无序）
  - 代码块语言标识
  - 表格完整性

通过标准:
  - 无格式错误
  - 标题层级合理（无跳级）
  - 所有代码块有语言标识
  - 所有表格完整

错误示例:
  ```markdown
  ```           # ❌ 缺少语言标识
  code here
  ```

  | Header      # ❌ 表格不完整
  ```

正确示例:
  ```markdown
  ```python      # ✅ 有语言标识
  code here
  ```

  | Header 1 | Header 2 |  # ✅ 表格完整
  |----------|----------|
  | Cell 1   | Cell 2   |
  ```
```

#### 2. 内容完整性

```yaml
检查内容:
  - 版本号字段
  - 更新日期
  - 必需章节（根据文档类型）
  - 关键信息字段

通过标准:
  - 有版本号（vX.Y格式）
  - 有更新日期
  - 必需章节完整
  - 无明显内容缺失

必需章节（按文档类型）:
  设计文档:
    - 版本和更新日期
    - 目的/背景
    - 核心功能
    - 实现细节

  Agent文档:
    - 版本和创建时间
    - 功能描述
    - 使用说明
    - 示例

  Command文档:
    - 版本和创建时间
    - 命令格式
    - 使用说明
    - 示例
```

#### 3. 交叉引用

```yaml
检查内容:
  - 内部链接有效性
  - 文件路径正确性
  - 引用版本号匹配

通过标准:
  - 所有内部链接可访问
  - 文件路径正确
  - 引用的版本号与目标文档一致

检查方法:
  1. 提取所有[链接](path)
  2. 检查path是否存在
  3. 如果是版本引用，检查版本号一致

错误示例:
  ```markdown
  详见: [评分系统 v1.0](../design/评分系统_v1.1.md)  # ❌ 版本不匹配
  ```

正确示例:
  ```markdown
  详见: [评分系统 v1.1](../design/评分系统_v1.1.md)  # ✅ 版本匹配
  ```
```

#### 4. 版本号一致性

```yaml
检查内容:
  - 文档内版本号一致
  - 与CHANGELOG一致
  - 与交叉引用一致

通过标准:
  - 文档标题和正文的版本号一致
  - CHANGELOG中有对应条目
  - 所有引用该文档的地方版本号一致

检查方法:
  1. 提取文档中所有版本号（vX.Y格式）
  2. 检查是否全部一致
  3. 与CHANGELOG交叉验证
  4. 搜索所有引用该文档的文档
```

---

### P1 - 检查项（建议通过）

#### 5. 命名规范

```yaml
检查内容:
  - 文件名符合规范
  - 标题格式统一
  - 术语使用一致

命名规范:
  文件名:
    - 小写字母
    - 连字符分隔
    - 版本号后缀: _vX.Y
    示例: scoring-system-design_v1.0.md

  标题:
    - 使用一级标题(#)
    - 包含文档类型
    - 包含版本号
    示例: # 评分系统设计文档 v1.0
```

#### 6. 代码示例

```yaml
检查内容:
  - 代码示例完整
  - 语言标识正确
  - 代码可运行

通过标准:
  - 代码块闭合
  - 语言标识正确
  - 无明显语法错误
```

---

### P2 - 优化项（可选）

#### 7. 可读性

```yaml
检查内容:
  - 段落长度
  - 句子复杂度
  - 专业术语解释

优化建议:
  - 段落不宜过长（建议<10行）
  - 复杂句子拆分
  - 专业术语首次出现时解释
```

#### 8. 一致性

```yaml
检查内容:
  - 术语使用一致
  - 格式风格一致
  - 标点符号一致

优化建议:
  - 同一概念使用统一术语
  - 日期格式统一（YYYY-MM-DD）
  - 标点符号使用一致
```

---

## 📈 报告格式

### 终端输出（默认）

```markdown
📋 文档质量检查报告

文件: docs/product/claude.md
检查时间: 2025-01-11 14:30:00

📊 质量评分: 85分 (良好)

✅ 通过项: 6项
⚠️  警告: 2项
💡 建议: 1项

🔴 错误 (Error) - 必须修复:

1. 版本号不一致
   位置: 第5行
   问题: 标题显示v1.16，正文显示v1.17
   建议: 统一为v1.17

🟡 警告 (Warning) - 建议修复:

1. 缺少更新日期
   位置: 文档末尾
   问题: 无"最后更新"字段
   建议: 添加: *最后更新：2025-01-11*

2. 外部链接可能失效
   位置: 第42行
   问题: https://example.com/api 无法访问
   建议: 检查链接或移除

💡 优化建议 (Suggestion):

1. 可读性优化
   位置: 第78-90行
   问题: 段落过长（13行）
   建议: 拆分为多个短段落

---
总计: 1 Error, 2 Warnings, 1 Suggestion
评级: 良好 🟢
建议: 优先修复Error级别问题
```

### JSON格式

```json
{
  "file": "docs/product/claude.md",
  "check_time": "2025-01-11T14:30:00",
  "score": 85,
  "rating": "good",
  "summary": {
    "passed": 6,
    "errors": 1,
    "warnings": 2,
    "suggestions": 1
  },
  "issues": [
    {
      "level": "error",
      "category": "version_consistency",
      "line": 5,
      "message": "版本号不一致",
      "details": "标题显示v1.16，正文显示v1.17",
      "suggestion": "统一为v1.17"
    }
  ]
}
```

---

## 🔧 与Hook配合

### doc-quality-monitor-hook

```yaml
触发时机:
  - 文档保存后自动检查
  - Git commit前检查

工作流程:
  1. 文档被修改
  ↓
  2. doc-quality-monitor-hook触发
  ↓
  3. 运行 /check-doc-quality --quick
  ↓
  4. 显示检查结果
  ↓
  5. 如果有Error，提示修复
```

---

## 🎯 使用场景

### 场景1: 日常开发

```bash
# 编辑文档后快速检查
/check-doc-quality

# 如果没问题，继续开发
# 如果有问题，修复后再检查
```

### 场景2: 提交前检查

```bash
# 准备提交时，全面检查
/check-doc-quality --all --strict

# 生成详细报告
/check-doc-quality --all --report docs/quality-report.md
```

### 场景3: 自动化流程

```yaml
# Hook自动触发
doc-quality-monitor-hook:
  on_save:
    command: /check-doc-quality --quick
  on_commit:
    command: /check-doc-quality --strict
    block_on_error: true
```

---

## 📝 最佳实践

### 1. 定期检查

```yaml
建议频率:
  - 编辑后立即检查
  - 提交前全面检查
  - 每周批量检查所有文档
```

### 2. 优先级处理

```yaml
修复顺序:
  1. Error级别 - 阻塞性问题，必须修复
  2. Warning级别 - 建议修复
  3. Suggestion级别 - 可选优化
```

### 3. 持续改进

```yaml
改进目标:
  - 所有文档质量 > 80分
  - 消除所有Error级别问题
  - 减少Warning级别问题
```

---

## 🔍 相关工具

- `/sync-docs` - 同步文档
- `/review-docs` - 审查文档
- doc-quality-monitor-hook - 自动质量检查Hook

---

**更新时间**: 2025-01-11
**版本**: v1.0
**状态**: ✅ 已完成
