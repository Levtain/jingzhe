# 从旧版排名系统文档中借鉴的内容

> **提取日期**: 2025-01-07
> **提取人**: 老黑(Claude)
> **目的**: 总结旧文档中值得混合方案借鉴的内容

---

## ✅ 已被混合方案采纳的内容

### 1. 监控指标体系（来自实施方案）

**来源**: 《惊蛰计划第一届评分排名系统实施方案.md》第5章

**采纳内容**:
- ✅ 算法健康度指标
  - 截尾率分布（被截掉的评分比例）
  - 权重分布（用户权重统计）
  - 评分次数分布

- ✅ 公平性指标
  - Gini系数（评分分布不均度）
  - 评分者参与度
  - 并列率

- ✅ 性能指标
  - 单次计算耗时
  - 批处理总耗时
  - 缓存命中率

**混合方案应用**:
- 补充用户权重相关监控
- 保留原有的截尾率监控
- 保留性能监控框架

---

### 2. 预处理层设计（来自技术实现文档）

**来源**: 《排名系统技术实现文档_v1.0.md》第二章

**采纳内容**:
- ✅ 自评过滤规则
- ✅ 高危行为标记（仅标记，不自动排除）
- ✅ 完整性检查（0-10分范围）
- ✅ 有效人次计算（评审团×2）

**混合方案应用**:
- 完全保留预处理逻辑
- 在此基础上增加用户权重计算

---

### 3. 并列处理规则（来自技术实现文档）

**来源**: 《排名系统技术实现文档_v1.0.md》第四章

**采纳内容**:
- ✅ 三级优先级设计
  1. 评审团得分
  2. 有效评分人数 → **混合方案改为"加权评分人次"**
  3. 创新性维度得分
  4. 允许并列

**混合方案改进**:
- 第2优先级从"人数"改为"加权人次" = Σ权重

---

### 4. 数据库表结构（来自技术实现文档）

**来源**: 《排名系统技术实现文档_v1.0.md》第五章

**采纳内容**:
- ✅ rankings表结构（扩展了user_weights表）
- ✅ 索引设计优化
- ✅ 字段命名规范

**混合方案新增**:
- 新增user_weights表（存储用户权重）
- 新增score_details表（评分明细）
- rankings表增加权重相关字段

---

### 5. 工程实施清单（来自实施方案）

**来源**: 《惊蛰计划第一届评分排名系统实施方案.md》第五章

**采纳内容**:
- ✅ 开发任务拆解
- ✅ 测试用例设计
- ✅ 上线检查清单
- ✅ 降级方案设计

**混合方案应用**:
- 调整开发工作量（混合方案2-3人日，旧方案8人日）
- 保留测试框架
- 保留降级机制

---

## ⏳ 第二届可能借鉴的内容

### 1. Huber M-估计量（来自白皮书v3.0）

**来源**: 《在线评分与排名系统白皮书_v3.0.md》第6章

**算法描述**:
```python
# Huber Mean需要迭代求解
def huber_mean(scores, delta=1.0):
    m = median(scores)  # 初始值
    while True:
        residuals = [s - m for s in scores]
        # 使用Huber损失函数
        psi = [r if abs(r) <= delta else delta * sign(r) for r in residuals]
        new_m = m + sum(psi) / len(scores)
        if abs(new_m - m) < 0.001:
            break
        m = new_m
    return m
```

**优点**:
- ✅ 抗极端值能力比截尾均值更强
- ✅ 保留更多信息（不是简单去掉）
- ✅ 学术界认可

**缺点**:
- ❌ 需要迭代求解，计算复杂度高
- ❌ 可解释性差（无法一句话说明）
- ❌ 需要调参delta

**第二届引入条件**:
- 第一届出现大量刷分问题
- 截尾均值效果不足
- 有足够的开发资源

---

### 2. 贝叶斯平滑（来自实施方案）

**来源**: 《惊蛰计划第一届评分排名系统实施方案.md》第二章

**算法描述**:
```python
def bayesian_smoothing(score, n, global_mean, k=20):
    """
    贝叶斯平滑：小样本向全局均值回归
    n: 实际评分数
    k: 平滑强度
    """
    return (n * score + k * global_mean) / (n + k)
```

**优点**:
- ✅ 冷启动保护（新游戏不会被埋没）
- ✅ 学术界认可（IMDb使用类似方法）
- ✅ 平滑过渡

**缺点**:
- ❌ 需要全平台均值μ
- ❌ 参数k需要调优
- ❌ 可解释性稍差

**第二届引入条件**:
- 第一届出现冷启动问题（新游戏被埋没）
- 有足够的历史数据确定k值
- 参赛者接受了权重概念后

**简化版建议**:
```python
# 只在评分少于20时启用
if n < 20:
    k = 20  # 固定值
    mu = 7.5  # 预设的全局均值
    score = (n * calculated_score + k * mu) / (n + k)
```

---

### 3. 评分者信誉系统（RTS）（来自白皮书v3.0）

**来源**: 《在线评分与排名系统白皮书_v3.0.md》第8章

**算法描述**:
```python
# 评分者信誉计算
def calculate_reputation(rater):
    # 信誉基于多个因素
    factors = {
        '评分次数': rater.score_count,
        '评分方差': rater.score_variance,
        '与共识的偏差': rater.deviation_from_consensus,
        '时间衰减': rater.time_decay,
    }
    return aggregate_reputation(factors)
```

**优点**:
- ✅ 长期来看更公平
- ✅ 自动识别恶意评分者
- ✅ 权重动态调整

**缺点**:
- ❌ 需要长期数据积累
- ❌ 算法复杂度高
- ❌ 可能引发争议（"为什么我的信誉低？"）

**第三届引入条件**:
- 已有两届历史数据
- 出现严重的信誉问题
- 有专业的数据团队维护

---

### 4. 互评团检测（来自白皮书v3.0）

**来源**: 《在线评分与排名系统白皮书_v3.0.md》第9章

**算法描述**:
```python
# 检测互评团
def detect_rating_clubs(scores):
    # 基于图论算法
    # 如果A和B互相给高分，标记为可疑
    graph = build_graph(scores)
    clubs = find_cliques(graph, min_size=5)
    return clubs
```

**优点**:
- ✅ 自动识别有组织刷分
- ✅ 公平透明

**缺点**:
- ❌ 算法复杂度高
- ❌ 计算量大
- ❌ 误判风险

**第二届引入条件**:
- 第一届出现互评团问题
- 人工审核工作量过大
- 有足够的计算资源

---

## 🚫 不采纳的内容及原因

### 1. 综合总榜（来自白皮书v3.0）

**不采纳原因**:
- ❌ 违背惊蛰计划"不计算总分"的核心原则
- ❌ 会引起权重争议（"哪个维度更重要？"）
- ❌ 与12榜单架构冲突

---

### 2. 复杂参数调优（来自白皮书v3.0）

**不采纳原因**:
- ❌ 第一届无历史数据，无法确定最优参数
- ❌ 过多的参数（alpha, beta, gamma, delta, k, lambda...）
- ❌ 增加理解和维护成本

**第一届策略**: 固定参数，保持简单

---

### 3. 时间衰减模型（来自白皮书v3.0）

**不采纳原因**:
- ❌ 第一届时间短（48小时），无意义
- ❌ 不符合"所有评分平等"的原则
- ❌ 可能引发争议（"为什么我的评分权重随时间降低？"）

---

## 📊 总结对比

| 内容 | 旧方案 | 混合方案 | 是否采纳 |
|------|--------|---------|---------|
| **核心算法** | 截尾+贝叶斯 | 权重+截尾+平均 | ❌ 已替换 |
| **用户权重** | ❌ 无 | ✅ W=1+ln(1+n) | 🆕 新增 |
| **监控体系** | ✅ 有 | ✅ 保留并扩展 | ✅ 采纳 |
| **预处理** | ✅ 有 | ✅ 完全保留 | ✅ 采纳 |
| **并列处理** | ✅ 有 | ✅ 保留并改进 | ✅ 采纳 |
| **数据库设计** | ✅ 有 | ✅ 保留并扩展 | ✅ 采纳 |
| **工程清单** | ✅ 有 | ✅ 调整后采纳 | ✅ 采纳 |
| **Huber Mean** | ❌ 无 | ❌ 无 | ⏳ 第二届考虑 |
| **贝叶斯平滑** | ✅ 有 | ❌ 第一届不用 | ⏳ 第二届引入 |
| **信誉系统** | ❌ 无 | ❌ 无 | ⏳ 第三届考虑 |

---

## 💡 借鉴原则

### 第一届: 最小可行
- ✅ 借鉴: 监控、预处理、数据库、工程清单
- ✅ 保留: 12榜单架构、排名门槛、并列处理
- 🆕 新增: 用户权重（公平性提升）
- ❌ 暂缓: Huber Mean、贝叶斯平滑、信誉系统

### 第二届: 渐进增强
- ⏳ 引入: 简化版贝叶斯平滑（冷启动保护）
- ⏳ 考虑: 提高截尾比例或动态截尾
- ⏳ 评估: 是否需要Huber Mean

### 第三届: 全面优化
- ⏳ 根据前两届数据决定
- ⏳ 可能引入信誉系统
- ⏳ 可能引入互评团检测

---

## 📝 使用说明

**何时参考旧文档？**

1. **了解监控指标设计** → 参考《实施方案》第5章
2. **了解数据库设计** → 参考《技术实现文档》第5章
3. **了解工程清单** → 参考《实施方案》第5章
4. **第二届优化** → 参考《白皮书v3.0》的Huber Mean和贝叶斯平滑

**何时不应参考旧文档？**

1. ❌ 核心算法部分（已被混合方案取代）
2. ❌ 参数设置（混合方案参数不同）
3. ❌ 排名计算逻辑（完全不同）

---

*提取完成时间: 2025-01-07*
*提取人: 老黑(Claude)*
*版本: v1.0*
