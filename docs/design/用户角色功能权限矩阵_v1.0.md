# 用户角色功能权限矩阵 v1.0

**文档版本**: v1.0
**创建日期**: 2025-01-10
**设计状态**: ✅ 基于已确认规则完成
**依赖文档**:
- [评分系统设计方案_v2.0.md](./评分系统设计方案_v1.0.md)
- [经济系统设计文档_v1.2.md](./惊蛰计划-经济系统设计文档_v1.0.md)
- [游戏提交系统设计文档_v1.1.md](./game-submission-system-requirements-and-design_2025-01-08.md)

---

## 文档说明

本文档定义惊蛰计划中所有用户角色及其功能权限，为开发团队提供权威的权限控制参考。

**设计原则**:
- **最小权限原则**: 用户仅拥有完成其角色所需的最小权限
- **身份互斥**: 某些身份不能同时持有（如评审团不能参赛）
- **权限叠加**: 用户可以同时拥有多个身份，权限叠加

---

## 一、用户角色定义

### 1.1 基础角色

| 角色代码 | 角色名称 | 说明 |
|---------|---------|------|
| **GUEST** | 路人（未登录） | 未登录用户，仅可浏览 |
| **PLAYER** | 路人玩家 | 已登录但未参赛的用户 |
| **PARTICIPANT** | 参赛者 | 已提交参赛游戏的用户 |
| **JUDGE** | 评审团 | 被邀请参与评审的专业人士 |
| **HARDCORE** | 硬核玩家 | 公开源码获得硬核身份的用户 |
| **ADMIN** | 管理员 | 系统管理员 |

### 1.2 角色获取方式

| 角色 | 获取方式 | 可否撤销 |
|-----|---------|---------|
| 路人 | - | - |
| 路人玩家 | 注册登录 | - |
| 参赛者 | 在规定时间内提交参赛游戏 | - |
| 评审团 | 通过邀请码注册 | ✅ 可撤销（违规） |
| 硬核玩家 | 公开源码获得身份 | ❌ 不可撤销 |
| 管理员 | 系统预设 | - |

### 1.3 角色互斥规则

**互斥关系**:
- 评审团 ↔ 参赛者: **互斥**（评审团不能提交参赛游戏）
- 其他角色: **兼容**（可以同时持有）

**兼容示例**:
- ✅ 参赛者 + 硬核玩家
- ✅ 参赛者 + 评审团（❌ 不允许）
- ✅ 路人玩家 + 硬核玩家
- ✅ 参赛者 + 路人玩家

---

## 二、功能权限矩阵

### 2.1 核心功能权限概览

| 功能模块 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|---------|-----|---------|--------|--------|---------|--------|
| 浏览游戏 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 下载游戏 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看评分统计 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看排名 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 提交参赛游戏 | ❌ | ❌ | ✅ | ❌ | ✅ | ❌ |
| 评分游戏 | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ |
| 修改评分 | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ |
| 评分打赏 | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ |
| 查看金币余额 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 购买推荐位 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看心理价位 | ❌ | ❌ | ✅(本人) | ❌ | ✅(本人) | ✅ |
| 评论游戏 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看交易记录 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |

**图例**:
- ✅ 有权限
- ❌ 无权限
- ✅(本人) 仅对自己的作品有权限

---

### 2.2 页面级权限控制

#### 2.2.1 首页

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| 浏览Banner | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 浏览游戏列表 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 搜索游戏 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看排行榜 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看活动信息 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看公告 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |

---

#### 2.2.2 游戏列表页

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| 浏览所有游戏 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 搜索游戏 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 按类型筛选 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 按标签筛选 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看游戏封面 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看游戏简介 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看游戏类型标签 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看AI使用标识 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |

---

#### 2.2.3 游戏详情页 ⭐

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 | 说明 |
|-----|-----|---------|--------|--------|---------|--------|------|
| **查看游戏基本信息** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 所有人可见 |
| **查看游戏截图** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 所有人可见 |
| **下载游戏** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 所有人可见 |
| **查看评分统计卡片** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 所有人可见 |
| **查看收益统计卡片** | ✅ | ✅ | ✅(本人) | ❌ | ✅(本人) | ✅ | 心理价位仅本人可见 |
| **查看打赏记录** | ✅ | ✅ | ✅(简化) | ✅(简化) | ✅(简化) | ✅ | 创作者看详细，其他人看简化 |
| **开始评分按钮** | ❌ | ❌ | ✅(非自评) | ✅ | ❌ | ❌ | 需有评分权限 |
| **修改评分按钮** | ❌ | ❌ | ✅(非自评) | ✅ | ❌ | ❌ | 需有评分权限 |
| **查看我的评分** | ❌ | ❌ | ✅(已评) | ✅(已评) | ❌ | ❌ | 仅自己可见 |
| **编辑游戏信息按钮** | ❌ | ❌ | ✅(本人) | ❌ | ❌ | ✅ | 仅创作者本人（团队为队长/副队长） |
| **查看收益详情按钮** | ❌ | ❌ | ✅(本人) | ❌ | ❌ | ✅ | 仅创作者本人 |
| **评论区域** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | 路人不可评论 |
| **点赞评论** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | 路人不可点赞 |
| **打赏评论** | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | 需金币 |

**详细说明**:

**心理价位查看权限**:
- 创作者本人: ✅ 可查看具体数值
- 其他用户: ❌ 不可查看具体数值
- 所有人: ✅ 可查看吻合度百分比和标签（被低估/符合预期）

**打赏记录查看权限**:
- 创作者本人: ✅ 可查看完整打赏记录
- 其他用户: ✅ 可查看打赏人数、打赏总额（简化版）

**编辑游戏信息权限**:
- 个人参赛: ✅ 仅作者本人可见
- 团队参赛: ✅ 仅队长和副队长可见
- 其他用户: ❌ 不可见

---

#### 2.2.4 评分页面 ⭐

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **访问评分页面** | ❌ | ❌ | ✅(非自评) | ✅ | ❌ | ❌ | 需有评分权限 |
| **查看游戏快速预览** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | |
| **调整评分滑块** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | |
| **填写打赏金额** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | |
| **查看金币余额** | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | |
| **提交评分** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | |
| **修改评分** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | 无次数限制 |

**评分权限限制**:
- 不能评价自己提交的游戏
- 团队成员不能评价团队的游戏
- 评审团不能评价自己的游戏（评审团不参赛）

---

#### 2.2.5 个人资料页

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **查看自己的资料** | ❌ | ✅(本人) | ✅(本人) | ✅(本人) | ✅(本人) | ✅(所有) | |
| **查看他人资料** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | |
| **编辑个人资料** | ❌ | ✅(本人) | ✅(本人) | ✅(本人) | ✅(本人) | ✅(所有) | |
| **查看作品列表** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 所有人可见 |
| **查看评分历史** | ❌ | ✅ | ✅(本人) | ✅(本人) | ❌ | ✅ | 路人不可见 |
| **查看交易记录** | ❌ | ❌ | ✅(本人) | ✅(本人) | ✅(本人) | ✅ | 仅本人可见 |
| **查看金币账户** | ❌ | ❌ | ✅(本人) | ✅(本人) | ✅(本人) | ✅ | 仅本人可见 |
| **查看自我认知分析** | ❌ | ❌ | ✅(本人) | ❌ | ✅(本人) | ✅ | 仅本人可见 |
| **查看团队详情** | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | 团队成员可见 |

---

#### 2.2.6 团队管理页面

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **创建团队** | ❌ | ❌ | ✅ | ❌ | ✅ | ✅ | |
| **加入团队** | ❌ | ❌ | ✅ | ❌ | ✅ | ✅ | |
| **查看团队详情** | ❌ | ❌ | ✅(成员) | ❌ | ✅(成员) | ✅ | 仅团队成员可见 |
| **邀请成员** | ❌ | ❌ | ✅(队长) | ❌ | ❌ | ✅ | |
| **移除成员** | ❌ | ❌ | ✅(队长) | ❌ | ❌ | ✅ | |
| **转让队长** | ❌ | ❌ | ✅(队长) | ❌ | ❌ | ✅ | |
| **任命副队长** | ❌ | ❌ | ✅(队长) | ❌ | ❌ | ✅ | |
| **解散团队** | ❌ | ❌ | ✅(队长) | ❌ | ❌ | ✅ | |

**团队权限说明**:
- **队长**: 拥有所有管理权限（邀请、移除、转让、解散）
- **副队长**: 可以填写心理价位，但不能解散团队
- **普通成员**: 仅能查看团队信息，不能管理

---

#### 2.2.7 后台管理页面

| 功能 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **访问后台** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **查看用户管理** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **编辑用户信息** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **查看游戏管理** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **审核游戏** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **查看评分管理** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **查看经济数据** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **查看系统日志** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |
| **系统配置** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | |

---

### 2.3 操作级权限控制

#### 2.3.1 游戏提交操作

| 操作 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| 创建新游戏（草稿） | ❌ | ❌ | ✅ | ❌ | ✅ | ❌ | |
| 编辑游戏（草稿） | ❌ | ❌ | ✅(本人) | ❌ | ✅(本人) | ❌ | |
| 编辑游戏（团队成员） | ❌ | ❌ | ✅(团队) | ❌ | ✅(团队) | ❌ | |
| 删除游戏（草稿） | ❌ | ❌ | ✅(本人) | ❌ | ✅(本人) | ❌ | |
| 提交游戏（发布） | ❌ | ❌ | ✅(本人) | ❌ | ✅(本人) | ❌ | |
| 填写心理价位 | ❌ | ❌ | ✅(本人/队长/副队长) | ❌ | ✅(本人) | ❌ | |
| 更改游戏链接 | ❌ | ❌ | ✅(本人/队长/副队长) | ❌ | ✅(本人) | ❌ | |

**时机限制**:
- 评分阶段开始前: 可以随意更改
- 评分阶段开始后: 非特殊情况不可更改

---

#### 2.3.2 评分操作

| 操作 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **首次评分** | ❌ | ❌ | ✅(非自评) | ✅ | ❌ | ❌ | |
| **修改评分** | ❌ | ❌ | ✅(非自评) | ✅ | ❌ | ❌ | |
| **评分打赏** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | 强制，至少1金币 |
| **查看他人评分** | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ | |

**限制规则**:
- 不能评价自己提交的游戏
- 团队成员不能评价团队的游戏
- 评审团不能评价自己的游戏（评审团不参赛）

---

#### 2.3.3 经济操作

| 操作 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **查看金币余额** | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | |
| **查看交易记录** | ❌ | ❌ | ✅(本人) | ✅(本人) | ✅(本人) | ✅ | |
| **评分打赏** | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ | -1金币 |
| **购买推荐位** | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | |
| **接收打赏** | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ | 赛后结算 |
| **赛后结算** | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | 参赛者专属 |

**金币发放**:
- 基础金币: 所有用户100金币/天
- 评审团加成: +100金币/天
- 硬核玩家加成: +50金币/天
- 评分奖励: 每次有效评分+1金币

---

#### 2.3.4 评论操作

| 操作 | 路人 | 路人玩家 | 参赛者 | 评审团 | 硬核玩家 | 管理员 |
|-----|-----|---------|--------|--------|---------|--------|
| **查看评论** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 所有人可见 |
| **发表评论** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | 路人不可 |
| **回复评论** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | 路人不可 |
| **点赞评论** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | 路人不可 |
| **打赏评论** | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | 需金币 |
| **删除自己的评论** | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | |
| **删除他人评论** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | 管理员 |

---

## 三、权限规则说明

### 3.1 身份互斥规则

**评审团 ↔ 参赛者**:
- **互斥**: 评审团成员不能提交参赛游戏
- **原因**: 保证评审团的中立性和客观性
- **实现**: 系统在用户提交参赛游戏时，检查是否为评审团成员

**其他兼容组合**:
- ✅ 参赛者 + 硬核玩家
- ✅ 参赛者 + 路人玩家
- ✅ 路人玩家 + 硬核玩家

---

### 3.2 权限组合规则

**参赛者 + 硬核玩家**:
- 评分权限: ✅（参赛者）
- 推荐位购买优惠: ✅（硬核玩家特权）
- 心理价位填写: ✅（参赛者）
- 评审团评分权重: 无

**参赛者 + 评审团**:
- **不允许**: 评审团不能参赛
- 如果用户已参赛，则不能成为评审团
- 如果用户已是评审团，则不能参赛

**团队参赛**:
- 个人收益 = 团队游戏赏金(全额) + 个人评论赏金
- 心理价位填写: 仅队长或副队长
- 编辑游戏信息: 仅队长或副队长可见按钮

---

### 3.3 特殊权限说明

#### 3.3.1 自评限制

**规则**: 用户不能评价自己提交的游戏

**适用场景**:
- 个人参赛: 作者不能评价自己的游戏
- 团队参赛: 团队所有成员都不能评价团队的游戏

**实现方式**:
- 前端: 隐藏"开始评分"按钮
- 后端: 验证游戏创作者ID与评分者ID

---

#### 3.3.2 心理价位隐私保护

**规则**: 心理价位数值仅创作者本人可见

**展示规则**:
- **创作者本人**: 可查看具体心理价位数值
- **其他用户**: 不可查看具体数值
- **所有人**: 可查看吻合度百分比和标签（被低估/符合预期）

**展示示例**:

创作者本人视图:
```
💰 收益统计
心理价位: 10金币
实际收益: 15金币
吻合度: 50% ⚠️
标签: 被低估 📈 ⚠️
```

其他用户视图:
```
💰 收益统计
实际收益: 15金币
吻合度: 50% ⚠️
标签: 被低估 📈 ⚠️
```

---

#### 3.3.3 编辑权限细化

**个人参赛**:
- 编辑游戏信息: ✅ 仅作者本人可见
- 填写心理价位: ✅ 仅作者本人可见

**团队参赛**:
- 编辑游戏信息: ✅ 仅队长和副队长可见
- 填写心理价位: ✅ 仅队长和副队长可填写
- 普通团队成员: ❌ 不可编辑

**权限逻辑**:
```
IF 个人参赛:
  显示条件: user_id == game.author_id
ELSE IF 团队参赛:
  显示条件: user_id IN [team.leader_id, team.deputy_leader_id]
```

---

#### 3.3.4 评审团特殊权限

**评审团评分权重**:
- 评审团的每个评分在计算"评分人次"时按2人次计算
- 目的: 提高评审团评分的权威性

**强制评论规则**:
- 评审团提交评分时，评论为必填项
- 评论长度: 至少50字
- 评论公示: 在游戏详情页的"评审团点评"卡片展示

---

### 3.4 时间限制权限

#### 3.4.1 评分阶段限制

**评分阶段前**:
- ❌ 不能评分
- ✅ 可以准备游戏
- ✅ 可以修改心理价位
- ✅ 可以编辑游戏信息

**评分阶段中**:
- ✅ 可以评分（有权限的用户）
- ✅ 可以修改评分
- ❌ 不能修改心理价位（特殊情况除外）
- ❌ 不能编辑游戏信息

**评分阶段后**:
- ❌ 不能评分
- ❌ 不能修改评分
- ❌ 不能修改心理价位
- ❌ 不能编辑游戏信息
- ✅ 仅可查看

---

#### 3.4.2 开发阶段限制

**开发期**:
- ✅ 可以创建游戏
- ✅ 可以编辑游戏
- ✅ 可以删除游戏（草稿）
- ✅ 可以修改心理价位

**开发期结束后**:
- ❌ 不能创建新游戏
- ❌ 不能编辑游戏
- ❌ 不能删除游戏
- ❌ 不能修改心理价位

---

## 四、权限检查实现指南

### 4.1 前端权限控制

**显示/隐藏元素**:
```javascript
// 示例：游戏详情页编辑按钮
const canEditGame = () => {
  if (isAdmin) return true;
  if (isPersonal && user.id === game.author_id) return true;
  if (isTeam && (user.id === team.leader_id || user.id === team.deputy_leader_id)) return true;
  return false;
};

// 渲染条件
{canEditGame() && <Button>编辑游戏信息</Button>}
```

**禁用/启用按钮**:
```javascript
// 示例：评分按钮
const canRate = () => {
  if (!isLoggedIn) return false;
  if (!hasScoringRole) return false;
  if (isSelfGame) return false;
  return true;
};

<button disabled={!canRate()}>开始评分</button>
```

---

### 4.2 后端权限验证

**API权限中间件**:
```python
# 示例：Flask路由权限装饰器
from functools import wraps

def require_scoring_permission(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        # 检查登录
        if 'user_id' not in session:
            return jsonify({'error': '未登录'}), 401

        # 检查评分角色
        user = get_user(session['user_id'])
        if not user.has_role(['participant', 'judge']):
            return jsonify({'error': '无评分权限'}), 403

        # 检查自评
        game_id = kwargs.get('game_id')
        if not user.can_rate_game(game_id):
            return jsonify({'error': '不能评价自己的游戏'}), 403

        return f(*args, **kwargs)
    return decorated_function
```

---

### 4.3 数据库权限设计

**用户角色表**:
```sql
CREATE TABLE user_roles (
    user_id INT PRIMARY KEY,
    is_participant BOOLEAN DEFAULT FALSE,
    is_judge BOOLEAN DEFAULT FALSE,
    is_hardcore BOOLEAN DEFAULT FALSE,
    is_admin BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**游戏权限表**:
```sql
CREATE TABLE game_permissions (
    game_id INT PRIMARY KEY,
    author_id INT NOT NULL,
    team_id INT,
    leader_id INT,
    deputy_leader_id INT,
    FOREIGN KEY (author_id) REFERENCES users(user_id),
    FOREIGN KEY (team_id) REFERENCES teams(team_id),
    FOREIGN KEY (leader_id) REFERENCES users(user_id),
    FOREIGN KEY (deputy_leader_id) REFERENCES users(user_id)
);
```

---

## 五、权限矩阵速查表

### 5.1 按用户角色速查

#### 路人（未登录）

| 功能 | 权限 |
|-----|------|
| 浏览内容 | ✅ |
| 评分 | ❌ |
| 打赏 | ❌ |
| 评论 | ❌ |
| 下载 | ✅ |
| 查看账户 | ❌ |

#### 路人玩家（已登录未参赛）

| 功能 | 权限 |
|-----|------|
| 浏览内容 | ✅ |
| 评分 | ❌ |
| 打赏 | ❌ |
| 评论 | ✅ |
| 下载 | ✅ |
| 查看账户 | ✅ |

#### 参赛者

| 功能 | 权限 |
|-----|------|
| 浏览内容 | ✅ |
| 评分 | ✅（非自评） |
| 打赏 | ✅ |
| 评论 | ✅ |
| 下载 | ✅ |
| 查看账户 | ✅ |
| 提交游戏 | ✅ |
| 查看心理价位 | ✅（本人） |
| 编辑游戏 | ✅（本人） |

#### 评审团

| 功能 | 权限 |
|-----|------|
| 浏览内容 | ✅ |
| 评分 | ✅ |
| 打赏 | ✅ |
| 评论 | ✅ |
| 下载 | ✅ |
| 查看账户 | ✅ |
| 提交游戏 | ❌ |
| 评分权重 | ×2 |

#### 硬核玩家

| 功能 | 权限 |
|-----|------|
| 浏览内容 | ✅ |
| 评分 | ✅（非自评） |
| 打赏 | ✅ |
| 评论 | ✅ |
| 下载 | ✅ |
| 查看账户 | ✅ |
| 提交游戏 | ✅ |
| 推荐位优惠 | ✅ |

#### 管理员

| 功能 | 权限 |
|-----|------|
| 所有功能 | ✅ |
| 后台管理 | ✅ |
| 用户管理 | ✅ |
| 系统配置 | ✅ |

---

### 5.2 按功能速查

#### 评分权限

| 角色 | 能否评分 | 说明 |
|-----|---------|------|
| 路人 | ❌ | 无权限 |
| 路人玩家 | ❌ | 无权限 |
| 参赛者 | ✅ | 不可自评 |
| 评审团 | ✅ | 可评所有游戏 |
| 硬核玩家 | ❌ | 参赛者权限覆盖 |
| 管理员 | ❌ | 管理权限不参与 |

#### 编辑游戏权限

| 角色 | 能否编辑 | 限制 |
|-----|---------|------|
| 路人 | ❌ | - |
| 路人玩家 | ❌ | - |
| 参赛者（个人） | ✅ | 仅本人游戏 |
| 参赛者（团队-队长） | ✅ | 团队游戏 |
| 参赛者（团队-副队长） | ✅ | 团队游戏 |
| 参赛者（团队-成员） | ❌ | - |
| 评审团 | ❌ | 不参赛 |
| 硬核玩家 | ✅ | 仅本人游戏 |
| 管理员 | ✅ | 所有游戏 |

#### 心理价位查看权限

| 角色 | 能否查看数值 | 说明 |
|-----|-----------|------|
| 路人 | ❌ | - |
| 路人玩家 | ❌ | - |
| 参赛者 | ✅（本人） | 仅自己的游戏 |
| 评审团 | ❌ | - |
| 硬核玩家 | ✅（本人） | 仅自己的游戏 |
| 管理员 | ✅（所有） | 管理员特权 |

---

## 六、权限控制最佳实践

### 6.1 前端控制

**1. 按钮显示/隐藏**:
- 根据用户角色动态显示/隐藏按钮
- 禁用不可操作的按钮
- 提供清晰的权限提示

**2. 页面访问控制**:
- 未登录用户尝试访问需要权限的页面 → 跳转登录页
- 权限不足用户访问后台 → 返回403错误

**3. 数据过滤**:
- 根据用户角色过滤显示数据
- 心理价位数值仅创作者可见
- 打赏记录简化显示（非创作者）

---

### 6.2 后端验证

**1. API权限中间件**:
- 每个API端点验证权限
- 使用装饰器或中间件统一验证
- 返回明确的错误码和错误信息

**2. 数据库查询权限**:
- 查询时自动过滤权限范围
- 使用WHERE子句限制数据范围

**3. 操作日志**:
- 记录所有敏感操作
- 包含用户ID、操作类型、操作对象、时间戳

---

### 6.3 安全措施

**1. 防止越权访问**:
- 前端隐藏/禁用≠后端验证
- 所有权限判断在后端再次验证
- 使用session/token验证身份

**2. 防止身份伪造**:
- session/token加密存储
- 敏感操作二次验证
- 记录操作日志

**3. 防止批量操作**:
- 限流控制（Rate Limiting）
- 检测异常操作频率
- CAPTCHA验证（如需要）

---

## 七、权限变更日志

### 版本历史

| 版本 | 日期 | 变更内容 | 作者 |
|-----|------|---------|------|
| v1.0 | 2025-01-10 | 初始版本 | Claude |

---

## 八、相关文档

- [评分系统设计方案_v2.0.md](./评分系统设计方案_v1.0.md)
- [经济系统设计文档_v1.2.md](./惊蛰计划-经济系统设计文档_v1.0.md)
- [游戏提交系统设计文档_v1.1.md](./game-submission-system-requirements-and-design_2025-01-08.md)
- [游戏详情页设计_v1.0.md](./pages/游戏详情页设计_v1.0.md)
- [评分页面设计_v1.0.md](./pages/评分页面设计_v1.0.md)
- [个人资料页设计_v1.0.md](./pages/个人资料页设计_v1.0.md)

---

**创建者**: 老黑(Claude)
**创建日期**: 2025-01-10
**文档版本**: v1.0
**状态**: ✅ 完成
**下一步**: 根据用户反馈更新
