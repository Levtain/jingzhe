# 惊蛰计划 - 团队系统设计文档 v1.3

> **版本**：v1.3
> **创建日期**：2025-01-07
> **更新日期**：2025-01-08（✅所有问题已100%确认!）
> **状态**：✅ 所有高/中/低优先级问题已100%确认
> **复杂度**：⭐⭐⭐（堪比评分系统）
> **相关文档**: [关键名词解释索引_v1.2.md](./关键名词解释索引_v1.2.md) - 统一的用户角色和团队系统定义

---

## 📋 文档概述

### 系统定位

团队系统是惊蛰计划的核心功能模块之一，负责管理用户组队、团队协作、作品提交与展示等全流程。

**核心价值**：
- 支持个人赛道和团队赛道双轨并行
- 提供完整的团队生命周期管理
- 支持灵活的成员角色与权限体系
- 与评分、排名、经济等核心系统深度集成

### 系统复杂度

| 指标 | 数量 | 说明 |
|------|------|------|
| **功能模块** | 9个 | 创建/管理/页面/作品/招募/私聊等 |
| **角色类型** | 3种 | 队长/副队长/普通成员 |
| **权限层次** | 3级 | 不同角色不同权限 |
| **数据表** | 5+ | 团队/成员/角色/作品关联等 |
| **待确认问题** | 23个 | 高优先级6个，中优先级5个 |

**对比参考**：
- 评分系统：29个问题，22个已确认
- **团队系统：23个问题，复杂度相当** ⭐⭐⭐

---

## 🎯 核心规则（已确认 ✅）

### 1. 团队规模

- **人数范围**：1-9人
- **单人团队**：允许创建"仅自己1人"的团队
- **上限**：最多9人（不可超出）

### 2. 赛道判定逻辑

#### 报名与组队流程
```
用户报名 → 不选择赛道
         ↓
创建团队 → 可创建"单人团队"（1-9人）
         ↓
提交作品 → 根据团队人数自动判定
```

#### 作品提交时的赛道选择规则
- **团队成员 > 1人** → 自动锁定为**团队赛道作品**（不可选个人赛道）
- **团队成员 = 1人** → 可选择：
  - ○ 个人赛道
  - ○ 团队赛道（单人团队）

#### 赛道并行规则
- ✅ 个人赛和团队赛**同时进行**
- ✅ 用户可以**同时参加**两个赛道
  - 场景：用户有个人的作品（个人赛道），同时是团队成员（团队赛道）

### 3. 成员角色与权限

#### 角色类型

| 角色 | 数量限制 | 核心权限 |
|------|---------|---------|
| **队长** | 每团队1人 | 最高权限 |
| **副队长** | 每团队最多1人 | 中级权限 |
| **普通成员** | 无限制 | 基础权限 |

#### 权限详细划分

**队长权限**：
- ✅ 审核加入申请
- ✅ 编辑团队信息（名称、简介）
- ✅ 移除团队成员
- ✅ 转让队长
- ✅ 设置副队长（最多1个）
- ✅ 修改成员身份标签
- ✅ 提交/编辑团队作品

**副队长权限**：
- ✅ 上传游戏
- ✅ 添加游戏作者
- ✅ 修改游戏详情页内容
- ✅ 修改自己的身份标签
- ❌ 移除成员
- ❌ 转让队长
- ❌ 添加新副队长

**普通成员权限**：
- ✅ 修改自己的身份标签
- ✅ 主动退出团队
- ✅ 查看团队信息
- ❌ 提交/编辑团队作品
- ❌ 管理其他成员

### 4. 成员身份标签

**预设标签**：
- 程序
- 策划
- TA（技术美术）
- 音效
- 音乐
- 美术

**标签规则**：
- ✅ **选填**（不强制填写）
- ✅ **支持多标签**（一个成员可以有多个身份）
- ✅ 支持自定义标签
- ✅ 队长可修改，成员也可自己修改

---

## 🏗️ 团队创建与管理

### 1. 团队创建流程

#### 创建表单字段
```
必填项：
- 团队名称（2-20字符，可重复？待确认 Q12）
- 团队规模：1人（创建者本人自动加入）

可选项：
- 团队简介（用于组队信息展示）
- 团队头像（上传图片）
```

#### 创建后状态
- 创建者自动成为**队长**
- 团队状态：**招募中**（可手动关闭）
- 团队页面：**公开可见**（所有用户可查看）

### 2. 成员加入机制

#### 方式1：邀请码/邀请链接（主要方式）

**邀请码**：
- 团队生成唯一邀请码（如：TEAM-ABCD1234）
- 队长可重置邀请码（防止泄露）
- 有效期：待确认（Q10）

**邀请链接**：
- 生成专属加入链接（如：https://jingzhe.com/team/join/ABC123）
- 可分享到站外（QQ、微信、Discord等）
- **未注册用户点击链接**：
  1. 跳转到注册页面
  2. 完成注册后自动加入团队

**邀请码/链接的安全机制**（待确认）：
- [ ] 邀请码有效期（如24小时后失效）
- [ ] 邟请链接是否需要审核（队长确认模式）
- [ ] 邀请码重置功能（队长可随时重置）

#### 方式2：站内私聊辅助

**配套功能**：站内私聊系统
- 用户之间可发送私信
- 用于陌生招募时的沟通
- 沟通后队长发送邀请码/链接

**私聊功能范围**（第一届）：
- ✅ 一对一文字聊天
- ✅ 发送链接（包括邀请链接）
- ❌ 暂不支持文件传输
- ❌ 暂不支持群聊

#### 方式3：组队信息区招募（社区功能）

**流程**：
1. 队长在社区"组队信息区"发布招募帖
2. 感兴趣的用户通过站内私聊联系
3. 沟通确认后，队长发送邀请码/链接

### 3. 成员退出与移除

#### 主动退出
- ✅ 成员可以主动退出团队
- ✅ **保留作者身份**（退出前已提交的作品仍显示其为作者）
- ✅ 退出成员的个人主页仍显示该团队作品
- ❌ 退出后**不能**编辑已退出团队的作品

#### 被动移除（仅队长）
- ✅ 队长可以移除团队成员
- ✅ 被移除成员保留已提交作品的作者身份
- ❌ 副队长**不能**移除成员

#### 退出后的作者身份显示
- 退出成员的个人主页：
  - 作品显示为"团队作品"
  - 标识："前团队成员XXX"
- 作品页面：
  - 仍显示其为作者（成员快照）
  - 不显示当前状态（已退出）

### 4. 成员变更时机 ✅ 已确认 (2025-01-08)

**核心规则**：
- ✅ **同一届比赛只能加入/创建一个团队**（决策Q1）
- ✅ **作品提交时快照成员列表**（决策Q4）

#### 赛程内成员变更规则（开发期未结束前）
- ❌ **任何人都不可退出**（包括普通成员、副队长、队长）
- ✅ **可以加入新成员**（上限9人）
- 📝 **所有变更都记录变更日志**

**特殊情况处理**：
- 队长想要退出时，必须**先移交队长权限**，然后才能退出
- 移交队长权限后，新队长同样**不可退出**（赛程内规则）

#### 赛程结束后成员变更规则
- ✅ **可以自由退出**（所有成员）
- ✅ **可以继续加入新成员**（上限9人）
- 📝 **继续记录变更日志**

#### 作品提交时的快照机制
- **作品提交时**：快照当前的成员列表
- **作品页面**：显示"提交时的成员"（快照）
- **团队页面**：显示"当前成员"（实时）
- **评分资格**：不受后续成员变更影响

**示例场景**：
```
提交作品时：团队有5人（A、B、C、D、E）
  ↓ 快照成员列表
作品页面显示：作者为A、B、C、D、E
  ↓ 赛程内，添加F、G，退出D
团队页面显示：当前成员为A、B、C、E、F、G（6人）
作品页面显示：作者仍为A、B、C、D、E（5人，快照）
```

#### 团队无人时的处理 ✅ 已确认 (2025-01-08)
- **自动解散**：最后一人退出时，团队**自动解散**（决策Q3）
- **团队页面**：标记为"已解散"，保留历史记录
- **团队作品**：仍然保留（不受解散影响）
- **解散后**：团队不可恢复

---

## 📱 团队功能页面

### 1. 团队页面架构

#### 页面可见性
- ✅ **公开可见**（所有用户可查看）
- ❌ 第一届不提供隐私设置

#### 页面结构
```
团队页面
├── 1. 团队基础信息区
│   ├── 团队头像
│   ├── 团队名称
│   ├── 团队简介
│   ├── 创建时间
│   ├── 团队规模（当前成员数/目标人数）
│   └── 招募状态（招募中/已满员）
│
├── 2. 团队成员区
│   ├── 队长标识
│   ├── 副队长标识（最多1人）
│   ├── 成员列表（1-9人）
│   │   ├── 成员头像
│   │   ├── 成员昵称
│   │   ├── 身份标签（多个）
│   │   └── 加入时间
│   └── 成员在线状态
│
├── 3. 团队作品集
│   ├── 历届参赛作品
│   ├── 作品封面、标题、链接
│   ├── 获奖情况
│   └── 按届数/时间排序
│
└── 4. 团队成就
    ├── 历史获奖记录
    ├── 排名情况（12个排行榜位置）
    ├── 特殊成就（如"最佳创新奖"）
    └── 数据统计（参赛次数、总评分等）
```

### 2. 团队作品集

#### 第一届（MVP）
- ✅ **仅显示站内作品**（本次比赛提交的作品）
- 显示内容：
  - 作品封面
  - 作品标题
  - 赛道标识（个人/团队）
  - 提交时间
  - 评分情况（评分人数、平均分）
  - 排名情况

#### 未来扩展
- ✅ 支持添加**站外作品链接**（如Itch.io、GitHub等）
- 展示完整作品履历

### 3. 团队成就

#### 自动计算机制
- ✅ **自动计算**（基于站内成就系统）
- ✅ 成就绑定到**团队ID**（不随成员变化而消失）

#### 成就类型
1. **排名成就**
   - 12个排行榜的排名记录
   - 显示最高排名（如"创新性-参赛者榜 第3名"）

2. **获奖成就**
   - 特殊奖项（如"最佳创新奖"、"最佳美术奖"）
   - 评审团推荐作品

3. **数据统计**
   - 参赛次数
   - 作品总数
   - 累计获得评分数
   - 累计获得打赏金币数

4. **里程碑成就**
   - 首次参赛
   - 首次进入前10名
   - 连续参赛N届

### 4. 团队成员区UI细节

#### 成员卡片展示
```
[队长标识] [头像] 昵称
[身份标签] 程序 | 策划 | TA
[加入时间] 2025-01-07
```

#### 9人团队的显示优化
**问题**（Q7）：9人团队名字列表会不会太长？

**待确认方案**：
- 方案A：显示全部成员（推荐）
- 方案B：显示"团队XXX + 8名成员"，鼠标悬浮显示完整列表
- 方案C：仅显示队长+副队长，其他成员折叠

---

## 🎮 团队与作品的关联

### 1. 作品提交规则

#### 团队作品提交
**提交时选择**：
- 选择团队（下拉列表，显示用户所属团队）
- 系统自动判定赛道：
  - 团队成员 > 1人 → 锁定为团队赛道
  - 团队成员 = 1人 → 可选个人/团队赛道

**提交者身份要求**：
- ✅ 必须是队长或副队长
- ❌ 普通成员不能提交

**提交时快照** ✅ 已确认 (2025-01-08)：
- ✅ 提交时**快照成员列表**（决策Q4）
- ✅ 作品页面显示"提交时的成员"（快照）
- ✅ 团队页面显示"当前成员"（实时）
- ✅ 两个列表可能不同（后续成员变更）

#### 作品数量限制 ✅ 已确认 (2025-01-08)
- ✅ **一个团队在一届比赛中只能提交一个作品**（决策Q6）
- ✅ **即使团队=1人，也不可以同时提交个人作品和团队作品**
- ✅ 一个用户在同一届比赛中只能以一个身份参赛（个人或团队）

**理由**：
- 与个人赛道保持一致（每人一个作品）
- 简化评分逻辑
- 防止团队"刷作品"获得评分优势

### 2. 团队作品的作者显示

#### 作品页面作者区显示
**待确认**（Q7）：9人团队的名字列表显示问题

**方案**：
- 方案A：显示所有成员名字
- 方案B：显示"团队XXX + N名成员"
- 方案C：显示队长+副队长，其他成员悬浮显示

**建议**：
- 9人团队：显示"团队XXX + 8名成员"，鼠标悬浮显示完整列表
- 5人以下：显示全部成员名字

### 3. 退出成员的作品关联

#### 退出后的作品显示
- ✅ **保留作者身份**（作品页面仍显示其为作者）
- ✅ **标识状态**（如"前团队成员"）
- ❌ **不能编辑作品**（已退出无权限）

#### 个人主页的作品显示
- ✅ 显示该团队作品
- ✅ 标识为"团队作品"
- ✅ 显示"作为XXX团队成员参赛"

---

## 👥 组队信息区（社区功能）

### 1. 招募帖发布

#### 发布表单字段
```
必填项：
- 团队名称
- 招募标题
- 团队简介/项目概念（50-500字）
- 需要技能标签（多选：程序/策划/美术/音乐/音效/TA）

可选项：
- 团队头像/概念图
- 目标人数（1-9人）
- 团队风格标签（严肃认真/轻松愉快/学习导向/冲刺作品）
- 沟通方式（Discord/QQ/微信/站内私信）
- 联系信息
- 项目时间线（计划开发时长）
```

#### 模板功能
**快速模板**：
- "48小时极限开发"模板（预设：严肃认真、48小时、全技能需求）
- "学习练手"模板（预设：轻松愉快、无时间限制、新手友好）
- "长期项目"模板（预设：1个月以上、部分技能需求）

### 2. 招募状态管理

#### 目标人数设置（待确认 Q9）
- [ ] 团队可设置"目标人数"（1-9人）
- [ ] 达到目标人数后，自动标记为"已满员"
- [ ] 队长可以手动开关"招募状态"

#### 招募卡片显示
**筛选维度**：
- 项目阶段（策划阶段/开发中/美术急需/音效急需/测试阶段）
- 技能需求（程序/美术/音乐/策划/文案/测试）
- 时间线（48小时赛前/48小时内/赛后合作）
- 团队规模（1人扩队/2-3人/4-6人/7-9人）
- 招募状态（招募中/已满员）

**状态标识**：
- 🔥 热门招募（浏览数>100或申请数>10）
- 🆕 新发布（24小时内）
- ⏰ 即将截止（距离截止<24小时）
- ✅ 已满员

### 3. 申请与沟通

#### 申请流程
1. 点击"申请加入"
2. 填写申请表单：
   - 自我介绍（必填，50-300字）
   - 擅长技能（标签选择）
   - 联系方式（必填）
   - 备注（可选）
3. 队长收到站内通知
4. 队长审核：
   - [接受] → 发送邀请码/链接
   - [拒绝] → 通知申请人
   - [留言询问] → 通过站内私聊沟通

#### 申请状态
- 申请者可在"我的申请"中查看：
  - ⏳ 待处理
  - ✅ 已接受（收到邀请码）
  - ❌ 已拒绝

---

## 🔐 边界情况处理

### 1. 团队无人时的处理 ✅ 已确认 (2025-01-08)

**场景**：所有成员都退出团队，只剩空团队

**已确认规则**（决策Q3）：
- ✅ 最后一人退出时，团队**自动解散**
- ✅ 团队页面标记为"已解散"，保留历史记录
- ✅ 团队作品仍然保留（不受解散影响）
- ✅ 解散后的团队不可恢复

### 2. 队长退出时的权限继承 ✅ 已确认 (2025-01-08)

**场景**：队长想要退出团队

**已确认规则**（决策Q4）：
- ✅ 队长退出时，**必须**先转让队长（否则无法退出）
- ✅ **不设置自动接管机制**（决策Q5：不必处理队长不活跃情况）
- ✅ 团队内部自行协调或管理员手动处理不活跃队长问题

**特殊情况**：
- 团队只剩1人时，该人自动成为队长
- 赛程内队长即使移交权限后，新队长同样不可退出

### 3. 成员变更对作品的影响 ✅ 已确认 (2025-01-08)

**场景A：提交作品后成员退出**
- 提交时有5人，后来变成2人
- ✅ **作品的"团队规模"标识仍是5人**（快照）
- ✅ **评分资格不受影响**（作品快照机制）

**场景B：提交作品后添加成员**
- 提交时有2人，后来加到9人
- ✅ **作品的"团队规模"标识仍是2人**（快照）
- ✅ **不会产生刷成员嫌疑**（作品快照机制保证公平）

**已确认规则**：
- ✅ **作品提交时快照成员列表**（作品页面显示"提交时的成员"）
- ✅ 团队页面显示"当前成员"（实时，可能与作品不同）
- ✅ 评分资格**不受**成员变更影响（基于作品快照）

### 4. 一个人创建/加入多个团队的问题 ✅ 已确认 (2025-01-08)

**场景A：跨团队参赛**
- 用户A创建了团队A（个人赛道），同时又是团队B的成员
- ❌ **不允许**（同一届比赛只能加入/创建一个团队）

**场景B：团队创建限制**
- 一个用户可以创建多个团队吗？
- ❌ **不可以**（同一届比赛只能加入/创建一个团队）

**已确认规则**（决策Q1）：
- ✅ 一个用户**在同一届比赛中只能加入/创建一个团队**
- ✅ 退出团队后，才能加入/创建另一个团队
- ✅ 历史团队记录保留（个人主页可显示"历届团队"）

### 5. 团队名称的唯一性和规范（待确认 Q12）

**待确认**：
- [ ] **Q12: 团队名称是否有重复限制和修改频率限制？**

**建议**：
- ✅ 允许重名，但加团队ID区分（如"独立开发团队 #123"）
- ✅ 团队名称长度限制：2-20字符
- ✅ 团队名称可以修改，30天内只能改1次
- ✅ 敏感词过滤适用

### 6. 评分时的身份判定问题（待确认 Q11）

**场景**：混合身份评分

用户A的状态：
- 有个人作品（个人赛道）
- 是团队B的成员（团队赛道）

问题：
- 用户A评分团队C的作品时，算什么身份？
  - "参赛者评团队作品"？
  - "路人评团队作品"？

**建议**：
- ✅ 明确身份优先级：**个人作者 > 团队成员 > 评审团 > 路人**
- ✅ 评分时**根据被评作品的赛道判定**：
  - 如果评分团队作品 → 检查评分者是否是团队成员
  - 如果评分个人作品 → 检查评分者是否有个人作品

---

## 📊 数据结构设计

### 1. 核心数据表

#### teams（团队表）
```sql
team_id          INT          PK  -- 团队ID
team_name        VARCHAR(20)      -- 团队名称
team_desc        TEXT             -- 团队简介
team_avatar      VARCHAR(255)     -- 团队头像URL
creator_id       INT              -- 创建者ID
captain_id       INT              -- 队长ID
target_size      INT              -- 目标人数（1-9）
current_size     INT              -- 当前人数（1-9）
is_recruiting    BOOLEAN          -- 招募状态
invite_code      VARCHAR(20)      -- 邀请码
invite_code_exp  DATETIME         -- 邀请码过期时间
created_at       DATETIME         -- 创建时间
updated_at       DATETIME         -- 更新时间
status           ENUM             -- 状态（active/dissolved）
```

#### team_members（团队成员表）
```sql
member_id        INT          PK  -- 成员ID
team_id          INT              -- 团队ID（FK）
user_id          INT              -- 用户ID（FK）
role             ENUM             -- 角色（captain/vice_captain/member）
tags             JSON             -- 身份标签（["程序","策划"]）
joined_at        DATETIME         -- 加入时间
updated_at       DATETIME         -- 更新时间
```

#### team_works（团队作品关联表）
```sql
work_id          INT          PK  -- 关联ID
team_id          INT              -- 团队ID（FK）
game_id          INT              -- 游戏ID（FK）
track_type       ENUM             -- 赛道类型（individual/team）
member_snapshot  JSON             -- 成员快照（提交时的成员列表）
submitted_at     DATETIME         -- 提交时间
```

#### team_achievements（团队成就表）
```sql
achievement_id   INT          PK  -- 成就ID
team_id          INT              -- 团队ID（FK）
achievement_type ENUM             -- 成就类型（rank/award/milestone）
achievement_data JSON             -- 成就详细数据
earned_at        DATETIME         -- 获得时间
```

#### recruiting_posts（招募帖表）
```sql
post_id          INT          PK  -- 帖子ID
team_id          INT              -- 团队ID（FK）
title            VARCHAR(100)     -- 招募标题
content          TEXT             -- 招募内容
required_skills  JSON             -- 需要技能（["程序","美术"]）
target_size      INT              -- 目标人数
team_style       ENUM             -- 团队风格（serious/casual/learning/sprint）
contact_method   ENUM             -- 沟通方式
contact_info     VARCHAR(255)     -- 联系信息
created_at       DATETIME         -- 发布时间
status           ENUM             -- 状态（recruiting/full/closed）
```

### 2. 索引设计

```sql
-- 团队表索引
CREATE INDEX idx_teams_captain ON teams(captain_id);
CREATE INDEX idx_teams_invite_code ON teams(invite_code);
CREATE INDEX idx_teams_status ON teams(status);

-- 成员表索引
CREATE INDEX idx_members_team ON team_members(team_id);
CREATE INDEX idx_members_user ON team_members(user_id);
CREATE UNIQUE INDEX idx_members_team_user ON team_members(team_id, user_id);

-- 作品关联索引
CREATE INDEX idx_works_team ON team_works(team_id);
CREATE INDEX idx_works_game ON team_works(game_id);
```

---

## 📋 待确认问题清单

### 🔴 高优先级（系统稳定性）✅ 已全部确认 (2025-01-08)

#### ✅ Q1: 一个人在同一届比赛中只能加入/创建一个团队？
**决策**：选择A - 只能加入/创建一个团队
**决策日期**：2025-01-08
**详细规则**：
- 一个用户在同一届比赛中只能加入/创建一个团队
- 退出团队后，才能加入/创建另一个团队
- 历史团队记录保留（个人主页显示"历届团队"）

---

#### ✅ Q2: 提交作品后成员变更规则？
**决策**：混合方案（赛程内不可退但可加，赛程外自由）
**决策日期**：2025-01-08
**详细规则**：
- **赛程内**（开发期未结束前）：任何人都不可退出，但可以加入新成员
- **赛程结束后**：可以自由退出，可以加入新成员
- 所有变更都记录变更日志
- 队长想退出时必须先移交队长权限

---

#### ✅ Q3: 团队无人时（所有成员都退出）是否自动解散？
**决策**：选择A - 自动解散
**决策日期**：2025-01-08
**详细规则**：
- 最后一人退出时，团队自动解散
- 团队页面标记为"已解散"，保留历史记录
- 团队作品仍然保留（不受解散影响）

---

#### ✅ Q4: 队长退出时是否必须先转让队长？
**决策**：选择A - 必须先转让队长
**决策日期**：2025-01-08
**详细规则**：
- 队长退出时必须先转让队长，否则无法退出
- 赛程内队长即使移交权限后，新队长同样不可退出

---

#### ✅ Q5: 队长长时间不活跃的自动接管机制？
**决策**：不必处理
**决策日期**：2025-01-08
**详细规则**：
- 不设置自动接管机制
- 团队内部自行协调或管理员手动处理不活跃队长问题

---

#### ✅ Q6: 一个团队在一届比赛中只能提交一个作品？
**决策**：选择A - 只能提交一个作品
**决策日期**：2025-01-08
**详细规则**：
- 一个团队在一届比赛中只能提交一个作品
- 即使团队=1人，也不可以同时提交个人作品和团队作品
- 一个用户在同一届比赛中只能以一个身份参赛（个人或团队）

**理由**：
- 与个人赛道保持一致（每人一个作品）
- 简化评分逻辑

**补充**：如果团队=1人，可以同时提交个人作品和团队作品吗？
- 建议：不可以，一个团队只能提交一个作品

---

### 🟡 中优先级（用户体验）✅ 已全部确认 (2025-01-08)

#### ✅ Q7: 团队作品页面如何显示作者（9人团队名字列表问题）？
**决策**：选择B - 显示"团队XXX + N名成员"，鼠标悬浮显示完整列表
**决策日期**：2025-01-08
**详细规则**：
- 9人团队：显示"团队XXX + 8名成员"，鼠标悬浮显示完整列表
- 5人以下：显示全部成员名字
- 9人团队名字列表太长，悬浮显示节省空间，保持页面整洁

---

#### ✅ Q8: 副队长能否移除成员？
**决策**：选择B - 副队长不能移除成员
**决策日期**：2025-01-08
**详细规则**：
- 副队长不能移除任何成员（包括普通成员）
- 防止副队长滥用权限
- 保持队长最高权限，权限设计更清晰

---

#### ✅ Q9: 团队是否可设置"目标人数"和"招募状态"？
**决策**：选择A（加强版）- 可以设置目标人数，达到后自动标记"已满员"，同时队长也可随时手动开关招募状态
**决策日期**：2025-01-08
**详细规则**：
- 队长可设置"目标人数"(1-9人)
- 达到目标人数后，自动标记为"已满员"
- 队长可以随时手动开关"招募状态"
- 组队信息区可筛选"招募中"和"已满员"

---

#### ✅ Q10: 邀请码/链接是否需要重置和过期机制？
**决策**：选择A（优化版）- 邀请码有效期1小时，使用后自动销毁，不可重复利用
**决策日期**：2025-01-08
**详细规则**：
- 邀请码有效期1小时（比原24小时更安全）
- 邀请码使用后自动失效（一次性使用）
- 队长可随时重置邀请码（生成新的）
- 防止邀请码泄露后被恶意使用

---

#### ❌ Q11: 评分时的身份判定逻辑（混合身份）？
**状态**：问题不成立
**原因**：根据Q1"一人一团队规则"，不可能出现混合身份
**说明**：
- 用户提交个人作品 = 有一个"单人团队"（自己就是团队）
- 已有团队后不能再加入其他团队
- 所以不存在"用户既有个人作品，又是团队成员"的情况

---

### 🟢 低优先级（可后续优化）✅ 已全部确认 (2025-01-08)

#### ✅ Q12: 团队名称是否有重复限制和修改频率限制？
**决策**：团队名称唯一(不可重复) + 每个赛季只能改1次
**决策日期**：2025-01-08
**详细规则**：
- 团队名称必须唯一,不允许重复
- 每个赛季内只能修改1次团队名称
- 比原方案A的30天更宽松(一个赛季可能持续数周)

---

#### ✅ Q13: 队长长时间不活跃的自动接管机制？
**决策**：与Q5相同,不设置自动接管机制
**决策日期**：2025-01-08
**说明**：问题与Q5重复,遵循Q5的决策

---

#### ✅ Q14: 个人主页和团队页面的跳转逻辑？
**决策日期**：2025-01-08
**详细规则**：
- **Q14.1**: 个人主页上的团队作品 → 点击跳转到**游戏页面**
- **Q14.2**: 游戏页面上的团队名称 → 点击跳转到**团队页面**
- **Q14.3**: 团队页面成员头像 → 点击跳转到**个人主页**
- **Q14.4**: 个人主页 → 需要显示**所属团队**快速入口

**设计原则**：点击什么就跳转到什么,直观明了

---

#### Q15-Q23: （其他细节问题，详见上文）

---

## 🔗 与其他系统的集成

### 1. 与评分系统集成

**身份判定**：
- 评分团队作品时，检查评分者是否是团队成员
- 评分个人作品时，检查评分者是否有个人作品
- 混合身份时，根据被评作品赛道判定

**作者身份**：
- 团队作品的作者 = 提交时的成员快照
- 退出成员仍保留作者身份
- 作品不受后续成员变更影响

### 2. 与排名系统集成

**赛道区分**：
- 个人赛道排行榜
- 团队赛道排行榜
- 互不干扰

**排名规则**：
- 团队作品的排名归属于团队
- 团队成员的个人主页显示团队排名
- 退出成员的个人主页仍显示历史排名

### 3. 与经济系统集成

**打赏分配**（未来扩展）：
- 团队作品获得打赏，如何分配给成员？
- 建议：平均分配或按贡献比例（需队长设置）

**金币奖励**：
- 团队成就的金币奖励，如何分配？
- 建议：队长统一分配或平均分配

### 4. 与游戏提交系统集成

**提交权限**：
- 只有队长和副队长可以提交团队作品
- 提交时选择团队
- 提交后快照成员列表

**编辑权限**：
- 队长和副队长可以编辑团队作品
- 普通成员不能编辑

### 5. 与社区系统集成

**组队信息区**：
- 显示招募中的团队
- 点击团队名称跳转到团队页面
- 站内私聊沟通

**话题讨论**：
- 团队可以发布话题讨论
- 标注团队身份

---

## 📈 实现优先级

### 第一届必须实现（MVP）⭐

#### 核心功能
1. ✅ 团队创建（1-9人）
2. ✅ 成员角色（队长/副队长/普通成员）
3. ✅ 邀请码/邀请链接加入
4. ✅ 成员退出/移除
5. ✅ 作品提交（团队赛道判定）
6. ✅ 团队页面（基础信息/成员列表）
7. ✅ 组队信息区（招募帖发布）

#### 配套功能
8. ✅ 站内私聊系统（基础版）

### 第二届优化
9. ⚠️ 团队作品集（站外链接）
10. ⚠️ 团队成就系统（深度扩展）
11. ⚠️ 团队协作区（内部聊天/任务看板）
12. ⚠️ 邀请码过期机制

### 未来迭代
13. ⏳ 团队隐私设置
14. ⏳ 团队打赏分配
15. ⏳ 团队数据分析

---

## 📝 开发注意事项

### 前端开发

#### 团队页面
- 响应式设计（移动端友好）
- 成员卡片悬浮显示详细信息
- 作品集轮播/网格展示

#### 组队信息区
- 筛选器（技能/阶段/规模）
- 招募卡片设计
- 申请弹窗

#### 作品提交页
- 赛道自动判定提示
- 团队选择下拉列表
- 成员快照确认

### 后端开发

#### 核心接口
```
POST /api/team/create          - 创建团队
POST /api/team/:id/join        - 加入团队（邀请码）
POST /api/team/:id/leave       - 退出团队
POST /api/team/:id/kick        - 移除成员（仅队长）
PUT  /api/team/:id/transfer    - 转让队长
PUT  /api/team/:id/promote     - 设置副队长
GET  /api/team/:id             - 获取团队信息
GET  /api/team/:id/members     - 获取成员列表
```

#### 权限校验
- 队长权限：所有操作
- 副队长权限：上传/编辑作品
- 普通成员权限：仅查看

#### 边界情况处理
- 团队人数上限（9人）
- 队长退出时的强制转让
- 作品提交后的成员锁定
- 团队无人时的自动解散

### 数据库优化

#### 索引
- team_id、user_id建立索引
- 邀请码建立唯一索引
- 状态字段建立索引

#### 缓存
- 团队信息缓存（Redis）
- 成员列表缓存
- 招募帖缓存

---

## 🎯 总结

### 系统复杂度评估

| 指标 | 评分 | 说明 |
|------|------|------|
| **功能复杂度** | ⭐⭐⭐ | 9个功能模块，23个问题 |
| **权限复杂度** | ⭐⭐⭐ | 3级角色，不同权限 |
| **数据关联** | ⭐⭐⭐ | 影响5+个核心系统 |
| **开发工作量** | ⭐⭐⭐ | 约15-20人日 |
| **维护成本** | ⭐⭐ | 中等 |

### 关键决策点

**已确认**：
- ✅ 团队规模1-9人
- ✅ 三级角色（队长/副队长/成员）
- ✅ 赛道自动判定逻辑
- ✅ 邀请码+私聊组合
- ✅ 团队页面公开可见

**已确认** (2025-01-08)：
- ✅ **高优先级问题6个全部确认**（Q1-Q6）
  - Q1: 一人一团队规则
  - Q2: 赛程内不可退但可加，赛程外自由
  - Q3: 团队无人自动解散
  - Q4: 队长退出必须先移交权限
  - Q5: 不设置自动接管机制
  - Q6: 一个团队一个作品
- ✅ **中优先级问题4个全部确认**（Q7-Q10，Q11问题不成立）
  - Q7: 9人团队显示"团队XXX + N名成员"，悬浮显示完整列表
  - Q8: 副队长不能移除成员
  - Q9: 可设置目标人数+自动标记已满员+手动开关招募状态
  - Q10: 邀请码有效期1小时，使用后自动销毁
  - Q11: 问题不成立（一人一团队规则导致混合身份不可能）
- ⏳ **低优先级问题3个待确认**（Q12-Q14）

### 下一步行动

1. **立即行动**：
   - ✅ 高优先级问题已全部确认（2025-01-08）
   - ✅ 中优先级问题已全部确认（2025-01-08）
   - ⏳ 逐个确认低优先级问题（Q12-Q14）

2. **补充文档**：
   - UI/UX设计稿（团队页面）
   - 接口文档（API设计）
   - 数据库ER图

3. **开发准备**：
   - 前端组件设计
   - 后端接口开发
   - 测试用例编写

---

*最后更新：2025-01-08*
*创建人：Claude (老黑)*
*状态：核心规则+中优先级问题已100%确认，低优先级问题待确认*
