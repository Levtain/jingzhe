# 惊蛰计划 - 主题投票系统设计文档

**文档版本**: v1.0
**创建日期**: 2026-01-11
**设计状态**: 🟡 部分待确认
**相关系统**: 经济系统、活动流程系统

---

## 文档说明

本文档定义惊蛰计划的主题投票系统，包括主题征集、筛选、三轮投票的完整流程。

**已定义内容**:
- ✅ 时间轴和各阶段时长
- ✅ 主题征集规则
- ✅ 主题筛选机制
- ✅ 三轮投票流程

**待确认问题**:
- 🟡 筛选阶段后保留的主题数量
- 🟡 第1、2轮投票后保留的主题数量
- 🟡 第1、2轮投票是单选还是多选

---

## 一、系统概述

### 1.1 设计目标

> **公平、公开、好玩**

核心原则:
1. **全员参与**: 所有注册用户均可参与征集和投票
2. **民主决策**: 通过多轮投票筛选出最受欢迎的主题
3. **激励参与**: 金币奖励机制鼓励用户投票

### 1.2 时间轴

```
活动前4周 → 第1周（主题征集7天） → 第2周（主题筛选7天）
→ 第3-5周（3轮投票各3天） → 惊蛰后第一个周五17:00（公布主题）
```

**详细时间表**:
- **T-4周**: 主题征集开始（7天）
- **T-3周**: 主题筛选（7天）
- **T-2周**: 第1轮投票（3天）
- **T-1.5周**: 第2轮投票（3天）
- **T-1周**: 第3轮投票（3天）
- **T日**: 惊蛰后第一个周五 17:00 公布主题

---

## 二、主题征集阶段

### 2.1 基本信息

| 项目 | 内容 |
|------|------|
| **时间** | T-4周，共7天 |
| **参与条件** | 所有已注册用户 |
| **提交限制** | 每人1个主题 |
| **停止条件** | 7天或收集到1200个主题 |

### 2.2 规则详情

**提交规则**:
- ✅ 所有注册用户均可参与
- ✅ 每人限提交1个主题
- ✅ 主题字数限制: 建议不超过20字
- ✅ 主题语言: 中文或英文
- ✅ 禁止重复提交相似主题

**主题要求**:
- ✅ 主题应具有开放性和创造性
- ✅ 避免过于具体或限制性强的主题
- ✅ 适合48小时游戏开发
- ✅ 不涉及敏感话题

**输出**: 主题池（所有提交的主题集合）

---

## 三、主题筛选阶段

### 3.1 基本信息

| 项目 | 内容 |
|------|------|
| **时间** | T-3周，共7天 |
| **参与条件** | 所有已注册用户 |
| **筛选方式** | 多轮随机抽样投票（点赞冒泡） |

### 3.2 筛选机制

**核心机制**: 多轮随机抽样投票（点赞冒泡）

**筛选流程**:

#### 第1步: 随机展示
- 每次随机抽取10个主题展示给用户
- 用户可以对每个主题选择"保留"或"淘汰"

#### 第2步: 多轮投票
- 持续7天，每天多轮
- 同一主题会被多次随机展示给不同用户
- 用户每次看到主题时都可以投票

#### 第3步: 统计结果
- 统计所有轮次的点赞总数
- 按点赞数从高到低排序
- **取点赞数最高的N个主题进入三轮投票** ⚠️ **N待确认**

### 3.3 激励机制

**经济系统支持**:

| 项目 | 内容 |
|------|------|
| **奖励条件** | 每日投出总主题量1/3的赞 |
| **奖励金额** | 5金币 |
| **奖励限制** | 每天1次 |

**说明**:
- 每天投出的赞数量 ≥ 当天抽取主题总数 ÷ 3
- 目的: 激励用户参与主题筛选，保证主题质量

### 3.4 待确认问题 ⚠️

#### 问题1: 筛选阶段后保留多少个主题？

**选项**:
- A) 28个主题（参考v0.3_extended文档）
- B) 其他数量（请告诉我）

**影响**:
- 决定三轮投票的起始候选数量
- 影响第1轮投票的规模

**您的选择**：_____

---

## 四、三轮投票阶段

### 4.1 基本信息

| 项目 | 内容 |
|------|------|
| **时间** | T-2周到T-1周，共9天 |
| **参与条件** | 所有已注册用户 |
| **投票方式** | 第1、2轮待确认；第3轮单选 |

### 4.2 第1轮投票（R1）

**时间**: T-2周，3天

**输入**: 候选主题列表（来自筛选阶段）

**投票方式**: 🟡 **待确认 - 单选还是多选？**

**输出**: **得票最高的前N1个主题进入下一轮** ⚠️ **N1待确认**

#### 待确认问题 ⚠️

#### 问题2: 第1轮投票后保留多少个主题？

**选项**:
- A) 16个主题（28→16，接近50%保留率）
- B) 12个主题（28→12，约40%保留率）
- C) 8个主题（28→8，约30%保留率）
- D) 其他数量（请告诉我）

**您的选择**：_____

#### 问题3: 第1轮投票是单选还是多选？

**选项**:
- A) 单选 - 每个用户只能选1个主题
- B) 多选 - 每个用户可以选择多个主题（限制数量？）
- C) 不限 - 每个用户可以选任意多个主题

**您的选择**：_____

---

### 4.3 第2轮投票（R2）

**时间**: T-1.5周，3天

**输入**: 第1轮选出的主题

**投票方式**: 🟡 **待确认 - 与第1轮相同**

**输出**: **得票最高的前N2个主题进入下一轮** ⚠️ **N2待确认**

#### 待确认问题 ⚠️

#### 问题4: 第2轮投票后保留多少个主题？

**选项**:
- A) 8个主题（从16或12个中选8个）
- B) 6个主题（从16或12个中选6个）
- C) 4个主题（从16或12个中选4个，直接进入最终轮）
- D) 其他数量（请告诉我）

**您的选择**：_____

#### 问题5: 第2轮投票是单选还是多选？

**选项**:
- A) 与第1轮相同
- B) 单选（第2轮开始改为单选）
- C) 其他方式（请告诉我）

**您的选择**：_____

---

### 4.4 第3轮投票（R3）

**时间**: T-1周，3天

**输入**: 第2轮选出的主题

**投票方式**: ✅ **单选投票（最终主题）**

**输出**: 得票最高的主题确定为本次比赛主题

**说明**: 第3轮投票规则已明确，无需确认

---

## 五、主题公布

### 5.1 公布时间

- **时间**: 惊蛰后第一个周五 17:00
- **方式**: 网站公布 + 社区公告

### 5.2 主题展示

**展示内容**:
- ✅ 最终选定的主题
- ✅ 主题票数统计（可选）
- ✅ 参与投票人数统计
- ✅ 感谢所有参与者

---

## 六、数据模型

### 6.1 主题表 (themes)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| theme_id | INT | 主题ID |
| content | VARCHAR | 主题内容 |
| submitter_id | INT | 提交者ID |
| stage | VARCHAR | 所在阶段 (submission/filtering/r1/r2/r3/final) |
| likes_count | INT | 获赞数量（筛选阶段） |
| votes_r1 | INT | 第1轮得票数 |
| votes_r2 | INT | 第2轮得票数 |
| votes_r3 | INT | 第3轮得票数 |
| is_final | BOOLEAN | 是否为最终主题 |
| created_at | DATETIME | 创建时间 |

### 6.2 主题筛选记录表 (theme_filter_logs)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| log_id | INT | 记录ID |
| theme_id | INT | 主题ID |
| user_id | INT | 投票用户ID |
| action | VARCHAR | 操作 (like/dislike) |
| round_number | INT | 轮次编号 |
| created_at | DATETIME | 创建时间 |

### 6.3 主题投票记录表 (theme_votes)

| 字段名 | 类型 | 说明 |
|-------|------|------|
| vote_id | INT | 投票ID |
| theme_id | INT | 主题ID |
| user_id | INT | 投票用户ID |
| round | VARCHAR | 轮次 (r1/r2/r3) |
| created_at | DATETIME | 投票时间 |

---

## 七、接口设计

### 7.1 提交主题

```
POST /api/themes/submit

Request:
{
  "content": "主题内容"
}

Response:
{
  "theme_id": 1234,
  "content": "主题内容",
  "status": "submitted",
  "message": "主题提交成功"
}
```

### 7.2 主题筛选投票

```
POST /api/themes/filter/vote

Request:
{
  "theme_id": 1234,
  "action": "like"
}

Response:
{
  "success": true,
  "message": "投票成功"
}
```

### 7.3 获取今日筛选任务

```
GET /api/themes/filter/today

Response:
{
  "total_themes_today": 50,
  "themes": [
    {
      "theme_id": 1234,
      "content": "主题内容",
      "has_voted": false
    },
    ...
  ]
}
```

### 7.4 三轮投票

```
POST /api/themes/vote

Request:
{
  "theme_id": 1234,
  "round": "r1"
}

Response:
{
  "success": true,
  "message": "投票成功"
}
```

---

## 八、业务逻辑

### 8.1 主题筛选流程

```
用户进入筛选页面
  ↓
系统随机抽取10个主题
  ↓
用户对每个主题投票（保留/淘汰）
  ↓
更新主题得票数
  ↓
用户完成当前批次
  ↓
可选择继续投票或离开
  ↓
7天后统计所有主题得票数
  ↓
按得票数排序
  ↓
保留前N个主题进入三轮投票
```

### 8.2 三轮投票流程

```
第1轮投票开始（3天）
  ↓
用户浏览候选主题
  ↓
用户投票（单选/多选）
  ↓
实时统计得票数
  ↓
3天后结束
  ↓
保留前N1个主题
  ↓
第2轮投票开始（3天）
  ↓
...（同第1轮）
  ↓
保留前N2个主题
  ↓
第3轮投票开始（3天）
  ↓
用户单选投票
  ↓
3天后结束
  ↓
得票最高的主题确定为最终主题
```

---

## 九、前端展示

### 9.1 主题征集页面

**展示内容**:
- 大标题: "主题征集进行中"
- 当前征集数量: "已收集 X 个主题"
- 截止倒计时
- "提交主题"按钮
- 最热主题预览（前5个）

### 9.2 主题筛选页面

**展示内容**:
- 大标题: "主题筛选进行中"
- 当前轮次: "第 X / ? 轮"
- 今日可投票数
- 随机主题展示区（每次10个）
- 每个主题的"保留"/"淘汰"按钮
- 今日任务进度

### 9.3 三轮投票页面

**展示内容**:
- 当前投票轮次（R1/R2/R3）
- 剩余时间倒计时
- 候选主题列表
- 投票按钮
- 实时得票数统计

---

## 十、已确认规则 ✅

### 10.1 时间规则 ✅
- [x] 主题征集: 7天
- [x] 主题筛选: 7天
- [x] 第1轮投票: 3天
- [x] 第2轮投票: 3天
- [x] 第3轮投票: 3天

### 10.2 参与规则 ✅
- [x] 所有注册用户均可参与
- [x] 每人限提交1个主题
- [x] 第3轮投票为单选

### 10.3 筛选机制 ✅
- [x] 多轮随机抽样投票（点赞冒泡）
- [x] 每次随机展示10个主题
- [x] 用户可选择"保留"或"淘汰"

### 10.4 经济激励 ✅
- [x] 每日投1/3赞获得5金币奖励

---

## 十一、待确认问题清单 ⚠️

### 🔴 必须确认（影响开发）

| 问题编号 | 问题描述 | 选项 | 状态 |
|---------|---------|------|------|
| 问题1 | 筛选阶段后保留多少个主题？ | A) 28个<br>B) 其他 | ⏳待确认 |
| 问题2 | 第1轮投票后保留多少个主题？ | A) 16个<br>B) 12个<br>C) 8个<br>D) 其他 | ⏳待确认 |
| 问题3 | 第1轮投票是单选还是多选？ | A) 单选<br>B) 多选<br>C) 不限 | ⏳待确认 |
| 问题4 | 第2轮投票后保留多少个主题？ | A) 8个<br>B) 6个<br>C) 4个<br>D) 其他 | ⏳待确认 |
| 问题5 | 第2轮投票是单选还是多选？ | A) 与R1相同<br>B) 单选<br>C) 其他 | ⏳待确认 |

---

## 十二、建议方案

### 方案A: 渐进式筛选（推荐）

**配置**:
- 筛选阶段后: 保留28个主题
- 第1轮投票: 28 → 12个（约40%保留率）
- 第2轮投票: 12 → 4个（约30%保留率）
- 第3轮投票: 4 → 1个（单选）

**投票方式**:
- 第1轮: 多选（最多选5个）
- 第2轮: 多选（最多选3个）
- 第3轮: 单选

**优点**:
- 逐步缩小范围，保证质量
- 前两轮多选增加参与度
- 符合常规投票逻辑

### 方案B: 快速筛选

**配置**:
- 筛选阶段后: 保留16个主题
- 第1轮投票: 16 → 8个（50%保留率）
- 第2轮投票: 8 → 4个（50%保留率）
- 第3轮投票: 4 → 1个（单选）

**投票方式**:
- 第1轮: 单选
- 第2轮: 单选
- 第3轮: 单选

**优点**:
- 简单直接
- 流程更短

---

## 版本历史

- **v1.0** (2026-01-11): 初版完成
  - 整理已定义的规则
  - 列出待确认问题
  - 提供建议方案

---

## 相关文档

- [内部系统设计文档.md](./惊蛰计划-内部系统设计文档.md) - 主题投票系统章节
- [内部系统设计文档_v0.3_extended.md](./惊蛰计划-内部系统设计文档_v0.3_extended.md) - 主题征集与投票流程
- [经济系统设计文档 v1.4](./惊蛰计划-经济系统设计文档_v1.0.md) - 主题投票奖励

---

**创建者**: Claude (Assistant)
**审核者**: 蜡烛先生
**状态**: 🟡 待确认问题清单
